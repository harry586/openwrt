#ã€build_firmware_main.sh-42ã€‘
# ============================================
# å·²åºŸå¼ƒçš„æœç´¢å‡½æ•°ï¼ˆä¿ç•™å…¼å®¹æ€§ï¼‰- æ›¿æ¢ä¸ºå·¥ä½œæµæ­¥éª¤å‡½æ•°
# ============================================
workflow_step05_install_basic_tools() {
    log "=== æ­¥éª¤05: å®‰è£…åŸºç¡€å·¥å…·ï¼ˆä¼˜åŒ–ç‰ˆï¼‰ ==="
    
    set -e
    trap 'echo "âŒ æ­¥éª¤05 å¤±è´¥ï¼Œé€€å‡ºä»£ç : $?"; exit 1' ERR
    
    setup_environment
    
    log "âœ… æ­¥éª¤05 å®Œæˆ"
}

workflow_step06_initial_space_check() {
    log "=== æ­¥éª¤06: åˆå§‹ç©ºé—´æ£€æŸ¥ ==="
    
    set -e
    trap 'echo "âŒ æ­¥éª¤06 å¤±è´¥ï¼Œé€€å‡ºä»£ç : $?"; exit 1' ERR
    
    echo "=== ğŸš¨ åˆå§‹ç£ç›˜ç©ºé—´æ£€æŸ¥ ==="
    
    echo "ğŸ“Š ç£ç›˜ä½¿ç”¨æƒ…å†µ:"
    df -h
    
    AVAILABLE_SPACE=$(df /mnt --output=avail 2>/dev/null | tail -1 || df / --output=avail | tail -1)
    AVAILABLE_GB=$((AVAILABLE_SPACE / 1024 / 1024))
    echo "å¯ç”¨ç©ºé—´: ${AVAILABLE_GB}G"
    
    if [ $AVAILABLE_GB -lt 20 ]; then
        echo "âš ï¸ è­¦å‘Š: åˆå§‹ç£ç›˜ç©ºé—´å¯èƒ½ä¸è¶³ (å½“å‰${AVAILABLE_GB}Gï¼Œå»ºè®®è‡³å°‘20G)"
    else
        echo "âœ… åˆå§‹ç£ç›˜ç©ºé—´å……è¶³"
    fi
    
    echo "ğŸ’» CPUä¿¡æ¯:"
    echo "  CPUæ ¸å¿ƒæ•°: $(nproc)"
    echo "  CPUå‹å·: $(grep "model name" /proc/cpuinfo | head -1 | cut -d':' -f2 | xargs || echo 'æœªçŸ¥')"
    
    echo "ğŸ§  å†…å­˜ä¿¡æ¯:"
    free -h
    
    log "âœ… æ­¥éª¤06 å®Œæˆ"
}

workflow_step07_create_build_dir() {
    log "=== æ­¥éª¤07: åˆ›å»ºæ„å»ºç›®å½• ==="
    
    set -e
    trap 'echo "âŒ æ­¥éª¤07 å¤±è´¥ï¼Œé€€å‡ºä»£ç : $?"; exit 1' ERR
    
    create_build_dir
    
    log "âœ… æ­¥éª¤07 å®Œæˆ"
}

workflow_step08_initialize_build_env() {
    local device_name="$1"
    local version_selection="$2"
    local config_mode="$3"
    
    log "=== æ­¥éª¤08: åˆå§‹åŒ–æ„å»ºç¯å¢ƒ ==="
    
    set -e
    trap 'echo "âŒ æ­¥éª¤08 å¤±è´¥ï¼Œé€€å‡ºä»£ç : $?"; exit 1' ERR
    
    initialize_build_env "$device_name" "$version_selection" "$config_mode"
    
    log "âœ… æ­¥éª¤08 å®Œæˆ"
}

workflow_step09_download_sdk() {
    local device_name="$1"
    
    log "=== æ­¥éª¤09: ä¸‹è½½OpenWrtå®˜æ–¹SDK ==="
    
    set -e
    trap 'echo "âŒ æ­¥éª¤09 å¤±è´¥ï¼Œé€€å‡ºä»£ç : $?"; exit 1' ERR
    
    initialize_compiler_env "$device_name"
    
    log "âœ… æ­¥éª¤09 å®Œæˆ"
}

# ä¿ç•™åŸæœ‰çš„å·²åºŸå¼ƒæœç´¢å‡½æ•°æ³¨é‡Šï¼Œä½†å‡½æ•°è¢«æ›¿æ¢
# search_compiler_files() {
#     log "=== æœç´¢ç¼–è¯‘å™¨æ–‡ä»¶ ==="
#     log "ğŸ” ä¸å†æœç´¢æœ¬åœ°ç¼–è¯‘å™¨ï¼Œå°†ä¸‹è½½OpenWrtå®˜æ–¹SDK"
#     return 1
# }
# 
# universal_compiler_search() {
#     log "=== é€šç”¨ç¼–è¯‘å™¨æœç´¢ ==="
#     log "ğŸ” ä¸å†æœç´¢æœ¬åœ°ç¼–è¯‘å™¨ï¼Œå°†ä¸‹è½½OpenWrtå®˜æ–¹SDK"
#     return 1
# }
# 
# search_compiler_files_simple() {
#     log "=== ç®€å•ç¼–è¯‘å™¨æ–‡ä»¶æœç´¢ ==="
#     log "ğŸ” ä¸å†æœç´¢æœ¬åœ°ç¼–è¯‘å™¨ï¼Œå°†ä¸‹è½½OpenWrtå®˜æ–¹SDK"
#     return 1
# }
# 
# intelligent_platform_aware_compiler_search() {
#     log "=== æ™ºèƒ½å¹³å°æ„ŸçŸ¥çš„ç¼–è¯‘å™¨æœç´¢ ==="
#     log "ğŸ” ä¸å†æœç´¢æœ¬åœ°ç¼–è¯‘å™¨ï¼Œå°†ä¸‹è½½OpenWrtå®˜æ–¹SDK"
#     return 1
# }
#ã€build_firmware_main.sh-42ã€‘

#ã€build_firmware_main.sh-13ã€‘
generate_config() {
    local extra_packages=$1
    load_env
    cd $BUILD_DIR || handle_error "è¿›å…¥æ„å»ºç›®å½•å¤±è´¥"
    
    log "=== æ™ºèƒ½é…ç½®ç”Ÿæˆç³»ç»Ÿï¼ˆè®¾å¤‡æ˜¾å¼æŒ‡å®šç‰ˆï¼‰ ==="
    log "ç‰ˆæœ¬: $SELECTED_BRANCH"
    log "ç›®æ ‡: $TARGET"
    log "å­ç›®æ ‡: $SUBTARGET"
    log "è®¾å¤‡: $DEVICE"
    log "é…ç½®æ¨¡å¼: $CONFIG_MODE"
    log "é…ç½®æ–‡ä»¶ç›®å½•: $CONFIG_DIR"
    
    # åˆ›å»º artifacts ç›®å½•
    ARTIFACTS_DIR="$REPO_ROOT/artifacts/step15-logs"
    mkdir -p "$ARTIFACTS_DIR"
    rm -f "$ARTIFACTS_DIR"/*.log "$ARTIFACTS_DIR"/missing-deps.txt 2>/dev/null || true
    
    rm -f .config .config.old .config.bak*
    log "âœ… å·²æ¸…ç†æ—§é…ç½®æ–‡ä»¶"
    
    # æ­¥éª¤1: åˆ›å»ºåŸºç¡€ç›®æ ‡é…ç½®ï¼ˆæ˜¾å¼æŒ‡å®šè®¾å¤‡ï¼‰
    cat > .config << EOF
CONFIG_TARGET_${TARGET}=y
CONFIG_TARGET_${TARGET}_${SUBTARGET}=y
CONFIG_TARGET_${TARGET}_${SUBTARGET}_DEVICE_${DEVICE}=y
EOF
    
    log "ğŸ”§ ç”ŸæˆåŸºç¡€é…ç½®..."
    make defconfig || handle_error "åŸºç¡€é…ç½®ç”Ÿæˆå¤±è´¥"
    log "âœ… åŸºç¡€é…ç½®ç”ŸæˆæˆåŠŸ"
    
    # æ­¥éª¤2: åˆå¹¶æ‰€æœ‰é…ç½®æ–‡ä»¶
    log "ğŸ“ å¼€å§‹åˆå¹¶é…ç½®æ–‡ä»¶..."
    
    # è¾…åŠ©å‡½æ•°ï¼šå®‰å…¨è¿½åŠ é…ç½®ï¼ˆè¿‡æ»¤æ³¨é‡Šå’Œç©ºè¡Œï¼‰
    append_config() {
        local file=$1
        if [ -f "$file" ]; then
            grep -v '^[[:space:]]*#' "$file" | grep -v '^[[:space:]]*$' | grep 'CONFIG_' >> .config
        fi
    }
    
    append_config "$CONFIG_DIR/base.config"
    append_config "$CONFIG_DIR/usb-generic.config"
    append_config "$CONFIG_DIR/$TARGET.config"
    append_config "$CONFIG_DIR/$SELECTED_BRANCH.config"
    append_config "$CONFIG_DIR/devices/$DEVICE.config"
    
    if [ "$CONFIG_MODE" = "normal" ]; then
        append_config "$CONFIG_DIR/normal.config"
    fi
    
    # æ·»åŠ é¢å¤–åŒ…
    if [ -n "$extra_packages" ]; then
        log "ğŸ“¦ æ·»åŠ é¢å¤–åŒ…: $extra_packages"
        echo "$extra_packages" | tr ',' '
' | while read pkg; do
            [ -n "$pkg" ] && echo "CONFIG_PACKAGE_$pkg=y" >> .config
        done
    fi
    
    # TCP BBR
    echo "CONFIG_PACKAGE_kmod-tcp-bbr=y" >> .config
    echo 'CONFIG_DEFAULT_TCP_CONG="bbr"' >> .config
    
    # TurboACCï¼ˆæ­£å¸¸æ¨¡å¼ï¼‰
    if [ "$CONFIG_MODE" = "normal" ]; then
        echo "CONFIG_PACKAGE_luci-app-turboacc=y" >> .config
        echo "CONFIG_PACKAGE_kmod-shortcut-fe=y" >> .config
        echo "CONFIG_PACKAGE_kmod-fast-classifier=y" >> .config
    fi
    
    # ath10k å†²çªè§£å†³
    sed -i '/CONFIG_PACKAGE_kmod-ath10k=y/d' .config
    sed -i '/CONFIG_PACKAGE_kmod-ath10k-pci=y/d' .config
    sed -i '/CONFIG_PACKAGE_kmod-ath10k-smallbuffers=y/d' .config
    echo "# CONFIG_PACKAGE_kmod-ath10k is not set" >> .config
    echo "# CONFIG_PACKAGE_kmod-ath10k-pci is not set" >> .config
    echo "# CONFIG_PACKAGE_kmod-ath10k-smallbuffers is not set" >> .config
    echo "CONFIG_PACKAGE_kmod-ath10k-ct=y" >> .config
    
    # æ­¥éª¤3: å»é‡
    sort .config | uniq > .config.tmp
    mv .config.tmp .config
    
    # æ­¥éª¤4: è¿è¡Œ make olddefconfig è§£å†³ä¾èµ–å…³ç³»ï¼ˆæ”¹ç”¨ yes "" | make oldconfigï¼‰
    log "ğŸ”„ è¿è¡Œ yes "" | make oldconfig è§£å†³ä¾èµ–å…³ç³»..."
    yes "" | make -j1 oldconfig V=s > /tmp/build-logs/oldconfig.log 2>&1 || {
        log "âŒ make oldconfig å¤±è´¥ï¼ŒæŸ¥çœ‹æ—¥å¿—..."
        tail -50 /tmp/build-logs/oldconfig.log
        # å¤åˆ¶æ—¥å¿—åˆ° artifacts
        cp /tmp/build-logs/oldconfig.log "$ARTIFACTS_DIR/" 2>/dev/null || true
        # æå–ç¼ºå¤±ä¾èµ–
        grep -E "WARNING:.*has a dependency on.*which does not exist" /tmp/build-logs/oldconfig.log > "$ARTIFACTS_DIR/missing-deps.txt" 2>/dev/null || true
        handle_error "ä¾èµ–è§£å†³å¤±è´¥"
    }
    # æ— è®ºæˆåŠŸä¸å¦ï¼Œå¤åˆ¶æ—¥å¿—å¹¶æå–ç¼ºå¤±ä¾èµ–
    cp /tmp/build-logs/oldconfig.log "$ARTIFACTS_DIR/" 2>/dev/null || true
    grep -E "WARNING:.*has a dependency on.*which does not exist" /tmp/build-logs/oldconfig.log >> "$ARTIFACTS_DIR/missing-deps.txt" 2>/dev/null || true
    log "âœ… ä¾èµ–å…³ç³»è§£å†³æˆåŠŸ"
    
    # æ­¥éª¤5: åå¤„ç†å¼ºåˆ¶å¯ç”¨å…³é”®USBè½¯ä»¶åŒ…ï¼ˆå¢å¼ºç‰ˆ + å¾ªç¯ä¿®å¤ï¼‰
    log "ğŸ”§ åå¤„ç†ï¼šå¼ºåˆ¶å¯ç”¨USBè½¯ä»¶åŒ…ï¼ˆå¢å¼ºç‰ˆï¼‰..."
    
    # å®šä¹‰æ‰€æœ‰å¹³å°å¿…éœ€çš„USBè½¯ä»¶åŒ…ï¼ˆæ‰©å±•åˆ—è¡¨ï¼‰
    local MUST_PACKAGES=(
        # æ ¸å¿ƒé©±åŠ¨
        "kmod-usb-core"
        "kmod-usb-common"
        # USB 2.0/3.0 æ§åˆ¶å™¨
        "kmod-usb2"
        "kmod-usb3"
        "kmod-usb-ehci"
        "kmod-usb-ohci"
        "kmod-usb-xhci-hcd"
        "kmod-usb-xhci-pci"
        "kmod-usb-xhci-plat-hcd"
        # USB å­˜å‚¨
        "kmod-usb-storage"
        "kmod-usb-storage-uas"
        "kmod-usb-storage-extras"
        # SCSI æ”¯æŒ
        "kmod-scsi-core"
        "kmod-scsi-generic"
        # é€šç”¨ USB é©±åŠ¨
        "kmod-usb-dwc3"
        "kmod-usb-dwc3-of-simple"
        # æ–‡ä»¶ç³»ç»Ÿ
        "kmod-fs-ext4"
        "kmod-fs-vfat"
        "kmod-fs-exfat"
        "kmod-fs-ntfs3"
        # ç¼–ç æ”¯æŒ
        "kmod-nls-utf8"
        "kmod-nls-cp936"
        # æŒ‚è½½å·¥å…·
        "block-mount"
        "automount"
        # å®ç”¨å·¥å…·
        "usbutils"
        "lsusb"
        # ä¸²å£æ”¯æŒï¼ˆå¯é€‰ä½†å¸¸ç”¨ï¼‰
        "kmod-usb-serial"
    )
    
    # å¹³å°ç‰¹å®šè½¯ä»¶åŒ…ï¼ˆæ‰©å±•ï¼‰
    case "$TARGET" in
        ipq40xx)
            MUST_PACKAGES+=(
                "kmod-usb-dwc3-qcom"
                "kmod-phy-qcom-dwc3"
            )
            ;;
        ramips)
            MUST_PACKAGES+=(
                "kmod-usb-xhci-mtk"
                "kmod-usb-ohci-pci"
                "kmod-usb2-pci"
            )
            ;;
        mediatek)
            MUST_PACKAGES+=(
                "kmod-usb-dwc3-mediatek"
                "kmod-phy-mediatek"
            )
            ;;
        ath79)
            MUST_PACKAGES+=(
                "kmod-usb2-ath79"
                "kmod-usb-ohci"
            )
            ;;
    esac
    
    # ç¬¬ä¸€æ¬¡å¼ºåˆ¶å†™å…¥
    for pkg in "${MUST_PACKAGES[@]}"; do
        sed -i "/^CONFIG_PACKAGE_${pkg}=/d" .config
        sed -i "/^# CONFIG_PACKAGE_${pkg} is not set/d" .config
        echo "CONFIG_PACKAGE_${pkg}=y" >> .config
    done
    
    # å†æ¬¡ç¡®ä¿è®¾å¤‡é€‰é¡¹å­˜åœ¨ï¼ˆé˜²æ­¢è¢«è¦†ç›–ï¼‰
    if ! grep -q "^CONFIG_TARGET_${TARGET}_${SUBTARGET}_DEVICE_${DEVICE}=y" .config; then
        echo "CONFIG_TARGET_${TARGET}_${SUBTARGET}_DEVICE_${DEVICE}=y" >> .config
    fi
    
    # å»é‡
    sort .config | uniq > .config.tmp
    mv .config.tmp .config
    
    # æ­¥éª¤6: å¾ªç¯ä¿®å¤USBé©±åŠ¨ï¼Œç›´åˆ°ç¨³å®šæˆ–è¾¾åˆ°æœ€å¤§å°è¯•æ¬¡æ•°
    local MAX_RETRIES=3
    local retry=0
    local fixed=0
    
    while [ $retry -lt $MAX_RETRIES ]; do
        retry=$((retry + 1))
        log "ğŸ”„ USBé©±åŠ¨ä¿®å¤å¾ªç¯ #$retry ..."
        
        # è¿è¡Œ yes "" | make oldconfig åº”ç”¨å½“å‰é…ç½®
        if ! yes "" | make -j1 oldconfig V=s > /tmp/build-logs/oldconfig2_$retry.log 2>&1; then
            log "âŒ make oldconfig å¤±è´¥ï¼ŒæŸ¥çœ‹æ—¥å¿—..."
            tail -50 /tmp/build-logs/oldconfig2_$retry.log
            cp /tmp/build-logs/oldconfig2_$retry.log "$ARTIFACTS_DIR/" 2>/dev/null || true
            grep -E "WARNING:.*has a dependency on.*which does not exist" /tmp/build-logs/oldconfig2_$retry.log >> "$ARTIFACTS_DIR/missing-deps.txt" 2>/dev/null || true
            # ä¸ä¸­æ–­ï¼Œå°è¯•ç»§ç»­
        else
            cp /tmp/build-logs/oldconfig2_$retry.log "$ARTIFACTS_DIR/" 2>/dev/null || true
            grep -E "WARNING:.*has a dependency on.*which does not exist" /tmp/build-logs/oldconfig2_$retry.log >> "$ARTIFACTS_DIR/missing-deps.txt" 2>/dev/null || true
        fi
        
        # æ£€æŸ¥å“ªäº›å¿…éœ€é©±åŠ¨ä»æœªå¯ç”¨
        local missing_pkgs=()
        for pkg in "${MUST_PACKAGES[@]}"; do
            if ! grep -q "^CONFIG_PACKAGE_${pkg}=y" .config; then
                missing_pkgs+=("$pkg")
            fi
        done
        
        if [ ${#missing_pkgs[@]} -eq 0 ]; then
            log "âœ… æ‰€æœ‰å¿…éœ€USBé©±åŠ¨å·²å¯ç”¨ï¼Œé€€å‡ºå¾ªç¯"
            fixed=1
            break
        fi
        
        log "âš ï¸ æœ¬è½®ä»æœ‰ ${#missing_pkgs[@]} ä¸ªé©±åŠ¨æœªå¯ç”¨: ${missing_pkgs[*]}"
        log "ğŸ”§ å†æ¬¡å¼ºåˆ¶æ·»åŠ ç¼ºå¤±é©±åŠ¨..."
        
        for pkg in "${missing_pkgs[@]}"; do
            sed -i "/^CONFIG_PACKAGE_${pkg}=/d" .config
            sed -i "/^# CONFIG_PACKAGE_${pkg} is not set/d" .config
            echo "CONFIG_PACKAGE_${pkg}=y" >> .config
        done
        
        # å»é‡
        sort .config | uniq > .config.tmp
        mv .config.tmp .config
    done
    
    if [ $fixed -eq 0 ]; then
        log "âš ï¸ ç»è¿‡ $MAX_RETRIES æ¬¡å¾ªç¯åï¼Œä»æœ‰é©±åŠ¨æœªå¯ç”¨ï¼Œç»§ç»­åç»­æ­¥éª¤"
    fi
    
    # æ­¥éª¤7: æœ€ç»ˆéªŒè¯è®¾å¤‡æ˜¯å¦è¢«é€‰ä¸­ï¼ˆå¢å¼ºç‰ˆï¼šæ™ºèƒ½åŒ¹é…ï¼‰
    log "ğŸ” æ­£åœ¨éªŒè¯è®¾å¤‡ $DEVICE æ˜¯å¦è¢«é€‰ä¸­..."
    
    local device_selected=""
    local device_patterns=(
        "^CONFIG_TARGET_DEVICE_.*${DEVICE}=y"
        "^CONFIG_TARGET_DEVICE_.*${DEVICE^^}=y"
        "^CONFIG_TARGET_DEVICE_.*${DEVICE,,}=y"
        "^CONFIG_TARGET_${TARGET}_${SUBTARGET}_DEVICE_${DEVICE}=y"
        "^CONFIG_TARGET_${TARGET}_${SUBTARGET}_DEVICE_${DEVICE^^}=y"
        "^CONFIG_TARGET_${TARGET}_${SUBTARGET}_DEVICE_${DEVICE,,}=y"
    )
    
    for pattern in "${device_patterns[@]}"; do
        device_selected=$(grep -E "$pattern" .config | head -1)
        if [ -n "$device_selected" ]; then
            log "âœ… ç›®æ ‡è®¾å¤‡å·²åŒ¹é…: $device_selected"
            break
        fi
    done
    
    if [ -z "$device_selected" ]; then
        log "âŒ é”™è¯¯: ç›®æ ‡è®¾å¤‡ $DEVICE æœªè¢«é€‰ä¸­ï¼"
        log "ğŸ” å°è¯•ä» .config ä¸­æå–æ‰€æœ‰å¯ç”¨è®¾å¤‡é€‰é¡¹è¿›è¡Œæ¨¡ç³ŠåŒ¹é…..."
        
        # æ”¶é›†æ‰€æœ‰è®¾å¤‡é€‰é¡¹
        local available_devices=$(grep -E '^CONFIG_TARGET_DEVICE_.*=y|^CONFIG_TARGET_.*_DEVICE_.*=y' .config | sed -E 's/^(CONFIG_TARGET_DEVICE_|CONFIG_TARGET_.*_DEVICE_)//' | sed 's/=y//')
        log "å¯ç”¨è®¾å¤‡é€‰é¡¹:"
        echo "$available_devices" | sed 's/^/  /'
        
        # å°è¯•æ¨¡ç³ŠåŒ¹é…ï¼ˆå¿½ç•¥å¤§å°å†™ã€ä¸‹åˆ’çº¿ï¼‰
        local matched_device=""
        local device_lower="${DEVICE,,}"
        local device_no_underscore="${device_lower//_/}"
        
        while IFS= read -r avail; do
            avail_lower="${avail,,}"
            avail_no_underscore="${avail_lower//_/}"
            if [ "$avail_lower" = "$device_lower" ] || [ "$avail_no_underscore" = "$device_no_underscore" ]; then
                matched_device="$avail"
                break
            fi
        done <<< "$available_devices"
        
        if [ -n "$matched_device" ]; then
            log "âœ… æ¨¡ç³ŠåŒ¹é…åˆ°è®¾å¤‡: $matched_device"
            log "ğŸ”§ æ­£åœ¨å¯ç”¨è®¾å¤‡ $matched_device ..."
            
            # ç¦ç”¨å…¶ä»–è®¾å¤‡é€‰é¡¹ï¼ˆå¯é€‰ï¼‰ï¼Œç›´æ¥å¯ç”¨åŒ¹é…çš„
            local config_tool=""
            if [ -f "scripts/config/config" ] && [ -x "scripts/config/config" ]; then
                config_tool="scripts/config/config"
            elif [ -f "scripts/config/conf" ] && [ -x "scripts/config/conf" ]; then
                config_tool="scripts/config/conf"
            fi
            
            if [ -n "$config_tool" ]; then
                $config_tool --enable "TARGET_DEVICE_${matched_device}" 2>/dev/null || true
                $config_tool --enable "TARGET_${TARGET}_${SUBTARGET}_DEVICE_${matched_device}" 2>/dev/null || true
            else
                echo "CONFIG_TARGET_DEVICE_${matched_device}=y" >> .config
                echo "CONFIG_TARGET_${TARGET}_${SUBTARGET}_DEVICE_${matched_device}=y" >> .config
            fi
            
            # å»é‡å¹¶é‡æ–°è¿è¡Œ defconfig
            sort .config | uniq > .config.tmp
            mv .config.tmp .config
            
            log "ğŸ”„ é‡æ–°è¿è¡Œ make defconfig ä»¥åº”ç”¨è®¾å¤‡é€‰æ‹©..."
            if make defconfig > /tmp/build-logs/defconfig_fix.log 2>&1; then
                log "âœ… make defconfig ä¿®å¤æˆåŠŸ"
                cp /tmp/build-logs/defconfig_fix.log "$ARTIFACTS_DIR/" 2>/dev/null || true
                device_selected="CONFIG_TARGET_DEVICE_${matched_device}=y"
            else
                log "âŒ make defconfig ä¿®å¤å¤±è´¥"
                cat /tmp/build-logs/defconfig_fix.log
                cp /tmp/build-logs/defconfig_fix.log "$ARTIFACTS_DIR/" 2>/dev/null || true
            fi
        else
            # è‹¥æ— æ¨¡ç³ŠåŒ¹é…ï¼Œå›é€€åˆ°åŸä¿®å¤é€»è¾‘ï¼ˆå†™å…¥å¤šç§æ ¼å¼ï¼‰
            log "âš ï¸ æ— æ¨¡ç³ŠåŒ¹é…ï¼Œå°è¯•ç›´æ¥å†™å…¥å¤šç§è®¾å¤‡æ ¼å¼..."
            local config_tool=""
            if [ -f "scripts/config/config" ] && [ -x "scripts/config/config" ]; then
                config_tool="scripts/config/config"
            elif [ -f "scripts/config/conf" ] && [ -x "scripts/config/conf" ]; then
                config_tool="scripts/config/conf"
            fi
            
            local device_upper="${DEVICE^^}"
            local device_lower="${DEVICE,,}"
            local device_capital="$(echo ${DEVICE:0:1} | tr '[:lower:]' '[:upper:]')${DEVICE:1}"
            
            if [ -n "$config_tool" ]; then
                $config_tool --enable TARGET_DEVICE_${TARGET}_${SUBTARGET}_DEVICE_${device_lower} 2>/dev/null || true
                $config_tool --enable TARGET_DEVICE_${TARGET}_${SUBTARGET}_DEVICE_${device_upper} 2>/dev/null || true
                $config_tool --enable TARGET_DEVICE_${TARGET}_${SUBTARGET}_DEVICE_${device_capital} 2>/dev/null || true
                $config_tool --enable TARGET_${TARGET}_${SUBTARGET}_DEVICE_${device_lower} 2>/dev/null || true
                $config_tool --enable TARGET_${TARGET}_${SUBTARGET}_DEVICE_${device_upper} 2>/dev/null || true
                $config_tool --enable TARGET_${TARGET}_${SUBTARGET}_DEVICE_${device_capital} 2>/dev/null || true
            else
                echo "CONFIG_TARGET_DEVICE_${TARGET}_${SUBTARGET}_DEVICE_${device_lower}=y" >> .config
                echo "CONFIG_TARGET_DEVICE_${TARGET}_${SUBTARGET}_DEVICE_${device_upper}=y" >> .config
                echo "CONFIG_TARGET_DEVICE_${TARGET}_${SUBTARGET}_DEVICE_${device_capital}=y" >> .config
                echo "CONFIG_TARGET_${TARGET}_${SUBTARGET}_DEVICE_${device_lower}=y" >> .config
                echo "CONFIG_TARGET_${TARGET}_${SUBTARGET}_DEVICE_${device_upper}=y" >> .config
                echo "CONFIG_TARGET_${TARGET}_${SUBTARGET}_DEVICE_${device_capital}=y" >> .config
            fi
            
            sort .config | uniq > .config.tmp
            mv .config.tmp .config
            
            log "ğŸ”„ é‡æ–°è¿è¡Œ make defconfig ä»¥åº”ç”¨è®¾å¤‡é€‰æ‹©..."
            if make defconfig > /tmp/build-logs/defconfig_fix.log 2>&1; then
                log "âœ… make defconfig ä¿®å¤æˆåŠŸ"
                cp /tmp/build-logs/defconfig_fix.log "$ARTIFACTS_DIR/" 2>/dev/null || true
                
                for pattern in "${device_patterns[@]}"; do
                    device_selected=$(grep -E "$pattern" .config | head -1)
                    if [ -n "$device_selected" ]; then
                        log "âœ… ä¿®å¤åè®¾å¤‡å·²é€‰ä¸­: $device_selected"
                        break
                    fi
                done
            else
                log "âŒ make defconfig ä¿®å¤å¤±è´¥"
                cat /tmp/build-logs/defconfig_fix.log
                cp /tmp/build-logs/defconfig_fix.log "$ARTIFACTS_DIR/" 2>/dev/null || true
            fi
        fi
    fi
    
    if [ -z "$device_selected" ]; then
        # æœ€ç»ˆå¤±è´¥
        log "âŒ é”™è¯¯: æ— æ³•è‡ªåŠ¨ä¿®å¤è®¾å¤‡é€‰æ‹©é—®é¢˜"
        log "è¯·æ£€æŸ¥è®¾å¤‡åç§°æ˜¯å¦æ­£ç¡®ï¼Œæˆ–æ‰‹åŠ¨é…ç½®è®¾å¤‡ã€‚"
        log "å½“å‰å¯ç”¨çš„è®¾å¤‡é€‰é¡¹ï¼ˆå‰20ä¸ªï¼‰:"
        grep -E "^CONFIG_TARGET_DEVICE_.*=y|^CONFIG_TARGET_.*_DEVICE_.*=y" .config | head -20 | sed 's/^/  /' || echo "  æ²¡æœ‰å¯ç”¨çš„è®¾å¤‡é€‰é¡¹"
        # å†æ¬¡ä¿å­˜å¯ç”¨è®¾å¤‡é€‰é¡¹
        grep -E "^CONFIG_TARGET_DEVICE_.*=y|^CONFIG_TARGET_.*_DEVICE_.*=y" .config > "$ARTIFACTS_DIR/available-devices.txt" 2>/dev/null || true
        handle_error "è®¾å¤‡é…ç½®é”™è¯¯"
    fi
    
    # å°†æœ€ç»ˆçš„ .config å¤åˆ¶åˆ° artifacts
    cp .config "$ARTIFACTS_DIR/config-final" 2>/dev/null || true
    
    # å¦‚æœç¼ºå¤±ä¾èµ–æ–‡ä»¶ä¸ä¸ºç©ºï¼Œè¾“å‡ºæç¤º
    if [ -s "$ARTIFACTS_DIR/missing-deps.txt" ]; then
        log "âš ï¸ å‘ç°ç¼ºå¤±ä¾èµ–ï¼Œè¯¦æƒ…è§ $ARTIFACTS_DIR/missing-deps.txt"
    fi
    
    log "âœ… é…ç½®ç”Ÿæˆå®Œæˆ"
}
#ã€build_firmware_main.sh-13-endã€‘

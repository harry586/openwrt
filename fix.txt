#ã€build_firmware_main.sh-99ã€‘
main() {
    local command="$1"
    local arg1="$2"
    local arg2="$3"
    local arg3="$4"
    local arg4="$5"
    local arg5="$6"

    # åªåœ¨é¦–æ¬¡è°ƒç”¨ä¸»å‡½æ•°æ—¶åŠ è½½é…ç½®
    if [ -z "$MAIN_CONFIG_LOADED" ]; then
        if [ -f "$REPO_ROOT/build-config.conf" ] && [ -z "$CONFIG_LOADED" ]; then
            source "$REPO_ROOT/build-config.conf"
            load_build_config
        fi
        export MAIN_CONFIG_LOADED=1
    fi

    case "$command" in
        "setup_environment")
            setup_environment
            ;;
        "create_build_dir")
            create_build_dir
            ;;
        "initialize_build_env")
            initialize_build_env "$arg1" "$arg2" "$arg3"
            ;;
        "initialize_compiler_env")
            initialize_compiler_env "$arg1"
            ;;
        "add_turboacc_support")
            add_turboacc_support
            ;;
        "configure_feeds")
            configure_feeds
            ;;
        "install_turboacc_packages")
            install_turboacc_packages
            ;;
        "pre_build_space_check")
            pre_build_space_check
            ;;
        "generate_config")
            generate_config "$arg1"
            ;;
        "verify_usb_config")
            verify_usb_config
            ;;
        "check_usb_drivers_integrity")
            check_usb_drivers_integrity
            ;;
        "apply_config")
            apply_config
            ;;
        "fix_network")
            fix_network
            ;;
        "download_dependencies")
            download_dependencies
            ;;
        "integrate_custom_files")
            integrate_custom_files
            ;;
        "cleanup")
            cleanup
            ;;
        "save_source_code_info")
            save_source_code_info
            ;;
        "verify_compiler_files")
            verify_compiler_files
            ;;
        "check_compiler_invocation")
            check_compiler_invocation
            ;;
        "verify_sdk_directory")
            verify_sdk_directory
            ;;
        "verify_config_files")
            verify_config_files
            ;;

        "step05_install_basic_tools")
            workflow_step05_install_basic_tools
            ;;
        "step06_initial_space_check")
            workflow_step06_initial_space_check
            ;;
        "step07_create_build_dir")
            workflow_step07_create_build_dir
            ;;
        "step08_initialize_build_env")
            workflow_step08_initialize_build_env "$arg1" "$arg2" "$arg3"
            ;;
        "step08_initialize_build_env_hybrid")
            workflow_step08_initialize_build_env_hybrid "$arg1" "$arg2" "$arg3" "$arg4" "$arg5"
            ;;
        "step09_download_sdk")
            workflow_step09_download_sdk "$arg1"
            ;;
        "step10_verify_sdk")
            workflow_step10_verify_sdk
            ;;
        "step11_add_turboacc")
            workflow_step11_add_turboacc
            ;;
        "step12_configure_feeds")
            workflow_step12_configure_feeds
            ;;
        "step13_install_turboacc")
            workflow_step13_install_turboacc
            ;;
        "step14_pre_build_space_check")
            workflow_step14_pre_build_space_check
            ;;
        "step15_generate_config")
            workflow_step15_generate_config "$arg1"
            ;;
        "step16_verify_usb")
            workflow_step16_verify_usb
            ;;
        "step17_check_usb_drivers")
            workflow_step17_check_usb_drivers
            ;;
        "step20_fix_network")
            workflow_step20_fix_network
            ;;
        "step21_download_deps")
            workflow_step21_download_deps
            ;;
        "step22_integrate_custom_files")
            workflow_step22_integrate_custom_files
            ;;
        "step23_pre_build_check")
            workflow_step23_pre_build_check
            ;;
        "step25_build_firmware")
            workflow_step25_build_firmware "$arg1"
            ;;
        "step26_check_artifacts")
            workflow_step26_check_artifacts
            ;;
        "step29_post_build_space_check")
            workflow_step29_post_build_space_check
            ;;
        "step30_build_summary")
            workflow_step30_build_summary "$arg1" "$arg2" "$arg3" "$arg4" "$arg5"
            ;;

        "search_compiler_files")
            universal_compiler_search "$arg1" "$arg2"
            ;;
        "universal_compiler_search")
            universal_compiler_search "$arg1" "$arg2"
            ;;
        "search_compiler_files_simple")
            search_compiler_files_simple "$arg1" "$arg2"
            ;;
        "intelligent_platform_aware_compiler_search")
            intelligent_platform_aware_compiler_search "$arg1" "$arg2" "$arg3"
            ;;

        *)
            log "âŒ æœªçŸ¥å‘½ä»¤: $command"
            echo "å¯ç”¨å‘½ä»¤:"
            echo "  åŸºç¡€å‡½æ•°: setup_environment, create_build_dir, initialize_build_env, etc."
            echo ""
            echo "  å·¥ä½œæµæ­¥éª¤å‘½ä»¤:"
            echo "    step05_install_basic_tools, step06_initial_space_check, step07_create_build_dir"
            echo "    step08_initialize_build_env, step08_initialize_build_env_hybrid, step09_download_sdk, step10_verify_sdk"
            echo "    step11_add_turboacc, step12_configure_feeds, step13_install_turboacc"
            echo "    step14_pre_build_space_check, step15_generate_config, step16_verify_usb"
            echo "    step17_check_usb_drivers, step20_fix_network, step21_download_deps"
            echo "    step22_integrate_custom_files, step23_pre_build_check, step25_build_firmware"
            echo "    step26_check_artifacts, step29_post_build_space_check, step30_build_summary"
            exit 1
            ;;
    esac
}

if [ $# -eq 0 ]; then
    echo "é”™è¯¯: éœ€è¦æä¾›å‘½ä»¤å‚æ•°"
    echo "ç”¨æ³•: $0 <å‘½ä»¤> [å‚æ•°1] [å‚æ•°2] [å‚æ•°3] [å‚æ•°4] [å‚æ•°5]"
    echo "ä¾‹å¦‚: $0 step08_initialize_build_env xiaomi_mi-router-4a-100m 23.05 normal"
    exit 1
fi

main "$@"
#ã€build_firmware_main.sh-99-endã€‘

#ã€build_firmware_main.sh-06ã€‘
initialize_build_env() {
    local device_name=$1
    local version_selection=$2
    local config_mode=$3
    local manual_target=$4   # å¯é€‰ï¼Œæ‰‹åŠ¨æŒ‡å®šçš„èŠ¯ç‰‡å‹å·
    local manual_subtarget=$5 # å¯é€‰ï¼Œæ‰‹åŠ¨æŒ‡å®šçš„å­å¹³å°

    cd $BUILD_DIR || handle_error "è¿›å…¥æ„å»ºç›®å½•å¤±è´¥"

    log "=== ç‰ˆæœ¬é€‰æ‹© ==="
    if [ "$version_selection" = "23.05" ]; then
        SELECTED_REPO_URL="${IMMORTALWRT_URL:-https://github.com/immortalwrt/immortalwrt.git}"
        SELECTED_BRANCH="${BRANCH_23_05:-openwrt-23.05}"
    else
        SELECTED_REPO_URL="${IMMORTALWRT_URL:-https://github.com/immortalwrt/immortalwrt.git}"
        SELECTED_BRANCH="${BRANCH_21_02:-openwrt-21.02}"
    fi
    log "âœ… ç‰ˆæœ¬é€‰æ‹©å®Œæˆ: $SELECTED_BRANCH"

    log "=== å…‹éš†æºç  ==="
    log "ä»“åº“: $SELECTED_REPO_URL"
    log "åˆ†æ”¯: $SELECTED_BRANCH"

    sudo rm -rf ./* ./.git* 2>/dev/null || true

    git clone --depth 1 --branch "$SELECTED_BRANCH" "$SELECTED_REPO_URL" . || handle_error "å…‹éš†æºç å¤±è´¥"
    log "âœ… æºç å…‹éš†å®Œæˆ"

    local important_source_files=("Makefile" "feeds.conf.default" "rules.mk" "Config.in")
    for file in "${important_source_files[@]}"; do
        if [ -f "$file" ]; then
            log "âœ… æºç æ–‡ä»¶å­˜åœ¨: $file"
        else
            log "âŒ æºç æ–‡ä»¶ç¼ºå¤±: $file"
        fi
    done

    log "=== è®¾å¤‡é…ç½® ==="
    # åˆ¤æ–­æ˜¯å¦ä½¿ç”¨æ‰‹åŠ¨è¾“å…¥çš„èŠ¯ç‰‡å‹å·å’Œå­å¹³å°
    if [ -n "$manual_target" ] && [ -n "$manual_subtarget" ]; then
        TARGET="$manual_target"
        SUBTARGET="$manual_subtarget"
        DEVICE="$device_name"
        log "âœ… ä½¿ç”¨æ‰‹åŠ¨æŒ‡å®šçš„å¹³å°ä¿¡æ¯: TARGET=$TARGET, SUBTARGET=$SUBTARGET"
    elif [ -f "$SUPPORT_SCRIPT" ]; then
        log "ğŸ” è°ƒç”¨support.shè·å–è®¾å¤‡å¹³å°ä¿¡æ¯..."
        PLATFORM_INFO=$("$SUPPORT_SCRIPT" get-platform "$device_name")
        if [ -n "$PLATFORM_INFO" ]; then
            TARGET=$(echo "$PLATFORM_INFO" | awk '{print $1}')
            SUBTARGET=$(echo "$PLATFORM_INFO" | awk '{print $2}')
            DEVICE="$device_name"
            log "âœ… ä»support.shè·å–å¹³å°ä¿¡æ¯: TARGET=$TARGET, SUBTARGET=$SUBTARGET"
        else
            log "âŒ æ— æ³•ä»support.shè·å–å¹³å°ä¿¡æ¯"
            handle_error "è·å–å¹³å°ä¿¡æ¯å¤±è´¥"
        fi
    else
        log "âŒ support.shä¸å­˜åœ¨ä¸”æœªæ‰‹åŠ¨æŒ‡å®šå¹³å°ä¿¡æ¯"
        handle_error "æ— æ³•ç¡®å®šå¹³å°ä¿¡æ¯"
    fi

    log "ğŸ”§ è®¾å¤‡: $device_name"
    log "ğŸ”§ ç›®æ ‡å¹³å°: $TARGET/$SUBTARGET"

    CONFIG_MODE="$config_mode"

    log "ç›®æ ‡: $TARGET"
    log "å­ç›®æ ‡: $SUBTARGET"
    log "è®¾å¤‡: $DEVICE"
    log "é…ç½®æ¨¡å¼: $CONFIG_MODE"

    # ğŸ”¥ å…³é”®ä¿®å¤ï¼šæ­£ç¡®è¯†åˆ«å’Œä½¿ç”¨ç¼–è¯‘å¥½çš„ config å·¥å…·
    log "=== ç¼–è¯‘é…ç½®å·¥å…· ==="

    local config_tool_created=0
    local real_config_tool=""

    # æ–¹æ³•1: ç¼–è¯‘ scripts/config
    log "ğŸ”§ å°è¯•æ–¹æ³•1: ç¼–è¯‘ scripts/config..."
    if [ -d "scripts/config" ]; then
        cd scripts/config
        make
        cd $BUILD_DIR

        # æ£€æŸ¥ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶
        if [ -f "scripts/config/conf" ] && [ -x "scripts/config/conf" ]; then
            log "âœ… æ–¹æ³•1æˆåŠŸ: ç¼–è¯‘ç”Ÿæˆ conf å·¥å…·"

            # åˆ›å»º config åŒ…è£…è„šæœ¬ï¼Œä½¿ç”¨ conf
            mkdir -p scripts/config
            cat > scripts/config/config << 'EOF'
#!/bin/sh
# OpenWrt config å·¥å…·åŒ…è£…è„šæœ¬
# ä½¿ç”¨ç¼–è¯‘ç”Ÿæˆçš„ conf å·¥å…·

CONF_TOOL="$(dirname "$0")/conf"

if [ ! -x "$CONF_TOOL" ]; then
    echo "Error: conf tool not found" >&2
    exit 1
fi

# è½¬æ¢å‚æ•°æ ¼å¼
case "$1" in
    --enable)
        shift
        "$CONF_TOOL" --defconfig CONFIG_$1=y .config
        ;;
    --disable)
        shift
        "$CONF_TOOL" --defconfig CONFIG_$1=n .config
        ;;
    --module)
        shift
        "$CONF_TOOL" --defconfig CONFIG_$1=m .config
        ;;
    --set-str)
        shift
        name="$1"
        value="$2"
        "$CONF_TOOL" --defconfig CONFIG_$name="$value" .config
        shift 2
        ;;
    *)
        "$CONF_TOOL" "$@"
        ;;
esac
EOF
            chmod +x scripts/config/config
            log "âœ… åˆ›å»º config åŒ…è£…è„šæœ¬æˆåŠŸ"
            real_config_tool="scripts/config/config"
            config_tool_created=1
        elif [ -f "scripts/config/config" ] && [ -x "scripts/config/config" ]; then
            log "âœ… æ–¹æ³•1æˆåŠŸ: ç¼–è¯‘ç”Ÿæˆ config å·¥å…·"
            real_config_tool="scripts/config/config"
            config_tool_created=1
        fi
    fi

    # æ–¹æ³•2: ç›´æ¥ä½¿ç”¨ conf ä½œä¸ºé…ç½®å·¥å…·
    if [ $config_tool_created -eq 0 ]; then
        if [ -f "scripts/config/conf" ] && [ -x "scripts/config/conf" ]; then
            log "âœ… æ–¹æ³•2æˆåŠŸ: ç›´æ¥ä½¿ç”¨ conf å·¥å…·"
            mkdir -p scripts/config
            cat > scripts/config/config << 'EOF'
#!/bin/sh
# ä½¿ç”¨ conf å·¥å…·çš„åŒ…è£…è„šæœ¬
exec "$(dirname "$0")/conf" "$@"
EOF
            chmod +x scripts/config/config
            real_config_tool="scripts/config/config"
            config_tool_created=1
        fi
    fi

    # æ–¹æ³•3: ä½¿ç”¨ mconf (å¦‚æœå¯ç”¨)
    if [ $config_tool_created -eq 0 ]; then
        if [ -f "scripts/config/mconf" ] && [ -x "scripts/config/mconf" ]; then
            log "âœ… æ–¹æ³•3æˆåŠŸ: ä½¿ç”¨ mconf å·¥å…·"
            mkdir -p scripts/config
            cat > scripts/config/config << 'EOF'
#!/bin/sh
# ä½¿ç”¨ mconf å·¥å…·çš„åŒ…è£…è„šæœ¬
exec "$(dirname "$0")/mconf" "$@"
EOF
            chmod +x scripts/config/config
            real_config_tool="scripts/config/config"
            config_tool_created=1
        fi
    fi

    # æ–¹æ³•4: ä» SDK å¤åˆ¶
    if [ $config_tool_created -eq 0 ] && [ -n "$COMPILER_DIR" ]; then
        log "ğŸ”§ å°è¯•æ–¹æ³•4: ä» SDK ç›®å½•å¤åˆ¶"
        if [ -f "$COMPILER_DIR/scripts/config/conf" ] && [ -x "$COMPILER_DIR/scripts/config/conf" ]; then
            mkdir -p scripts/config
            cp "$COMPILER_DIR/scripts/config/conf" scripts/config/
            cat > scripts/config/config << 'EOF'
#!/bin/sh
exec "$(dirname "$0")/conf" "$@"
EOF
            chmod +x scripts/config/config
            log "âœ… æ–¹æ³•4æˆåŠŸ: ä» SDK å¤åˆ¶ conf å·¥å…·"
            real_config_tool="scripts/config/config"
            config_tool_created=1
        fi
    fi

    # æ–¹æ³•5: åˆ›å»ºåŠŸèƒ½å®Œæ•´çš„ç®€æ˜“å·¥å…·
    if [ $config_tool_created -eq 0 ]; then
        log "ğŸ”§ æ–¹æ³•5: åˆ›å»ºåŠŸèƒ½å®Œæ•´çš„ç®€æ˜“ config å·¥å…·"
        mkdir -p scripts/config
        cat > scripts/config/config << 'EOF'
#!/bin/bash
# åŠŸèƒ½å®Œæ•´çš„ config å·¥å…·
CONFIG_FILE=".config"

show_help() {
    echo "Usage: config [options]"
    echo "  --enable <symbol>    Enable a configuration option"
    echo "  --disable <symbol>   Disable a configuration option"
    echo "  --module <symbol>    Set a configuration option as module"
    echo "  --set-str <name> <value> Set a string configuration option"
}

# ç¡®ä¿ .config å­˜åœ¨
if [ ! -f "$CONFIG_FILE" ]; then
    touch "$CONFIG_FILE"
fi

case "$1" in
    --enable)
        shift
        symbol="$1"
        # ç§»é™¤ CONFIG_ å‰ç¼€ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        symbol="${symbol#CONFIG_}"
        # ç§»é™¤ PACKAGE_ å‰ç¼€ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        symbol="${symbol#PACKAGE_}"

        # åˆ é™¤æ‰€æœ‰ç›¸å…³çš„è¡Œ
        sed -i "/^CONFIG_${symbol}=/d" "$CONFIG_FILE"
        sed -i "/^CONFIG_PACKAGE_${symbol}=/d" "$CONFIG_FILE"
        sed -i "/^# CONFIG_${symbol} is not set/d" "$CONFIG_FILE"
        sed -i "/^# CONFIG_PACKAGE_${symbol} is not set/d" "$CONFIG_FILE"

        # æ·»åŠ å¯ç”¨è¡Œ
        echo "CONFIG_PACKAGE_${symbol}=y" >> "$CONFIG_FILE"
        ;;
    --disable)
        shift
        symbol="$1"
        symbol="${symbol#CONFIG_}"
        symbol="${symbol#PACKAGE_}"

        sed -i "/^CONFIG_${symbol}=/d" "$CONFIG_FILE"
        sed -i "/^CONFIG_PACKAGE_${symbol}=/d" "$CONFIG_FILE"
        sed -i "/^# CONFIG_${symbol} is not set/d" "$CONFIG_FILE"
        sed -i "/^# CONFIG_PACKAGE_${symbol} is not set/d" "$CONFIG_FILE"

        echo "# CONFIG_PACKAGE_${symbol} is not set" >> "$CONFIG_FILE"
        ;;
    --module)
        shift
        symbol="$1"
        symbol="${symbol#CONFIG_}"
        symbol="${symbol#PACKAGE_}"

        sed -i "/^CONFIG_${symbol}=/d" "$CONFIG_FILE"
        sed -i "/^CONFIG_PACKAGE_${symbol}=/d" "$CONFIG_FILE"
        sed -i "/^# CONFIG_${symbol} is not set/d" "$CONFIG_FILE"
        sed -i "/^# CONFIG_PACKAGE_${symbol} is not set/d" "$CONFIG_FILE"

        echo "CONFIG_PACKAGE_${symbol}=m" >> "$CONFIG_FILE"
        ;;
    --set-str)
        shift
        name="$1"
        value="$2"
        name="${name#CONFIG_}"

        sed -i "/^CONFIG_${name}=/d" "$CONFIG_FILE"
        echo "CONFIG_${name}="$value"" >> "$CONFIG_FILE"
        shift 2
        ;;
    --help)
        show_help
        ;;
    *)
        echo "Unknown option: $1"
        show_help
        exit 1
        ;;
esac
EOF
        chmod +x scripts/config/config
        log "âœ… æ–¹æ³•5æˆåŠŸ: åˆ›å»ºåŠŸèƒ½å®Œæ•´çš„ç®€æ˜“ config å·¥å…·"
        real_config_tool="scripts/config/config"
        config_tool_created=1
    fi

    # åˆ›å»ºç»Ÿä¸€è°ƒç”¨æ¥å£ - ä¿®å¤ç‰ˆï¼Œä¸ä½¿ç”¨ --help æµ‹è¯•
    if [ $config_tool_created -eq 1 ]; then
        log "ğŸ”§ åˆ›å»ºç»Ÿä¸€è°ƒç”¨æ¥å£..."

        # è®°å½•çœŸå®å·¥å…·è·¯å¾„
        echo "$real_config_tool" > scripts/.config_tool_path

        # åˆ›å»º scripts/config è½¯é“¾æ¥æˆ–å‰¯æœ¬ï¼Œä»¥ä¾¿ make defconfig èƒ½æ‰¾åˆ°
        if [ ! -f "scripts/config" ]; then
            if [ -f "scripts/config/config" ]; then
                ln -sf config scripts/config 2>/dev/null || cp scripts/config/config scripts/config 2>/dev/null || true
                log "âœ… åˆ›å»º scripts/config é“¾æ¥/å‰¯æœ¬"
            fi
        fi

        cat > scripts/config-tool << 'EOF'
#!/bin/sh
# ç»Ÿä¸€ config å·¥å…·è°ƒç”¨æ¥å£
CONFIG_TOOL_PATH="$(dirname "$0")/.config_tool_path"

if [ -f "$CONFIG_TOOL_PATH" ]; then
    CONFIG_TOOL="$(cat "$CONFIG_TOOL_PATH" 2>/dev/null)"
    if [ -n "$CONFIG_TOOL" ] && [ -f "$CONFIG_TOOL" ] && [ -x "$CONFIG_TOOL" ]; then
        exec "$CONFIG_TOOL" "$@"
    fi
fi

# å¤‡é€‰1: ç›´æ¥æŸ¥æ‰¾
if [ -f "scripts/config/config" ] && [ -x "scripts/config/config" ]; then
    echo "scripts/config/config" > "$CONFIG_TOOL_PATH"
    exec scripts/config/config "$@"
fi

# å¤‡é€‰2: ä½¿ç”¨ conf
if [ -f "scripts/config/conf" ] && [ -x "scripts/config/conf" ]; then
    echo "scripts/config/conf" > "$CONFIG_TOOL_PATH"
    exec scripts/config/conf "$@"
fi

# å¤‡é€‰3: ä½¿ç”¨ mconf
if [ -f "scripts/config/mconf" ] && [ -x "scripts/config/mconf" ]; then
    echo "scripts/config/mconf" > "$CONFIG_TOOL_PATH"
    exec scripts/config/mconf "$@"
fi

echo "Error: config tool not found" >&2
exit 1
EOF
        chmod +x scripts/config-tool
        log "âœ… ç»Ÿä¸€è°ƒç”¨æ¥å£åˆ›å»ºæˆåŠŸ: scripts/config-tool"

        # ä¸å†æµ‹è¯• --helpï¼Œè€Œæ˜¯æµ‹è¯•åŸºæœ¬åŠŸèƒ½
        if scripts/config-tool --version > /dev/null 2>&1 || scripts/config-tool -h > /dev/null 2>&1; then
            log "âœ… ç»Ÿä¸€è°ƒç”¨æ¥å£æµ‹è¯•é€šè¿‡"
        else
            # å°è¯•æµ‹è¯•æ˜¯å¦å­˜åœ¨
            if [ -f scripts/config/config ] || [ -f scripts/config/conf ]; then
                log "âœ… ç»Ÿä¸€è°ƒç”¨æ¥å£å¯ç”¨ï¼ˆè·³è¿‡å‚æ•°æµ‹è¯•ï¼‰"
            else
                log "âš ï¸ ç»Ÿä¸€è°ƒç”¨æ¥å£å¯èƒ½æœ‰é—®é¢˜ï¼Œä½†å·¥å…·å¯èƒ½ä»å¯ç”¨"
            fi
        fi
    fi

    # æœ€ç»ˆéªŒè¯
    if [ $config_tool_created -eq 1 ]; then
        log "âœ… é…ç½®å·¥å…·æœ€ç»ˆéªŒè¯é€šè¿‡"
        log "ğŸ“ çœŸå®å·¥å…·è·¯å¾„: $real_config_tool"
        log "ğŸ“ ç»Ÿä¸€è°ƒç”¨æ¥å£: scripts/config-tool"

        # æ˜¾ç¤ºå·¥å…·ä¿¡æ¯
        if [ -f "$real_config_tool" ]; then
            if file "$real_config_tool" | grep -q "ELF"; then
                log "ğŸ“‹ å·¥å…·ç±»å‹: å·²ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶"
            else
                log "ğŸ“‹ å·¥å…·ç±»å‹: Shell è„šæœ¬"
            fi
        fi
    else
        log "âŒ æ‰€æœ‰æ–¹æ³•éƒ½å¤±è´¥ï¼Œé…ç½®å·¥å…·ä¸å­˜åœ¨"
        handle_error "æ— æ³•åˆ›å»ºé…ç½®å·¥å…·"
    fi

    save_env

    echo "SELECTED_REPO_URL=$SELECTED_REPO_URL" >> $GITHUB_ENV
    echo "SELECTED_BRANCH=$SELECTED_BRANCH" >> $GITHUB_ENV
    echo "TARGET=$TARGET" >> $GITHUB_ENV
    echo "SUBTARGET=$SUBTARGET" >> $GITHUB_ENV
    echo "DEVICE=$DEVICE" >> $GITHUB_ENV
    echo "CONFIG_MODE=$CONFIG_MODE" >> $GITHUB_ENV

    log "âœ… æ„å»ºç¯å¢ƒåˆå§‹åŒ–å®Œæˆ"
}
#ã€build_firmware_main.sh-06-endã€‘

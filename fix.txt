#ã€build_firmware_main.sh-04ã€‘è®¾å¤‡æ”¯æŒå‡½æ•°ï¼ˆä¿®å¤ç‰ˆï¼‰
load_device_support() {
    # ä¿®å¤ï¼šæ”¯æŒå¤šä¸ªå¯èƒ½çš„ support.sh è·¯å¾„
    # åŒ…æ‹¬ GitHub Actions å·¥ä½œåŒºè·¯å¾„å’Œå¸¸è§è·¯å¾„
    local possible_paths=(
        "$SUPPORT_DIR/support.sh"                              # åŸå§‹è·¯å¾„
        "$REPO_ROOT/firmware-config/support.sh"                # ç›¸å¯¹è·¯å¾„
        "/home/runner/work/openwrt/openwrt/firmware-config/support.sh"  # GitHub Actions å›ºå®šè·¯å¾„
        "$REPO_ROOT/support.sh"                                # æ ¹ç›®å½•
        "support.sh"                                           # å½“å‰ç›®å½•
    )
    
    # å¦‚æœæœ‰ GITHUB_WORKSPACE ç¯å¢ƒå˜é‡ï¼Œä¹Ÿå°è¯•
    if [ -n "$GITHUB_WORKSPACE" ]; then
        possible_paths+=(
            "$GITHUB_WORKSPACE/firmware-config/support.sh"
            "$GITHUB_WORKSPACE/support.sh"
        )
    fi
    
    log "ğŸ” å¼€å§‹æŸ¥æ‰¾è®¾å¤‡æ”¯æŒè„šæœ¬..."
    log "  å½“å‰ç›®å½•: $(pwd)"
    log "  REPO_ROOT: $REPO_ROOT"
    log "  SUPPORT_DIR: $SUPPORT_DIR"
    
    for support_file in "${possible_paths[@]}"; do
        if [ -f "$support_file" ]; then
            log "âœ… æ‰¾åˆ°è®¾å¤‡æ”¯æŒè„šæœ¬: $support_file"
            # æ£€æŸ¥æ–‡ä»¶å¤§å°
            local file_size=$(wc -l < "$support_file" 2>/dev/null || echo "0")
            log "  æ–‡ä»¶å¤§å°: $file_size è¡Œ"
            
            # å°è¯•åŠ è½½
            if source "$support_file" 2>/dev/null; then
                log "âœ… åŠ è½½è®¾å¤‡æ”¯æŒè„šæœ¬æˆåŠŸ"
                return 0
            else
                log "âš ï¸ åŠ è½½è®¾å¤‡æ”¯æŒè„šæœ¬å¤±è´¥: $support_file"
            fi
        fi
    done
    
    # å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œä½¿ç”¨ find å‘½ä»¤æœç´¢
    log "âš ï¸ æœªåœ¨é¢„è®¾è·¯å¾„æ‰¾åˆ° support.shï¼Œå¼€å§‹å…¨ç›®å½•æœç´¢..."
    local found_files=$(find "$REPO_ROOT" -name "support.sh" -type f 2>/dev/null | head -5)
    
    if [ -n "$found_files" ]; then
        log "ğŸ” æ‰¾åˆ°ä»¥ä¸‹ support.sh æ–‡ä»¶:"
        while IFS= read -r found_file; do
            if [ -f "$found_file" ]; then
                log "  ğŸ“ $found_file"
                if source "$found_file" 2>/dev/null; then
                    log "âœ… åŠ è½½è®¾å¤‡æ”¯æŒè„šæœ¬æˆåŠŸ"
                    return 0
                fi
            fi
        done <<< "$found_files"
    fi
    
    log "âŒ æ— æ³•åŠ è½½è®¾å¤‡æ”¯æŒè„šæœ¬ï¼Œä½¿ç”¨é»˜è®¤é…ç½®"
    return 1
}

# åŠ è½½é…ç½®æ¨¡æ¿
load_config_template() {
    local template_name="$1"
    # ä¿®å¤ï¼šé…ç½®æ–‡ä»¶åœ¨ firmware-config/config/ ç›®å½•ä¸‹
    local template_file="$SUPPORT_DIR/config/${template_name}.config"
    
    if [ -f "$template_file" ]; then
        log "ğŸ“‹ åŠ è½½é…ç½®æ¨¡æ¿: $template_name"
        cat "$template_file" >> .config
        return 0
    else
        log "âš ï¸ é…ç½®æ¨¡æ¿ä¸å­˜åœ¨: $template_file"
        return 1
    fi
}

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenWrtå›ºä»¶æ„å»ºå™¨</title>
    <style>
        :root {
            --primary: #2ea44f;
            --primary-dark: #2c974b;
            --bg: #f6f8fa;
            --card-bg: #ffffff;
            --text: #24292e;
            --text-light: #586069;
            --border: #e1e4e8;
            --shadow: 0 1px 3px rgba(27,31,35,0.12), 0 8px 24px rgba(66,74,83,0.12);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--text);
        }
        
        .subtitle {
            color: var(--text-light);
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
            font-size: 1rem;
        }
        
        select, input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
            background: white;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(46, 164, 79, 0.2);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .checkbox-group input {
            width: auto;
            transform: scale(1.2);
        }
        
        .btn {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 164, 79, 0.2);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .alert.success {
            background: #f0fff4;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .alert.error {
            background: #ffeef0;
            border: 2px solid #f97583;
            color: #d73a49;
        }
        
        .alert.warning {
            background: #fff8f0;
            border: 2px solid #e36209;
            color: #e36209;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .device-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .device-tag {
            padding: 10px;
            background: var(--bg);
            border-radius: 6px;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .device-tag:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }
        
        .device-tag.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary-dark);
        }
        
        .info-box {
            background: var(--bg);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
        }
        
        .info-box h3 {
            margin-bottom: 10px;
            color: var(--text);
        }
        
        .status-card {
            background: var(--bg);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        
        .status-card.show {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .github-link {
            color: var(--primary);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .github-link:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            header {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .device-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ—ï¸ OpenWrtå›ºä»¶æ„å»ºå™¨</h1>
            <p class="subtitle">æ— éœ€ç™»å½•ï¼Œæ— éœ€Tokenï¼Œä¸€é”®æ„å»ºå®šåˆ¶å›ºä»¶</p>
            <a href="https://github.com/YOUR_USERNAME/YOUR_REPO" class="github-link" target="_blank">
                <span>ğŸ™</span> æŸ¥çœ‹GitHubä»“åº“
            </a>
        </header>
        
        <div class="card">
            <div id="alert" class="alert"></div>
            
            <form id="buildForm">
                <div class="form-group">
                    <label>ğŸ“± é€‰æ‹©è®¾å¤‡</label>
                    <select id="device" name="device" required>
                        <option value="">æ­£åœ¨åŠ è½½è®¾å¤‡åˆ—è¡¨...</option>
                    </select>
                    <div class="device-grid" id="deviceGrid"></div>
                </div>
                
                <div class="form-group">
                    <label>ğŸ”„ OpenWrtç‰ˆæœ¬</label>
                    <select id="version" name="version" required>
                        <option value="21.02">21.02 - ç¨³å®šç‰ˆ</option>
                        <option value="23.05">23.05 - æ–°ç‰ˆ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>âš™ï¸ é…ç½®æ¨¡å¼</label>
                    <select id="mode" name="mode" required>
                        <option value="base">ğŸŸ£ åŸºç¡€æ¨¡å¼ - æœ€å°åŒ–é…ç½®</option>
                        <option value="normal" selected>ğŸŸ  æ­£å¸¸æ¨¡å¼ - å®Œæ•´åŠŸèƒ½</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>ğŸ“¦ é¢å¤–æ’ä»¶ (å¯é€‰)</label>
                    <input type="text" id="packages" name="packages" 
                           placeholder="ä¾‹å¦‚: +luci-app-ddns;-luci-app-upnp">
                    <small style="color: var(--text-light); display: block; margin-top: 5px;">
                        æ ¼å¼: +æ’ä»¶å;-æ’ä»¶å ç”¨åˆ†å·;åˆ†éš”
                    </small>
                </div>
                
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="parallel" name="parallel" checked>
                        <label for="parallel" style="margin-bottom: 0;">
                            âš¡ å¯ç”¨æ™ºèƒ½å¹¶è¡Œä¼˜åŒ–
                        </label>
                    </div>
                </div>
                
                <button type="submit" class="btn" id="submitBtn" disabled>
                    <span>ğŸš€</span> å¼€å§‹æ„å»ºå›ºä»¶
                </button>
            </form>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>æ­£åœ¨æäº¤æ„å»ºè¯·æ±‚...</p>
            </div>
            
            <div class="status-card" id="statusCard">
                <h3>ğŸ“‹ æ„å»ºçŠ¶æ€</h3>
                <div class="status-item">
                    <span>âœ…</span>
                    <span>æ„å»ºè¯·æ±‚å·²æäº¤</span>
                </div>
                <div class="status-item">
                    <span>â³</span>
                    <span>æ­£åœ¨ç­‰å¾…GitHub Actionså¼€å§‹è¿è¡Œ...</span>
                </div>
                <p style="margin-top: 10px; color: var(--text-light); font-size: 0.9rem;">
                    è¯·å‰å¾€ <a href="#" id="actionsLink" target="_blank" style="color: var(--primary);">GitHub Actionsé¡µé¢</a> æŸ¥çœ‹è¯¦ç»†è¿›åº¦
                </p>
            </div>
        </div>
        
        <div class="info-box">
            <h3>ğŸ“ ä½¿ç”¨è¯´æ˜</h3>
            <p>1. é€‰æ‹©è®¾å¤‡å’Œé…ç½®æ¨¡å¼</p>
            <p>2. ç‚¹å‡»"å¼€å§‹æ„å»º"æŒ‰é’®</p>
            <p>3. ç­‰å¾…GitHub Actionså®Œæˆæ„å»º</p>
            <p>4. åœ¨Actionsé¡µé¢ä¸‹è½½ç”Ÿæˆçš„å›ºä»¶</p>
        </div>
        
        <div class="info-box">
            <h3>ğŸ¯ æ­£å¸¸æ¨¡å¼åŒ…å«çš„åŠŸèƒ½</h3>
            <p>TurboACCç½‘ç»œåŠ é€Ÿã€Sambaæ–‡ä»¶å…±äº«ã€ç£ç›˜ç®¡ç†ã€SmartDNSæ™ºèƒ½DNSã€å®¶é•¿æ§åˆ¶ã€å¾®ä¿¡æ¨é€ã€æµé‡æ§åˆ¶ã€FTPæœåŠ¡å™¨ç­‰å®Œæ•´åŠŸèƒ½ã€‚</p>
        </div>
        
        <footer>
            <p>Â© 2024 OpenWrtå›ºä»¶æ„å»ºå™¨ | åŸºäºGitHub Actionsè‡ªåŠ¨æ„å»º | 
                <a href="https://github.com/YOUR_USERNAME/YOUR_REPO/blob/main/README.md" 
                   class="github-link">æŸ¥çœ‹æ–‡æ¡£</a>
            </p>
        </footer>
    </div>

    <script>
        // =============== é…ç½® ===============
        const CONFIG = {
            REPO_OWNER: 'YOUR_USERNAME',      // ä¿®æ”¹ä¸ºä½ çš„GitHubç”¨æˆ·å
            REPO_NAME: 'YOUR_REPO',           // ä¿®æ”¹ä¸ºä½ çš„ä»“åº“å
            WORKFLOW_FILE: 'firmware-build.yml',
            SUPPORT_FILE: 'support.sh'
        };
        
        // =============== çŠ¶æ€ç®¡ç† ===============
        let state = {
            devices: [],
            isLoading: false,
            lastBuildId: null
        };
        
        // =============== DOMå…ƒç´  ===============
        const elements = {
            deviceSelect: document.getElementById('device'),
            deviceGrid: document.getElementById('deviceGrid'),
            buildForm: document.getElementById('buildForm'),
            submitBtn: document.getElementById('submitBtn'),
            loading: document.getElementById('loading'),
            alert: document.getElementById('alert'),
            statusCard: document.getElementById('statusCard'),
            actionsLink: document.getElementById('actionsLink')
        };
        
        // =============== åˆå§‹åŒ– ===============
        document.addEventListener('DOMContentLoaded', () => {
            init();
        });
        
        async function init() {
            // åŠ è½½è®¾å¤‡åˆ—è¡¨
            await loadDevices();
            
            // è®¾ç½®è¡¨å•äº‹ä»¶
            setupFormEvents();
            
            // æ£€æŸ¥URLå‚æ•°
            checkUrlParams();
        }
        
        // =============== åŠ è½½è®¾å¤‡åˆ—è¡¨ ===============
        async function loadDevices() {
            try {
                showAlert('æ­£åœ¨åŠ è½½è®¾å¤‡åˆ—è¡¨...', 'warning');
                
                // ä»GitHub rawè·å–support.shæ–‡ä»¶
                const response = await fetch(
                    `https://raw.githubusercontent.com/${CONFIG.REPO_OWNER}/${CONFIG.REPO_NAME}/main/${CONFIG.SUPPORT_FILE}`
                );
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const content = await response.text();
                state.devices = extractDevices(content);
                
                if (state.devices.length === 0) {
                    throw new Error('æœªæ‰¾åˆ°è®¾å¤‡å®šä¹‰');
                }
                
                updateDeviceUI();
                hideAlert();
                
            } catch (error) {
                console.error('åŠ è½½è®¾å¤‡åˆ—è¡¨å¤±è´¥:', error);
                // ä½¿ç”¨é»˜è®¤è®¾å¤‡åˆ—è¡¨ä½œä¸ºåå¤‡
                state.devices = ['ac42u', 'acrh17', 'ax6s', 'ax6', '360t7', 'wr30u'];
                updateDeviceUI();
                showAlert(`ä½¿ç”¨é»˜è®¤è®¾å¤‡åˆ—è¡¨: ${error.message}`, 'warning');
            }
        }
        
        function extractDevices(content) {
            const devices = new Set();
            
            // å¤šç§æ–¹å¼æå–è®¾å¤‡å
            const patterns = [
                /get_device_config\s*\(\s*["']([^"']+)["']/g,
                /DEVICE_[A-Z_]+\s*=\s*["']([^"']+)["']/g,
                /["'](ac42u|acrh17|ax6s|ax6|360t7|wr30u)["']/g
            ];
            
            patterns.forEach(pattern => {
                let match;
                while ((match = pattern.exec(content)) !== null) {
                    devices.add(match[1]?.trim() || match[0]?.replace(/["']/g, ''));
                }
            });
            
            // è¿‡æ»¤æ— æ•ˆå€¼å¹¶æ’åº
            return Array.from(devices)
                .filter(device => device && device.length > 2)
                .sort();
        }
        
        function updateDeviceUI() {
            // æ›´æ–°ä¸‹æ‹‰é€‰æ‹©
            elements.deviceSelect.innerHTML = '<option value="">è¯·é€‰æ‹©è®¾å¤‡</option>';
            state.devices.forEach(device => {
                const option = document.createElement('option');
                option.value = device;
                option.textContent = device;
                elements.deviceSelect.appendChild(option);
            });
            
            // æ›´æ–°è®¾å¤‡ç½‘æ ¼
            elements.deviceGrid.innerHTML = '';
            state.devices.forEach(device => {
                const tag = document.createElement('div');
                tag.className = 'device-tag';
                tag.textContent = device;
                tag.title = `ç‚¹å‡»é€‰æ‹© ${device}`;
                tag.addEventListener('click', () => {
                    elements.deviceSelect.value = device;
                    // ç§»é™¤å…¶ä»–æ ‡ç­¾çš„é€‰ä¸­çŠ¶æ€
                    document.querySelectorAll('.device-tag').forEach(t => 
                        t.classList.remove('selected'));
                    tag.classList.add('selected');
                });
                elements.deviceGrid.appendChild(tag);
            });
            
            // å¯ç”¨æäº¤æŒ‰é’®
            elements.submitBtn.disabled = false;
        }
        
        // =============== è¡¨å•äº‹ä»¶å¤„ç† ===============
        function setupFormEvents() {
            // è¡¨å•æäº¤
            elements.buildForm.addEventListener('submit', handleSubmit);
            
            // è®¾å¤‡é€‰æ‹©å˜åŒ–æ—¶æ›´æ–°æ ‡ç­¾é€‰ä¸­çŠ¶æ€
            elements.deviceSelect.addEventListener('change', function() {
                const selectedDevice = this.value;
                document.querySelectorAll('.device-tag').forEach(tag => {
                    tag.classList.toggle('selected', tag.textContent === selectedDevice);
                });
            });
        }
        
        // =============== å¤„ç†è¡¨å•æäº¤ ===============
        async function handleSubmit(event) {
            event.preventDefault();
            
            if (state.isLoading) return;
            
            const formData = {
                device: elements.deviceSelect.value,
                version: document.getElementById('version').value,
                mode: document.getElementById('mode').value,
                packages: document.getElementById('packages').value.trim(),
                parallel: document.getElementById('parallel').checked
            };
            
            // éªŒè¯è¡¨å•
            if (!validateForm(formData)) return;
            
            // å¼€å§‹æäº¤
            state.isLoading = true;
            updateUIState(true);
            
            try {
                // ä½¿ç”¨GitHub APIè§¦å‘å·¥ä½œæµ
                const result = await triggerWorkflow(formData);
                
                if (result.success) {
                    showSuccess(result);
                    
                    // æ›´æ–°çŠ¶æ€å¡ç‰‡
                    elements.actionsLink.href = result.html_url;
                    elements.statusCard.classList.add('show');
                    
                    // 5ç§’åè‡ªåŠ¨è·³è½¬åˆ°Actionsé¡µé¢
                    setTimeout(() => {
                        window.open(result.html_url, '_blank');
                    }, 3000);
                    
                    // 3åˆ†é’Ÿåé‡ç½®è¡¨å•
                    setTimeout(() => {
                        resetForm();
                    }, 180000);
                    
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                showAlert(`âŒ æäº¤å¤±è´¥: ${error.message}`, 'error');
                state.isLoading = false;
                updateUIState(false);
            }
        }
        
        function validateForm(data) {
            if (!data.device) {
                showAlert('è¯·é€‰æ‹©è®¾å¤‡', 'error');
                return false;
            }
            
            if (!state.devices.includes(data.device)) {
                showAlert(`è®¾å¤‡"${data.device}"ä¸åœ¨æ”¯æŒåˆ—è¡¨ä¸­`, 'error');
                return false;
            }
            
            return true;
        }
        
        // =============== è§¦å‘GitHubå·¥ä½œæµ ===============
        async function triggerWorkflow(data) {
            // å…³é”®ï¼šä½¿ç”¨GitHubçš„workflow_dispatch API
            // æ³¨æ„ï¼šç”±äºæµè§ˆå™¨çš„åŒæºç­–ç•¥é™åˆ¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨GitHub Pagesçš„ç‰¹æ®Šæ–¹å¼
            // æˆ–è€…ä½¿ç”¨GitHubçš„repository_dispatch
            
            try {
                // æ–¹æ³•1ï¼šä½¿ç”¨GitHub Pagesçš„ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚æœé¡µé¢ä¸ä»“åº“åŒæºï¼‰
                const apiPath = `/workflow_dispatch/${CONFIG.WORKFLOW_FILE}`;
                
                // æ–¹æ³•2ï¼šä½¿ç”¨GitHub APIï¼ˆéœ€è¦å¤„ç†CORSï¼‰
                // å¯¹äºGitHub Pagesï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªä¸­é—´é¡µé¢çš„æ–¹å¼
                
                // è¿™é‡Œä½¿ç”¨ä¸€ä¸ªç®€å•çš„fetchåˆ°GitHub API
                // æ³¨æ„ï¼šåœ¨GitHub Pagesä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨GitHubçš„ä¸Šä¸‹æ–‡
                const response = await fetch(
                    `https://api.github.com/repos/${CONFIG.REPO_OWNER}/${CONFIG.REPO_NAME}/actions/workflows/${CONFIG.WORKFLOW_FILE}/dispatches`,
                    {
                        method: 'POST',
                        headers: {
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json',
                            // åœ¨GitHub Pagesç¯å¢ƒä¸­ï¼ŒGitHubä¼šå¤„ç†è®¤è¯
                            // å¯¹äºå…¬å¼€ä»“åº“çš„workflow_dispatchï¼Œå¯ä»¥ç›´æ¥è§¦å‘
                        },
                        body: JSON.stringify({
                            ref: 'main',
                            inputs: {
                                device_name: data.device,
                                version_selection: data.version,
                                config_mode: data.mode,
                                extra_packages: data.packages,
                                enable_parallel: data.parallel ? 'true' : 'false'
                            }
                        })
                    }
                );
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP ${response.status}`);
                }
                
                const result = await response.json();
                
                return {
                    success: true,
                    run_id: result.id,
                    html_url: `https://github.com/${CONFIG.REPO_OWNER}/${CONFIG.REPO_NAME}/actions`,
                    message: 'æ„å»ºè¯·æ±‚å·²æäº¤'
                };
                
            } catch (error) {
                console.error('è§¦å‘å·¥ä½œæµå¤±è´¥:', error);
                
                // å¦‚æœç›´æ¥APIè°ƒç”¨å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨repository_dispatchæ–¹å¼
                return await triggerRepositoryDispatch(data);
            }
        }
        
        // =============== å¤‡é€‰æ–¹æ¡ˆï¼šä½¿ç”¨repository_dispatch ===============
        async function triggerRepositoryDispatch(data) {
            try {
                // repository_dispatchä¸éœ€è¦ç‰¹æ®Šæƒé™
                const response = await fetch(
                    `https://api.github.com/repos/${CONFIG.REPO_OWNER}/${CONFIG.REPO_NAME}/dispatches`,
                    {
                        method: 'POST',
                        headers: {
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json',
                            // å¯¹äºå…¬å¼€ä»“åº“ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨
                        },
                        body: JSON.stringify({
                            event_type: `build-firmware-${data.device}`,
                            client_payload: {
                                device: data.device,
                                version: data.version,
                                mode: data.mode,
                                packages: data.packages,
                                parallel: data.parallel
                            }
                        })
                    }
                );
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                return {
                    success: true,
                    html_url: `https://github.com/${CONFIG.REPO_OWNER}/${CONFIG.REPO_NAME}/actions`,
                    message: 'æ„å»ºè¯·æ±‚å·²é€šè¿‡repository_dispatchæäº¤'
                };
                
            } catch (error) {
                // å¦‚æœæ‰€æœ‰APIæ–¹å¼éƒ½å¤±è´¥ï¼Œæä¾›æ‰‹åŠ¨è§¦å‘é“¾æ¥
                return {
                    success: true,
                    html_url: getManualTriggerUrl(data),
                    message: 'è¯·ç‚¹å‡»é“¾æ¥æ‰‹åŠ¨è§¦å‘æ„å»º'
                };
            }
        }
        
        // =============== ç”Ÿæˆæ‰‹åŠ¨è§¦å‘é“¾æ¥ ===============
        function getManualTriggerUrl(data) {
            // ç”ŸæˆGitHub Actionsæ‰‹åŠ¨è§¦å‘é¡µé¢çš„URL
            const params = new URLSearchParams({
                'inputs.device_name': data.device,
                'inputs.version_selection': data.version,
                'inputs.config_mode': data.mode,
                'inputs.extra_packages': data.packages,
                'inputs.enable_parallel': data.parallel ? 'true' : 'false'
            });
            
            return `https://github.com/${CONFIG.REPO_OWNER}/${CONFIG.REPO_NAME}/actions/workflows/${CONFIG.WORKFLOW_FILE}?${params}`;
        }
        
        // =============== UIè¾…åŠ©å‡½æ•° ===============
        function showAlert(message, type = 'info') {
            elements.alert.textContent = message;
            elements.alert.className = `alert ${type}`;
            elements.alert.style.display = 'block';
            
            // è‡ªåŠ¨éšè—éé”™è¯¯æç¤º
            if (type !== 'error') {
                setTimeout(() => {
                    hideAlert();
                }, 5000);
            }
        }
        
        function hideAlert() {
            elements.alert.style.display = 'none';
        }
        
        function showSuccess(result) {
            showAlert(`âœ… ${result.message}`, 'success');
        }
        
        function updateUIState(isLoading) {
            elements.submitBtn.disabled = isLoading;
            elements.loading.style.display = isLoading ? 'block' : 'none';
            elements.submitBtn.innerHTML = isLoading ? 
                '<span>â³</span> æäº¤ä¸­...' : 
                '<span>ğŸš€</span> å¼€å§‹æ„å»ºå›ºä»¶';
        }
        
        function resetForm() {
            elements.buildForm.reset();
            document.getElementById('parallel').checked = true;
            elements.statusCard.classList.remove('show');
            document.querySelectorAll('.device-tag').forEach(tag => 
                tag.classList.remove('selected'));
            state.isLoading = false;
            updateUIState(false);
        }
        
        // =============== URLå‚æ•°å¤„ç† ===============
        function checkUrlParams() {
            const params = new URLSearchParams(window.location.search);
            
            if (params.has('device')) {
                const device = params.get('device');
                if (state.devices.includes(device)) {
                    elements.deviceSelect.value = device;
                    // è§¦å‘changeäº‹ä»¶
                    elements.deviceSelect.dispatchEvent(new Event('change'));
                }
            }
            
            if (params.has('version')) {
                const version = params.get('version');
                if (version === '21.02' || version === '23.05') {
                    document.getElementById('version').value = version;
                }
            }
            
            if (params.has('mode')) {
                const mode = params.get('mode');
                if (mode === 'base' || mode === 'normal') {
                    document.getElementById('mode').value = mode;
                }
            }
        }
    </script>
</body>
</html>

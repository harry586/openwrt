# .github/workflows/firmware-build.yml
name: OpenWrt æ™ºèƒ½å›ºä»¶æ„å»ºå·¥ä½œæµ

on:
  workflow_dispatch:
    inputs:
      device_name:
        description: "ğŸ“± è®¾å¤‡åç§° (è‡ªåŠ¨ä» support.sh åŒæ­¥) - å½“å‰æ”¯æŒ: acrh17, cmcc_rax3000m, netgear_3800"
        required: true
        type: choice
        default: "acrh17"
        options:
          - "acrh17"
          - "cmcc_rax3000m"
          - "netgear_3800"
      version_selection:
        description: "ğŸ”„ ç‰ˆæœ¬é€‰æ‹©"
        required: true
        type: choice
        default: "21.02"
        options: ["23.05", "21.02"]
      config_mode:
        description: "âš™ï¸ é…ç½®æ¨¡å¼é€‰æ‹© - ğŸŸ£ åŸºç¡€æ¨¡å¼ - æœ€å°åŒ–é…ç½®ï¼Œç”¨äºæµ‹è¯•ç¼–è¯‘ã€‚ğŸŸ  æ­£å¸¸æ¨¡å¼ - å®Œæ•´åŠŸèƒ½é…ç½®ï¼šâœ… TurboACC ç½‘ç»œåŠ é€Ÿ âœ… UPnP è‡ªåŠ¨ç«¯å£è½¬å‘ âœ… Samba æ–‡ä»¶å…±äº« âœ… ç£ç›˜ç®¡ç† âœ… KMS æ¿€æ´»æœåŠ¡ âœ… SmartDNS æ™ºèƒ½DNS âœ… å®¶é•¿æ§åˆ¶ âœ… å¾®ä¿¡æ¨é€ âœ… æµé‡æ§åˆ¶ (SQM) âœ… FTP æœåŠ¡å™¨ âœ… ARP ç»‘å®š âœ… CPU é™åˆ¶ âœ… ç¡¬ç›˜ä¼‘çœ "
        required: true
        type: choice
        default: "normal"
        options: ["base", "normal"]
      source_repo:
        description: "ğŸ“¦ æºä»£ç ä»“åº“é€‰æ‹© - ğŸ”„ ImmortalWrt (é»˜è®¤) âš¡ LEDE (å›½å†…ä¼˜åŒ–)"
        required: true
        type: choice
        default: "immortalwrt"
        options: ["immortalwrt", "lede"]
      extra_packages:
        description: "é¢å¤–å®‰è£…æ’ä»¶ - æ ¼å¼ï¼šç”¨åˆ†å·;åˆ†éš”ã€‚å¯ç”¨æ’ä»¶ï¼š+æ’ä»¶åã€‚ç¦ç”¨æ’ä»¶ï¼š-æ’ä»¶åã€‚"
        required: false
        type: string
        default: ""
      enable_parallel:
        description: "âš¡ å¯ç”¨æ™ºèƒ½å¹¶è¡Œä¼˜åŒ– (è‡ªåŠ¨åˆ¤æ–­æœ€ä½³ä»»åŠ¡æ•°)"
        required: false
        type: choice
        default: "true"
        options: ["true", "false"]

env:
  BUILD_DIR: "/mnt/openwrt-build"
  REPO_ROOT: "${{ github.workspace }}"
  ENABLE_PARALLEL: "${{ github.event.inputs.enable_parallel }}"

jobs:
  build-firmware:
    runs-on: ubuntu-22.04
    
    steps:
      #ã€firmware-build.yml-01ã€‘æ­¥éª¤ 0: åªç”Ÿæˆæ—¶é—´æˆ³ï¼ˆç®€åŒ–ï¼‰
      - name: "0. åªç”Ÿæˆæ—¶é—´æˆ³"
        run: |
          echo "=== æ­¥éª¤ 0: ç”Ÿæˆæ—¶é—´æˆ³ ==="
          echo "ğŸ• å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          # ç”Ÿæˆæ—¶é—´æˆ³
          BASE_DATE=$(date -u +'%Y%m%d')
          TIMESTAMP="${{ github.event.inputs.device_name }}-${{ github.event.inputs.version_selection }}-${{ github.event.inputs.config_mode }}-${{ github.event.inputs.source_repo }}-$BASE_DATE"
          
          echo "TIMESTAMP=$TIMESTAMP" >> $GITHUB_ENV
          
          echo "âœ… ç”Ÿæˆæ—¶é—´æˆ³: $TIMESTAMP"
          echo "ğŸ“‹ æ„å»ºé…ç½®:"
          echo "  è®¾å¤‡: ${{ github.event.inputs.device_name }}"
          echo "  ç‰ˆæœ¬: ${{ github.event.inputs.version_selection }}"
          echo "  æ¨¡å¼: ${{ github.event.inputs.config_mode }}"
          echo "  æºä»£ç ä»“åº“: ${{ github.event.inputs.source_repo }}"
          echo "  å¹¶è¡Œä¼˜åŒ–: ${{ github.event.inputs.enable_parallel }}"
          
          echo "ğŸŸ¢ æ­¥éª¤ 0 å®Œæˆ"
          echo "ğŸ’¡ æ³¨æ„: è®¾å¤‡åŒæ­¥æ£€æŸ¥å°†åœ¨æ­¥éª¤1ä¸‹è½½æ–‡ä»¶åè¿›è¡Œ"

      #ã€firmware-build.yml-02ã€‘æ­¥éª¤ 1: ä½¿ç”¨Git Archive APIä¸‹è½½æºä»£ç å¹¶æ£€æŸ¥è®¾å¤‡
      - name: "1. ä½¿ç”¨Git Archive APIä¸‹è½½æºä»£ç å¹¶æ£€æŸ¥è®¾å¤‡"
        run: |
          echo "=== æ­¥éª¤ 1: ä½¿ç”¨Git Archive APIä¸‹è½½æºä»£ç å¹¶æ£€æŸ¥è®¾å¤‡ ==="
          echo "ğŸ• å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          # è®¾ç½®é”™è¯¯å¤„ç†
          set -e
          trap 'echo "âŒ æ­¥éª¤ 1 å¤±è´¥ï¼Œé€€å‡ºä»£ç : $?"; exit 1' ERR
          
          # åˆ›å»ºä¸´æ—¶ç›®å½•
          mkdir -p /tmp/openwrt-source
          cd /tmp/openwrt-source
          
          # è·å–é»˜è®¤åˆ†æ”¯
          echo "ğŸ” è·å–ä»“åº“é»˜è®¤åˆ†æ”¯..."
          DEFAULT_BRANCH=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" "https://api.github.com/repos/${{ github.repository }}" | jq -r '.default_branch')
          echo "âœ… é»˜è®¤åˆ†æ”¯: $DEFAULT_BRANCH"
          
          # ä½¿ç”¨Git Archive APIä¸‹è½½å‹ç¼©åŒ…
          echo "ğŸ“¥ ä¸‹è½½æºä»£ç å‹ç¼©åŒ…..."
          curl -s -L -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" "https://api.github.com/repos/${{ github.repository }}/tarball/$DEFAULT_BRANCH" -o source.tar.gz
          
          if [ ! -f "source.tar.gz" ]; then
            echo "âŒ é”™è¯¯: ä¸‹è½½æºä»£ç å‹ç¼©åŒ…å¤±è´¥"
            exit 1
          fi
          
          echo "âœ… ä¸‹è½½å®Œæˆï¼Œæ–‡ä»¶å¤§å°: $(ls -lh source.tar.gz | awk '{print $5}')"
          
          # è§£å‹å‹ç¼©åŒ…
          echo "ğŸ“¦ è§£å‹æºä»£ç ..."
          tar -xzf source.tar.gz --strip-components=1
          
          # æ£€æŸ¥è§£å‹ç»“æœ
          echo "ğŸ” æ£€æŸ¥è§£å‹ç»“æœ..."
          if [ -f "firmware-config/scripts/build_firmware_main.sh" ]; then
            echo "âœ… æºä»£ç è§£å‹æˆåŠŸ"
            echo "âœ… é‡è¦æ–‡ä»¶å­˜åœ¨: firmware-config/scripts/build_firmware_main.sh"
            
            # ç°åœ¨æ£€æŸ¥è®¾å¤‡æ”¯æŒæ–‡ä»¶
            echo ""
            echo "ğŸ” æ£€æŸ¥è®¾å¤‡æ”¯æŒæ–‡ä»¶..."
            
            SUPPORT_FILE="firmware-config/support.sh"
            
            if [ -f "$SUPPORT_FILE" ]; then
              echo "âœ… è®¾å¤‡æ”¯æŒæ–‡ä»¶å­˜åœ¨: $SUPPORT_FILE"
              echo "ğŸ“„ æ–‡ä»¶å¤§å°: $(ls -lh "$SUPPORT_FILE" | awk '{print $5}')"
              
              # ç«‹å³è¿›è¡Œè®¾å¤‡æ£€æŸ¥ï¼ˆå› ä¸ºæ–‡ä»¶åœ¨ä¸´æ—¶ç›®å½•ä¸­ï¼‰
              echo ""
              echo "ğŸ§ª è¿›è¡Œè®¾å¤‡åŒæ­¥æ£€æŸ¥..."
              
              if source "$SUPPORT_FILE" 2>/dev/null; then
                echo "âœ… æˆåŠŸåŠ è½½è®¾å¤‡æ”¯æŒè„šæœ¬"
                
                if command -v get_all_devices >/dev/null 2>&1; then
                  SUPPORTED_DEVICES=$(get_all_devices 2>/dev/null || echo "æ— æ³•æ‰§è¡Œget_all_devices")
                  echo "ğŸ“± support.sh ä¸­æ”¯æŒçš„è®¾å¤‡: $SUPPORTED_DEVICES"
                  
                  SELECTED_DEVICE="${{ github.event.inputs.device_name }}"
                  echo "ğŸ¯ å½“å‰é€‰æ‹©çš„è®¾å¤‡: $SELECTED_DEVICE"
                  
                  # æ£€æŸ¥è®¾å¤‡æ˜¯å¦åœ¨support.shä¸­
                  DEVICE_IN_SUPPORT=false
                  IFS=' ' read -ra DEVICE_ARRAY <<< "$SUPPORTED_DEVICES"
                  for device in "${DEVICE_ARRAY[@]}"; do
                    if [ "$device" = "$SELECTED_DEVICE" ]; then
                      DEVICE_IN_SUPPORT=true
                      break
                    fi
                  done
                  
                  if [ "$DEVICE_IN_SUPPORT" = false ]; then
                    echo "âŒ é”™è¯¯: é€‰æ‹©çš„è®¾å¤‡ '$SELECTED_DEVICE' ä¸åœ¨ support.sh çš„æ”¯æŒåˆ—è¡¨ä¸­"
                    echo ""
                    echo "ğŸ“‹ support.sh æ”¯æŒçš„è®¾å¤‡:"
                    for device in "${DEVICE_ARRAY[@]}"; do
                      if command -v get_device_description >/dev/null 2>&1; then
                        DESC=$(get_device_description "$device" 2>/dev/null || echo "æ— æè¿°")
                        echo "  - $device: $DESC"
                      else
                        echo "  - $device"
                      fi
                    done
                    echo ""
                    echo "âŒ æ„å»ºç»ˆæ­¢: è®¾å¤‡ä¸æ”¯æŒ"
                    exit 1
                  else
                    echo "âœ… è®¾å¤‡ '$SELECTED_DEVICE' åœ¨ support.sh ä¸­æ”¯æŒ"
                    if command -v get_device_description >/dev/null 2>&1; then
                      DEVICE_DESC=$(get_device_description "$SELECTED_DEVICE" 2>/dev/null || echo "æ— æè¿°")
                      echo "ğŸ“ è®¾å¤‡æè¿°: $DEVICE_DESC"
                    fi
                  fi
                else
                  echo "âš ï¸ æ— æ³•ä» support.sh è¯»å–è®¾å¤‡åˆ—è¡¨å‡½æ•°"
                  echo "ğŸ’¡ ç»§ç»­ä½¿ç”¨é€‰æ‹©çš„è®¾å¤‡: ${{ github.event.inputs.device_name }}"
                fi
              else
                echo "âš ï¸ æ— æ³•åŠ è½½è®¾å¤‡æ”¯æŒè„šæœ¬ (å¯èƒ½æ˜¯è¯­æ³•é”™è¯¯)"
                echo "ğŸ’¡ ç»§ç»­ä½¿ç”¨é€‰æ‹©çš„è®¾å¤‡: ${{ github.event.inputs.device_name }}"
              fi
            else
              echo "âš ï¸ è­¦å‘Š: è®¾å¤‡æ”¯æŒæ–‡ä»¶ä¸å­˜åœ¨: $SUPPORT_FILE"
              echo "ğŸ’¡ è·³è¿‡è®¾å¤‡åŒæ­¥æ£€æŸ¥ï¼Œç›´æ¥ä½¿ç”¨é€‰æ‹©çš„è®¾å¤‡: ${{ github.event.inputs.device_name }}"
            fi
            
            # å¤åˆ¶åˆ°å·¥ä½œåŒº
            echo "ğŸ“ å¤åˆ¶æ–‡ä»¶åˆ°å·¥ä½œåŒº..."
            mkdir -p ${{ github.workspace }}
            
            # æ£€æŸ¥å¹¶åˆ é™¤ç¼–è¯‘å™¨ç›®å½•ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
            if [ -d "firmware-config/build-Compiler-file" ]; then
              echo "âš ï¸ å‘ç°ç¼–è¯‘å™¨ç›®å½•ï¼Œæ’é™¤ä¸å¤åˆ¶"
              rm -rf firmware-config/build-Compiler-file
            fi
            
            # ä½¿ç”¨rsyncå¤åˆ¶æ‰€æœ‰æ–‡ä»¶ï¼Œæ’é™¤.gitç›®å½•
            rsync -av --exclude='.git' . ${{ github.workspace }}/
            
            # ç¡®ä¿è„šæœ¬æ–‡ä»¶æœ‰æ‰§è¡Œæƒé™
            chmod +x ${{ github.workspace }}/firmware-config/scripts/*.sh 2>/dev/null || true
            
            echo "âœ… æ–‡ä»¶å¤åˆ¶å®Œæˆ"
            
            # ä¿å­˜æºä»£ç å‹ç¼©åŒ…ä½œä¸ºæ„å»ºäº§ç‰©
            mkdir -p /tmp/build-artifacts/source-archive
            cp source.tar.gz /tmp/build-artifacts/source-archive/
            echo "ğŸ“¦ æºä»£ç å·²ä¿å­˜åˆ°: /tmp/build-artifacts/source-archive/"
          else
            echo "âŒ é”™è¯¯: æºä»£ç è§£å‹å¤±è´¥ï¼Œé‡è¦æ–‡ä»¶ç¼ºå¤±"
            echo "ğŸ“ å½“å‰ç›®å½•å†…å®¹:"
            ls -la
            exit 1
          fi
          
          # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
          cd /tmp
          rm -rf openwrt-source
          echo "âœ… Git Archive APIä¸‹è½½å’Œè®¾å¤‡æ£€æŸ¥å®Œæˆï¼Œæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          echo "ğŸŸ¢ æ­¥éª¤ 1 å®Œæˆ"

      #ã€firmware-build.yml-03ã€‘æ­¥éª¤ 2: ä¸Šä¼ æºä»£ç Artifacts
      - name: "2. ä¸Šä¼ æºä»£ç Artifacts"
        uses: actions/upload-artifact@v4
        with:
          name: source-${{ env.TIMESTAMP }}
          path: /tmp/build-artifacts/source-archive/
          retention-days: 7
          if-no-files-found: error

      #ã€firmware-build.yml-04ã€‘æ­¥éª¤ 3: ä¿®å¤æƒé™é—®é¢˜
      - name: "3. ä¿®å¤æƒé™é—®é¢˜"
        run: |
          echo "=== æ­¥éª¤ 3: ä¿®å¤æƒé™é—®é¢˜ ==="
          echo "ğŸ• å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          # è®¾ç½®é”™è¯¯å¤„ç†
          set -e
          trap 'echo "âŒ æ­¥éª¤ 3 å¤±è´¥ï¼Œé€€å‡ºä»£ç : $?"; exit 1' ERR
          
          echo "ğŸ”§ ä¿®å¤æ‰€æœ‰è„šæœ¬çš„æ‰§è¡Œæƒé™..."
          
          if [ -f "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" ]; then
            chmod +x "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh"
            echo "âœ… ä¿®å¤ä¸»è„šæœ¬æƒé™: firmware-config/scripts/build_firmware_main.sh"
          else
            echo "âŒ é”™è¯¯: ä¸»è„šæœ¬ä¸å­˜åœ¨: firmware-config/scripts/build_firmware_main.sh"
            exit 1
          fi
          
          # ä¿®å¤support.shæƒé™
          if [ -f "${{ github.workspace }}/firmware-config/support.sh" ]; then
            chmod +x "${{ github.workspace }}/firmware-config/support.sh"
            echo "âœ… ä¿®å¤è®¾å¤‡æ”¯æŒè„šæœ¬æƒé™: firmware-config/support.sh"
          else
            echo "âš ï¸ è­¦å‘Š: è®¾å¤‡æ”¯æŒè„šæœ¬ä¸å­˜åœ¨: firmware-config/support.sh"
          fi
          
          # ä¿®å¤å…¶ä»–è„šæœ¬æƒé™
          find "${{ github.workspace }}/firmware-config/scripts" -name "*.sh" -exec chmod +x {} \;
          echo "âœ… ä¿®å¤æ‰€æœ‰è„šæœ¬æƒé™å®Œæˆ"
          echo "ğŸŸ¢ æ­¥éª¤ 3 å®Œæˆ"

      #ã€firmware-build.yml-05ã€‘æ­¥éª¤ 4: å®‰è£…åŸºç¡€å·¥å…·ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "4. å®‰è£…åŸºç¡€å·¥å…·ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        run: |
          echo "=== æ­¥éª¤ 4: å®‰è£…åŸºç¡€å·¥å…·ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" setup_environment
          
          echo "ğŸŸ¢ æ­¥éª¤ 4 å®Œæˆ"

      #ã€firmware-build.yml-06ã€‘æ­¥éª¤ 5: åˆå§‹ç©ºé—´æ£€æŸ¥ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "5. åˆå§‹ç©ºé—´æ£€æŸ¥ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        run: |
          echo "=== æ­¥éª¤ 5: åˆå§‹ç©ºé—´æ£€æŸ¥ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• æ£€æŸ¥æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" pre_build_space_check
          
          echo "ğŸŸ¢ æ­¥éª¤ 5 å®Œæˆ"

      #ã€firmware-build.yml-07ã€‘æ­¥éª¤ 6: åŠ¨æ€è¯»å–è®¾å¤‡åˆ—è¡¨å¹¶è®¾ç½®ç¼–è¯‘ç¯å¢ƒï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "6. åŠ¨æ€è¯»å–è®¾å¤‡åˆ—è¡¨å¹¶è®¾ç½®ç¼–è¯‘ç¯å¢ƒï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        run: |
          echo "=== æ­¥éª¤ 6: åŠ¨æ€è¯»å–è®¾å¤‡åˆ—è¡¨å¹¶è®¾ç½®ç¼–è¯‘ç¯å¢ƒï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          # åˆ›å»ºæ„å»ºç›®å½•
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" create_build_dir
          
          # åˆå§‹åŒ–æ„å»ºç¯å¢ƒ
          echo "ğŸ“± è®¾å¤‡: ${{ github.event.inputs.device_name }}"
          echo "ğŸ”„ ç‰ˆæœ¬: ${{ github.event.inputs.version_selection }}"
          echo "âš™ï¸ é…ç½®æ¨¡å¼: ${{ github.event.inputs.config_mode }}"
          echo "ğŸ“¦ æºä»£ç ä»“åº“: ${{ github.event.inputs.source_repo }}"
          
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" initialize_build_env "${{ github.event.inputs.device_name }}" "${{ github.event.inputs.version_selection }}" "${{ github.event.inputs.config_mode }}" "${{ github.event.inputs.source_repo }}"
          
          echo "ğŸŸ¢ æ­¥éª¤ 6 å®Œæˆ"

      #ã€firmware-build.yml-08ã€‘æ­¥éª¤ 7: ä¸‹è½½OpenWrtå®˜æ–¹SDKï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "7. ä¸‹è½½OpenWrtå®˜æ–¹SDKï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        run: |
          echo "=== æ­¥éª¤ 7: ä¸‹è½½OpenWrtå®˜æ–¹SDKï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" initialize_compiler_env "${{ github.event.inputs.device_name }}"
          
          echo "ğŸŸ¢ æ­¥éª¤ 7 å®Œæˆ"

      #ã€firmware-build.yml-09ã€‘æ­¥éª¤ 8: éªŒè¯SDKä¸‹è½½ç»“æœï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "8. éªŒè¯SDKä¸‹è½½ç»“æœï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        run: |
          echo "=== æ­¥éª¤ 8: éªŒè¯SDKä¸‹è½½ç»“æœï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• éªŒè¯æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" verify_compiler_files
          
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" check_compiler_invocation
          
          echo "ğŸŸ¢ æ­¥éª¤ 8 å®Œæˆ"

      #ã€firmware-build.yml-10ã€‘æ­¥éª¤ 9: æ·»åŠ  TurboACC æ”¯æŒï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "9. æ·»åŠ  TurboACC æ”¯æŒï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        run: |
          echo "=== æ­¥éª¤ 9: æ·»åŠ  TurboACC æ”¯æŒï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" add_turboacc_support
          
          echo "ğŸŸ¢ æ­¥éª¤ 9 å®Œæˆ"

      #ã€firmware-build.yml-11ã€‘æ­¥éª¤ 10: é…ç½®Feedsï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "10. é…ç½®Feedsï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        run: |
          echo "=== æ­¥éª¤ 10: é…ç½®Feedsï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" configure_feeds
          
          echo "ğŸŸ¢ æ­¥éª¤ 10 å®Œæˆ"

      #ã€firmware-build.yml-12ã€‘æ­¥éª¤ 11: å®‰è£… TurboACC åŒ…ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "11. å®‰è£… TurboACC åŒ…ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        if: env.SELECTED_BRANCH == 'openwrt-23.05' && github.event.inputs.config_mode == 'normal'
        run: |
          echo "=== æ­¥éª¤ 11: å®‰è£… TurboACC åŒ…ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" install_turboacc_packages
          
          echo "ğŸŸ¢ æ­¥éª¤ 11 å®Œæˆ"

      #ã€firmware-build.yml-13ã€‘æ­¥éª¤ 12: ç¼–è¯‘å‰ç©ºé—´æ£€æŸ¥ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "12. ç¼–è¯‘å‰ç©ºé—´æ£€æŸ¥ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        run: |
          echo "=== æ­¥éª¤ 12: ç¼–è¯‘å‰ç©ºé—´æ£€æŸ¥ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• æ£€æŸ¥æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" pre_build_space_check
          
          echo "ğŸŸ¢ æ­¥éª¤ 12 å®Œæˆ"

      #ã€firmware-build.yml-14ã€‘æ­¥éª¤ 13: æ™ºèƒ½é…ç½®ç”Ÿæˆï¼ˆä½¿ç”¨è®¾å¤‡æ”¯æŒç³»ç»Ÿï¼‰ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "13. æ™ºèƒ½é…ç½®ç”Ÿæˆï¼ˆä½¿ç”¨è®¾å¤‡æ”¯æŒç³»ç»Ÿï¼‰ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        run: |
          echo "=== æ­¥éª¤ 13: æ™ºèƒ½é…ç½®ç”Ÿæˆï¼ˆä½¿ç”¨è®¾å¤‡æ”¯æŒç³»ç»Ÿï¼‰ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" generate_config "${{ github.event.inputs.extra_packages }}"
          
          echo "ğŸŸ¢ æ­¥éª¤ 13 å®Œæˆ"

      #ã€firmware-build.yml-15ã€‘æ­¥éª¤ 14: éªŒè¯USBé…ç½®ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "14. éªŒè¯USBé…ç½®ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        run: |
          echo "=== æ­¥éª¤ 14: éªŒè¯USBé…ç½®ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" verify_usb_config
          
          echo "ğŸŸ¢ æ­¥éª¤ 14 å®Œæˆ"

      #ã€firmware-build.yml-16ã€‘æ­¥éª¤ 15: USBé©±åŠ¨å®Œæ•´æ€§æ£€æŸ¥ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "15. USBé©±åŠ¨å®Œæ•´æ€§æ£€æŸ¥ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        run: |
          echo "=== æ­¥éª¤ 15: USBé©±åŠ¨å®Œæ•´æ€§æ£€æŸ¥ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" check_usb_drivers_integrity
          
          echo "ğŸŸ¢ æ­¥éª¤ 15 å®Œæˆ"

      #ã€firmware-build.yml-17ã€‘æ­¥éª¤ 16: åº”ç”¨é…ç½®å¹¶æ˜¾ç¤ºè¯¦æƒ…ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "16. åº”ç”¨é…ç½®å¹¶æ˜¾ç¤ºè¯¦æƒ…ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        run: |
          echo "=== æ­¥éª¤ 16: åº”ç”¨é…ç½®å¹¶æ˜¾ç¤ºè¯¦æƒ…ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          # è®¾ç½®é”™è¯¯å¤„ç†
          set -e
          trap 'echo "âŒ æ­¥éª¤ 16 å¤±è´¥ï¼Œé€€å‡ºä»£ç : $?"; exit 1' ERR
          
          # å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶
          if [ -f "/mnt/openwrt-build/.config" ]; then
            cp "/mnt/openwrt-build/.config" "/mnt/openwrt-build/.config.original"
            echo "âœ… å·²å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶"
          fi
          
          # åº”ç”¨é…ç½®
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" apply_config
          
          if [ $? -ne 0 ]; then
            echo "âŒ é”™è¯¯: åº”ç”¨é…ç½®å¤±è´¥"
            exit 1
          fi
          
          echo "=== é…ç½®åº”ç”¨å®Œæˆæ£€æŸ¥ ==="
          if [ -f "/mnt/openwrt-build/.config" ]; then
            echo "âœ… æœ€ç»ˆé…ç½®æ–‡ä»¶å­˜åœ¨"
            echo "ğŸ“Š æ–‡ä»¶å¤§å°: $(ls -lh "/mnt/openwrt-build/.config" | awk '{print $5}')"
            
            # æ£€æŸ¥å…³é”®é…ç½®
            echo "ğŸ” å…³é”®é…ç½®çŠ¶æ€:"
            echo "  USBæ ¸å¿ƒ: $(grep -q "^CONFIG_PACKAGE_kmod-usb-core=y" "/mnt/openwrt-build/.config" && echo "âœ…" || echo "âŒ")"
            echo "  USB 3.0: $(grep -q "^CONFIG_PACKAGE_kmod-usb3=y" "/mnt/openwrt-build/.config" && echo "âœ…" || echo "âŒ")"
            echo "  USB xHCI: $(grep -q "^CONFIG_PACKAGE_kmod-usb-xhci-hcd=y" "/mnt/openwrt-build/.config" && echo "âœ…" || echo "âŒ")"
            echo "  USBå­˜å‚¨: $(grep -q "^CONFIG_PACKAGE_kmod-usb-storage=y" "/mnt/openwrt-build/.config" && echo "âœ…" || echo "âŒ")"
          else
            echo "âŒ é”™è¯¯: æœ€ç»ˆé…ç½®æ–‡ä»¶ä¸å­˜åœ¨"
            exit 1
          fi
          
          echo "ğŸŸ¢ æ­¥éª¤ 16 å®Œæˆ"

      #ã€firmware-build.yml-18ã€‘æ­¥éª¤ 17: æ£€æŸ¥å¹¶å¤‡ä»½é…ç½®æ–‡ä»¶
      - name: "17. æ£€æŸ¥å¹¶å¤‡ä»½é…ç½®æ–‡ä»¶"
        run: |
          echo "=== æ­¥éª¤ 17: æ£€æŸ¥å¹¶å¤‡ä»½é…ç½®æ–‡ä»¶ ==="
          echo "ğŸ• å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          # è®¾ç½®é”™è¯¯å¤„ç†
          set -e
          trap 'echo "âŒ æ­¥éª¤ 17 å¤±è´¥ï¼Œé€€å‡ºä»£ç : $?"; exit 1' ERR
          
          # æ£€æŸ¥é…ç½®æ–‡ä»¶
          if [ -f "/mnt/openwrt-build/.config" ]; then
            echo "âœ… .config æ–‡ä»¶å­˜åœ¨"
            echo "ğŸ“Š æ–‡ä»¶å¤§å°: $(ls -lh "/mnt/openwrt-build/.config" | awk '{print $5}')"
            echo "ğŸ“ æ–‡ä»¶è¡Œæ•°: $(wc -l < "/mnt/openwrt-build/.config")"
            
            # ç¡®ä¿å¤‡ä»½ç›®å½•å­˜åœ¨
            mkdir -p "${{ github.workspace }}/firmware-config/config-backup"
            
            # å¤‡ä»½åˆ°ä»“åº“ç›®å½•
            BACKUP_FILE="${{ github.workspace }}/firmware-config/config-backup/config_${{ env.TIMESTAMP }}.config"
            
            cp "/mnt/openwrt-build/.config" "$BACKUP_FILE"
            echo "âœ… é…ç½®æ–‡ä»¶å¤‡ä»½åˆ°ä»“åº“ç›®å½•: $BACKUP_FILE"
            echo "ğŸ“Š å¤‡ä»½æ–‡ä»¶å¤§å°: $(ls -lh "$BACKUP_FILE" | awk '{print $5}')"
          else
            echo "âŒ é”™è¯¯: .config æ–‡ä»¶ä¸å­˜åœ¨"
            exit 1
          fi
          
          echo "ğŸŸ¢ æ­¥éª¤ 17 å®Œæˆ"

      #ã€firmware-build.yml-19ã€‘æ­¥éª¤ 18: ä¿®å¤ç½‘ç»œç¯å¢ƒï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "18. ä¿®å¤ç½‘ç»œç¯å¢ƒï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        run: |
          echo "=== æ­¥éª¤ 18: ä¿®å¤ç½‘ç»œç¯å¢ƒï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" fix_network
          
          echo "ğŸŸ¢ æ­¥éª¤ 18 å®Œæˆ"

      #ã€firmware-build.yml-20ã€‘æ­¥éª¤ 19: ä¸‹è½½ä¾èµ–åŒ…ï¼ˆä¼˜åŒ–ç‰ˆï¼‰ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "19. ä¸‹è½½ä¾èµ–åŒ…ï¼ˆä¼˜åŒ–ç‰ˆï¼‰ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        run: |
          echo "=== æ­¥éª¤ 19: ä¸‹è½½ä¾èµ–åŒ…ï¼ˆä¼˜åŒ–ç‰ˆï¼‰ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" download_dependencies
          
          echo "ğŸŸ¢ æ­¥éª¤ 19 å®Œæˆ"

      #ã€firmware-build.yml-21ã€‘æ­¥éª¤ 20: é›†æˆè‡ªå®šä¹‰æ–‡ä»¶ï¼ˆå¢å¼ºç‰ˆï¼‰ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "20. é›†æˆè‡ªå®šä¹‰æ–‡ä»¶ï¼ˆå¢å¼ºç‰ˆï¼‰ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        run: |
          echo "=== æ­¥éª¤ 20: é›†æˆè‡ªå®šä¹‰æ–‡ä»¶ï¼ˆå¢å¼ºç‰ˆï¼‰ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" integrate_custom_files
          
          echo "ğŸŸ¢ æ­¥éª¤ 20 å®Œæˆ"

      #ã€firmware-build.yml-22ã€‘æ­¥éª¤ 21: å‰ç½®é”™è¯¯æ£€æŸ¥ï¼ˆä¿®å¤ç‰ˆï¼‰ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "21. å‰ç½®é”™è¯¯æ£€æŸ¥ï¼ˆä¿®å¤ç‰ˆï¼‰ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        run: |
          echo "=== æ­¥éª¤ 21: å‰ç½®é”™è¯¯æ£€æŸ¥ï¼ˆä¿®å¤ç‰ˆï¼‰ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" pre_build_error_check
          
          echo "ğŸŸ¢ æ­¥éª¤ 21 å®Œæˆ"

      #ã€firmware-build.yml-23ã€‘æ­¥éª¤ 22: ç¼–è¯‘å›ºä»¶å‰çš„ç©ºé—´æ£€æŸ¥ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "22. ç¼–è¯‘å›ºä»¶å‰çš„ç©ºé—´æ£€æŸ¥ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        run: |
          echo "=== æ­¥éª¤ 22: ç¼–è¯‘å›ºä»¶å‰çš„ç©ºé—´æ£€æŸ¥ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• æ£€æŸ¥æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" pre_build_space_check
          
          echo "ğŸŸ¢ æ­¥éª¤ 22 å®Œæˆ"

      #ã€firmware-build.yml-24ã€‘æ­¥éª¤ 23: ç¼–è¯‘å›ºä»¶ï¼ˆæ™ºèƒ½å¹¶è¡Œä¼˜åŒ–ç‰ˆï¼‰ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "23. ç¼–è¯‘å›ºä»¶ï¼ˆæ™ºèƒ½å¹¶è¡Œä¼˜åŒ–ç‰ˆï¼‰ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        run: |
          echo "=== æ­¥éª¤ 23: ç¼–è¯‘å›ºä»¶ï¼ˆæ™ºèƒ½å¹¶è¡Œä¼˜åŒ–ç‰ˆï¼‰ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          # å¯ç”¨ç¼“å­˜
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" build_firmware "true"
          
          echo "ğŸŸ¢ æ­¥éª¤ 23 å®Œæˆ"

      #ã€firmware-build.yml-25ã€‘æ­¥éª¤ 24: æ£€æŸ¥æ„å»ºäº§ç‰©ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "24. æ£€æŸ¥æ„å»ºäº§ç‰©ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        if: success()
        run: |
          echo "=== æ­¥éª¤ 24: æ£€æŸ¥æ„å»ºäº§ç‰©ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" check_firmware_files
          
          echo "ğŸŸ¢ æ­¥éª¤ 24 å®Œæˆ"

      #ã€firmware-build.yml-26ã€‘æ­¥éª¤ 25: ä¸Šä¼ å›ºä»¶åŸå§‹ç›®å½•
      - name: "25. ä¸Šä¼ å›ºä»¶åŸå§‹ç›®å½•"
        if: success()
        uses: actions/upload-artifact@v4
        with:
          name: firmware-${{ env.TIMESTAMP }}
          path: /mnt/openwrt-build/bin/targets/
          retention-days: 7
          if-no-files-found: error

      #ã€firmware-build.yml-27ã€‘æ­¥éª¤ 26: ä¸Šä¼ é…ç½®æ–‡ä»¶
      - name: "26. ä¸Šä¼ é…ç½®æ–‡ä»¶"
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: config-${{ env.TIMESTAMP }}
          path: ${{ github.workspace }}/firmware-config/config-backup/
          retention-days: 7
          if-no-files-found: error

      #ã€firmware-build.yml-28ã€‘æ­¥éª¤ 27: ç¼–è¯‘åç©ºé—´æ£€æŸ¥ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰
      - name: "27. ç¼–è¯‘åç©ºé—´æ£€æŸ¥ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰"
        if: always()
        run: |
          echo "=== æ­¥éª¤ 27: ç¼–è¯‘åç©ºé—´æ£€æŸ¥ï¼ˆè°ƒç”¨å¤§è„šæœ¬ï¼‰==="
          echo "ğŸ• æ£€æŸ¥æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          "${{ github.workspace }}/firmware-config/scripts/build_firmware_main.sh" post_build_space_check
          
          echo "ğŸŸ¢ æ­¥éª¤ 27 å®Œæˆ"

      #ã€firmware-build.yml-29ã€‘æ­¥éª¤ 28: ç¼–è¯‘åæ€»ç»“
      - name: "28. ç¼–è¯‘åæ€»ç»“"
        if: always()
        run: |
          echo "=== æ­¥éª¤ 28: ç¼–è¯‘åæ€»ç»“ ==="
          echo "ğŸ• æ€»ç»“æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          echo "ğŸš€ æ„å»ºæ€»ç»“æŠ¥å‘Š"
          echo "========================================"
          echo "è®¾å¤‡: ${{ github.event.inputs.device_name }}"
          echo "ç‰ˆæœ¬: ${{ github.event.inputs.version_selection }}"
          echo "é…ç½®æ¨¡å¼: ${{ github.event.inputs.config_mode }}"
          echo "æºä»£ç ä»“åº“: ${{ github.event.inputs.source_repo }}"
          echo "æ—¶é—´æˆ³: ${{ env.TIMESTAMP }}"
          echo "å¹¶è¡Œä¼˜åŒ–: ${{ github.event.inputs.enable_parallel }}"
          echo ""
          
          # æ£€æŸ¥æ„å»ºäº§ç‰©
          if [ -d "/mnt/openwrt-build/bin/targets" ]; then
            # ç»Ÿè®¡å›ºä»¶æ–‡ä»¶
            FIRMWARE_COUNT=$(find "/mnt/openwrt-build/bin/targets" -type f \( -name "*.bin" -o -name "*.img" \) 2>/dev/null | wc -l)
            
            echo "ğŸ“¦ æ„å»ºäº§ç‰©:"
            echo "  å›ºä»¶æ•°é‡: $FIRMWARE_COUNT ä¸ª (.bin/.img)"
            
            if [ $FIRMWARE_COUNT -gt 0 ]; then
              echo "  äº§ç‰©ä½ç½®: /mnt/openwrt-build/bin/targets/"
              echo "  ä¸‹è½½åç§°: firmware-${{ env.TIMESTAMP }}"
              
              # æ˜¾ç¤ºæ‰€æœ‰å›ºä»¶æ–‡ä»¶ä¿¡æ¯
              echo "  å›ºä»¶æ–‡ä»¶è¯¦æƒ…:"
              find "/mnt/openwrt-build/bin/targets" -type f \( -name "*.bin" -o -name "*.img" \) 2>/dev/null | while read file; do
                SIZE=$(ls -lh "$file" 2>/dev/null | awk '{print $5}' || echo "æœªçŸ¥")
                FILE_NAME=$(basename "$file")
                
                if [[ "$FILE_NAME" == *factory* ]]; then
                  TYPE="ğŸ­ å·¥å‚å›ºä»¶"
                elif [[ "$FILE_NAME" == *sysupgrade* ]]; then
                  TYPE="ğŸ”„ å‡çº§å›ºä»¶"
                elif [[ "$FILE_NAME" == *initramfs* ]]; then
                  TYPE="ğŸš€ å†…å­˜å›ºä»¶"
                else
                  TYPE="ğŸ”§ æ™®é€šå›ºä»¶"
                fi
                
                echo "    ğŸ¯ $FILE_NAME ($SIZE) - $TYPE"
              done
            else
              echo "  âš ï¸ æ„å»ºç»“æœ: ç¼–è¯‘å®Œæˆä½†æœªç”Ÿæˆå›ºä»¶æ–‡ä»¶"
            fi
          else
            echo "ğŸ“¦ æ„å»ºäº§ç‰©: æœªç”Ÿæˆä»»ä½•æ–‡ä»¶"
          fi
          
          # æ„å»ºçŠ¶æ€æ€»ç»“
          echo ""
          echo "ğŸ“Š æ„å»ºçŠ¶æ€æ€»ç»“:"
          if [ -d "/mnt/openwrt-build/bin/targets" ]; then
            FIRMWARE_COUNT=$(find "/mnt/openwrt-build/bin/targets" -type f \( -name "*.bin" -o -name "*.img" \) 2>/dev/null | wc -l)
            if [ $FIRMWARE_COUNT -gt 0 ]; then
              echo "  âœ… æ„å»ºç»“æœ: æˆåŠŸç”Ÿæˆ $FIRMWARE_COUNT ä¸ªå›ºä»¶æ–‡ä»¶"
            else
              echo "  âš ï¸ æ„å»ºç»“æœ: ç¼–è¯‘å®Œæˆä½†æœªç”Ÿæˆå›ºä»¶æ–‡ä»¶"
            fi
          else
            echo "  âŒ æ„å»ºç»“æœ: å¤±è´¥"
          fi
          
          echo "âœ… æ„å»ºæµç¨‹å®Œæˆ"
          echo "========================================"
          echo "ğŸŸ¢ æ­¥éª¤ 28 å®Œæˆ"

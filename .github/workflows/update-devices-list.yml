# æ›´æ–°æ”¯æŒçš„è®¾å¤‡åˆ—è¡¨å·¥ä½œæµ
# åŠŸèƒ½ï¼šè‡ªåŠ¨ä»å¤šä¸ªOpenWrtæºç ä»“åº“æå–è®¾å¤‡ä¿¡æ¯å¹¶ç”Ÿæˆæ”¯æŒåˆ—è¡¨
# æ”¯æŒï¼šimmortalwrtã€LEDEã€OpenWrtå®˜æ–¹æºç ï¼ˆä½¿ç”¨é•œåƒæºï¼‰

name: æ›´æ–°æ”¯æŒçš„è®¾å¤‡åˆ—è¡¨

on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘
  schedule:
    - cron: '0 0 * * 1'  # æ¯å‘¨ä¸€å‡Œæ™¨è¿è¡Œ

env:
  BUILD_DIR: /mnt/device-list  # ä¸´æ—¶æ„å»ºç›®å½•

jobs:
  update-device-list:
    runs-on: ubuntu-latest
    
    steps:
    # ä»£ç æ£€å‡ºæ­¥éª¤
    - name: æ£€å‡ºå½“å‰ä»“åº“
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # è·å–å®Œæ•´å†å²è®°å½•

    # ç¯å¢ƒè®¾ç½®æ­¥éª¤
    - name: è®¾ç½®ç¼–è¯‘ç¯å¢ƒ
      run: |
        echo "=== å®‰è£…å¿…è¦çš„ä¾èµ–åŒ… ==="
        sudo apt-get update
        sudo apt-get install -y build-essential libncurses5-dev git curl jq python3

    # ç›®å½•å‡†å¤‡æ­¥éª¤
    - name: åˆ›å»ºæ„å»ºç›®å½•
      run: |
        echo "=== åˆ›å»ºä¸´æ—¶æ„å»ºç›®å½• ==="
        sudo mkdir -p $BUILD_DIR
        sudo chown -R $USER:$USER $BUILD_DIR

    # æºç å…‹éš†æ­¥éª¤ - immortalwrt (ä½¿ç”¨GitHubé•œåƒï¼Œé€šå¸¸æ¯”è¾ƒç¨³å®š)
    - name: å…‹éš†immortalwrtæºç 
      run: |
        cd $BUILD_DIR
        echo "=== å…‹éš†immortalwrtæºç  ==="
        # è®¾ç½®é‡è¯•æœºåˆ¶
        max_attempts=3
        attempt=1
        while [ $attempt -le $max_attempts ]; do
          echo "å°è¯•å…‹éš†immortalwrt (ç¬¬ $attempt æ¬¡)..."
          if git clone --depth 1 https://github.com/immortalwrt/immortalwrt.git immortalwrt; then
            echo "âœ… immortalwrtæºç å…‹éš†æˆåŠŸ"
            break
          else
            echo "âŒ ç¬¬ $attempt æ¬¡å…‹éš†å¤±è´¥"
            if [ $attempt -eq $max_attempts ]; then
              echo "âŒ è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œimmortalwrtå…‹éš†å¤±è´¥"
              exit 1
            fi
            attempt=$((attempt + 1))
            sleep 5  # ç­‰å¾…5ç§’åé‡è¯•
          fi
        done

    # æºç å…‹éš†æ­¥éª¤ - LEDE (ä½¿ç”¨GitHubé•œåƒ)
    - name: å…‹éš†LEDEæºç 
      run: |
        cd $BUILD_DIR
        echo "=== å…‹éš†LEDEæºç  ==="
        # è®¾ç½®é‡è¯•æœºåˆ¶
        max_attempts=3
        attempt=1
        while [ $attempt -le $max_attempts ]; do
          echo "å°è¯•å…‹éš†LEDE (ç¬¬ $attempt æ¬¡)..."
          if git clone --depth 1 https://github.com/coolsnowwolf/lede.git lede; then
            echo "âœ… LEDEæºç å…‹éš†æˆåŠŸ"
            break
          else
            echo "âŒ ç¬¬ $attempt æ¬¡å…‹éš†å¤±è´¥"
            if [ $attempt -eq $max_attempts ]; then
              echo "âŒ è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ŒLEDEå…‹éš†å¤±è´¥"
              exit 1
            fi
            attempt=$((attempt + 1))
            sleep 5  # ç­‰å¾…5ç§’åé‡è¯•
          fi
        done

    # æºç å…‹éš†æ­¥éª¤ - OpenWrt (ä½¿ç”¨GitHubé•œåƒæ›¿ä»£ä¸ç¨³å®šçš„å®˜æ–¹æº)
    - name: å…‹éš†OpenWrtæºç 
      run: |
        cd $BUILD_DIR
        echo "=== å…‹éš†OpenWrtæºç  ==="
        
        # å®šä¹‰å¤šä¸ªé•œåƒæºï¼ŒæŒ‰ä¼˜å…ˆçº§å°è¯•
        OPENWRT_MIRRORS=(
          "https://github.com/openwrt/openwrt.git"  # GitHubé•œåƒ (æ¨è)
          "https://git.openwrt.org/openwrt/openwrt.git"  # å®˜æ–¹æº (å¤‡ç”¨)
          "https://gitee.com/mirrors/openwrt.git"  # Giteeé•œåƒ (å›½å†…ç”¨æˆ·)
        )
        
        max_attempts=3
        attempt=1
        mirror_index=0
        
        while [ $attempt -le $max_attempts ] && [ $mirror_index -lt ${#OPENWRT_MIRRORS[@]} ]; do
          current_mirror=${OPENWRT_MIRRORS[$mirror_index]}
          echo "å°è¯•ä»é•œåƒæºå…‹éš†OpenWrt (ç¬¬ $attempt æ¬¡ï¼Œé•œåƒ $((mirror_index + 1))/${#OPENWRT_MIRRORS[@]})..."
          echo "é•œåƒåœ°å€: $current_mirror"
          
          if git clone --depth 1 "$current_mirror" openwrt; then
            echo "âœ… OpenWrtæºç å…‹éš†æˆåŠŸ (ä½¿ç”¨é•œåƒ: $current_mirror)"
            break
          else
            echo "âŒ ç¬¬ $attempt æ¬¡å…‹éš†å¤±è´¥ (é•œåƒ: $current_mirror)"
            
            # æ¸…ç†å¤±è´¥çš„å…‹éš†ç›®å½•
            rm -rf openwrt
            
            if [ $attempt -eq $max_attempts ]; then
              # å½“å‰é•œåƒå°è¯•æ¬¡æ•°ç”¨å®Œï¼Œåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªé•œåƒ
              mirror_index=$((mirror_index + 1))
              attempt=1
              if [ $mirror_index -ge ${#OPENWRT_MIRRORS[@]} ]; then
                echo "âŒ æ‰€æœ‰é•œåƒæºéƒ½å°è¯•å¤±è´¥ï¼Œæ— æ³•å…‹éš†OpenWrtæºç "
                echo "=== é”™è¯¯è¯Šæ–­ä¿¡æ¯ ==="
                echo "1. æ£€æŸ¥ç½‘ç»œè¿æ¥..."
                curl -I https://github.com --connect-timeout 10 || echo "GitHubè¿æ¥å¤±è´¥"
                echo "2. æ£€æŸ¥DNSè§£æ..."
                nslookup github.com || echo "DNSè§£æå¤±è´¥"
                echo "3. å°è¯•ä½¿ç”¨wgetæµ‹è¯•..."
                wget --spider https://github.com -T 10 || echo "wgetæµ‹è¯•å¤±è´¥"
                exit 1
              fi
            else
              attempt=$((attempt + 1))
            fi
            sleep 5  # ç­‰å¾…5ç§’åé‡è¯•
          fi
        done

    # æºç éªŒè¯æ­¥éª¤ - ç¡®ä¿æ‰€æœ‰å¿…è¦çš„æºç éƒ½å·²æˆåŠŸå…‹éš†
    - name: éªŒè¯æºç å…‹éš†ç»“æœ
      run: |
        cd $BUILD_DIR
        echo "=== éªŒè¯æºç å…‹éš†ç»“æœ ==="
        
        REPOS=("immortalwrt" "lede" "openwrt")
        all_success=true
        
        for repo in "${REPOS[@]}"; do
          if [ -d "$repo" ] && [ -f "$repo/.git/config" ]; then
            echo "âœ… $repo: æºç ç›®å½•å­˜åœ¨ä¸”åŒ…å«gité…ç½®"
            # æ˜¾ç¤ºä»“åº“ä¿¡æ¯
            cd "$repo"
            echo "   - è¿œç¨‹URL: $(git config --get remote.origin.url)"
            echo "   - æœ€æ–°æäº¤: $(git log -1 --oneline --no-color 2>/dev/null || echo 'æ— æ³•è·å–æäº¤ä¿¡æ¯')"
            cd ..
          else
            echo "âŒ $repo: æºç ç›®å½•ä¸å­˜åœ¨æˆ–æŸå"
            all_success=false
          fi
          echo ""
        done
        
        if [ "$all_success" = false ]; then
          echo "âŒ éƒ¨åˆ†æºç ä»“åº“å…‹éš†å¤±è´¥ï¼Œæ— æ³•ç”Ÿæˆå®Œæ•´çš„è®¾å¤‡åˆ—è¡¨"
          echo "å½“å‰ç›®å½•å†…å®¹:"
          ls -la
          exit 1
        else
          echo "âœ… æ‰€æœ‰æºç ä»“åº“å…‹éš†æˆåŠŸ"
        fi

    # è®¾å¤‡åˆ—è¡¨ç”Ÿæˆæ­¥éª¤
    - name: ç”Ÿæˆè®¾å¤‡åˆ—è¡¨
      run: |
        cd $BUILD_DIR
        echo "=== ç”Ÿæˆè®¾å¤‡åˆ—è¡¨ ==="
        
        # åˆ›å»ºPythonè„šæœ¬ç”¨äºè§£æè®¾å¤‡ä¿¡æ¯
        cat > generate_device_list.py << 'EOF'
        #!/usr/bin/env python3
        """
        è®¾å¤‡åˆ—è¡¨ç”Ÿæˆè„šæœ¬
        åŠŸèƒ½ï¼šä»OpenWrtæºç ä¸­æå–è®¾å¤‡å®šä¹‰ä¿¡æ¯å¹¶ç”ŸæˆMarkdownæ ¼å¼çš„æ”¯æŒåˆ—è¡¨
        æ”¯æŒï¼šimmortalwrtã€LEDEã€OpenWrtå®˜æ–¹æºç 
        """
        
        import os
        import glob
        import re
        from pathlib import Path
        import datetime

        # è®¾å¤‡åˆ«åæ˜ å°„è¡¨
        # å°†é€šç”¨è®¾å¤‡åç§°æ˜ å°„åˆ°å…·ä½“çš„è®¾å¤‡æ ‡è¯†ç¬¦
        device_aliases = {
            # ASUS è®¾å¤‡åˆ«åæ˜ å°„
            "asus_rt-ac42u": ["ac42u", "acrh17", "rt-acrh17"],
            "asus_rt-ac58u": ["ac58u", "acrh13", "rt-acrh13"],
            "asus_rt-acrh17": ["acrh17", "rt-acrh17"],
            "asus_rt-acrh13": ["acrh13", "rt-acrh13"],
            # å…¶ä»–å¸¸è§è®¾å¤‡åˆ«åå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ 
        }

        def reverse_alias_map(aliases):
            """ç”Ÿæˆåå‘åˆ«åæ˜ å°„"""
            reverse_map = {}
            for main_device, alias_list in aliases.items():
                for alias in alias_list:
                    reverse_map[alias] = main_device
            return reverse_map

        def parse_device_info(mk_file):
            """
            è§£æè®¾å¤‡å®šä¹‰æ–‡ä»¶
            ä»Makefileä¸­æå–è®¾å¤‡åç§°ã€å‚å•†ã€å‹å·ç­‰ä¿¡æ¯
            """
            devices = []
            try:
                with open(mk_file, 'r', encoding='utf-8', errors='ignore') as f:
                    content = f.read()
                
                # æŸ¥æ‰¾æ‰€æœ‰è®¾å¤‡å®šä¹‰å—
                device_blocks = re.findall(r'define\s+Device/(.+?)\n(.*?)\nendef', content, re.DOTALL)
                
                for device_name, device_content in device_blocks:
                    device_info = {
                        'name': device_name.strip(),
                        'vendor': '',
                        'model': '',
                        'title': '',
                        'aliases': []
                    }
                    
                    # æå–è®¾å¤‡ä¿¡æ¯
                    vendor_match = re.search(r'DEVICE_VENDOR\s*:?=\s*(.+)', device_content)
                    model_match = re.search(r'DEVICE_MODEL\s*:?=\s*(.+)', device_content)
                    title_match = re.search(r'DEVICE_TITLE\s*:?=\s*(.+)', device_content)
                    alt_match = re.search(r'DEVICE_ALT\w*_VENDOR\s*:?=\s*(.+)', device_content)
                    
                    if vendor_match:
                        device_info['vendor'] = vendor_match.group(1).strip()
                    if model_match:
                        device_info['model'] = model_match.group(1).strip()
                    if title_match:
                        device_info['title'] = title_match.group(1).strip()
                    
                    # æŸ¥æ‰¾åˆ«å
                    if device_info['name'] in device_aliases:
                        device_info['aliases'] = device_aliases[device_info['name']]
                    
                    devices.append(device_info)
                    
            except Exception as e:
                print(f"è§£ææ–‡ä»¶ {mk_file} æ—¶å‡ºé”™: {e}")
            
            return devices

        def generate_markdown_table(repo_name, devices):
            """ç”ŸæˆMarkdownæ ¼å¼çš„è®¾å¤‡è¡¨æ ¼"""
            if not devices:
                return f"### {repo_name}\n\næš‚æ— æ”¯æŒçš„è®¾å¤‡æ•°æ®\n\n"
            
            table = f"### {repo_name}\n\n"
            table += "| åºå· | å¹³å° | è®¾å¤‡åç§° | é€šç”¨åˆ«å | å¤‡æ³¨ |\n"
            table += "|------|------|----------|----------|------|\n"
            
            for idx, device in enumerate(devices, 1):
                platform = device.get('platform', 'unknown')
                name = device['name']
                aliases = ', '.join(device['aliases']) if device['aliases'] else '-'
                title = device.get('title', '') or f"{device.get('vendor', '')} {device.get('model', '')}".strip()
                note = title if title else '-'
                
                table += f"| {idx} | {platform} | `{name}` | {aliases} | {note} |\n"
            
            return table + "\n"

        def main():
            """ä¸»å‡½æ•°"""
            # å®šä¹‰è¦å¤„ç†çš„æºç ä»“åº“
            repos = {
                'immortalwrt': 'immortalwrt',
                'LEDE': 'lede', 
                'OpenWrt': 'openwrt'
            }
            
            all_devices = []
            repo_stats = {}
            
            # å¤„ç†æ¯ä¸ªä»“åº“
            for repo_name, repo_dir in repos.items():
                repo_path = Path(repo_dir)
                if not repo_path.exists():
                    print(f"âš ï¸ ä»“åº“ {repo_name} ä¸å­˜åœ¨ï¼Œè·³è¿‡")
                    repo_stats[repo_name] = 0
                    continue
                
                print(f"ğŸ” å¤„ç† {repo_name}...")
                repo_devices = []
                
                # æŸ¥æ‰¾æ‰€æœ‰å¹³å°ç›®å½•
                target_linux = repo_path / "target" / "linux"
                if target_linux.exists():
                    for platform_dir in target_linux.iterdir():
                        if platform_dir.is_dir() and not platform_dir.name.startswith('.'):
                            platform = platform_dir.name
                            
                            # æŸ¥æ‰¾æ‰€æœ‰çš„ .mk æ–‡ä»¶
                            mk_files = list(platform_dir.glob("**/*.mk"))
                            
                            print(f"  å¹³å° {platform}: æ‰¾åˆ° {len(mk_files)} ä¸ªmkæ–‡ä»¶")
                            
                            for mk_file in mk_files:
                                devices = parse_device_info(mk_file)
                                for device in devices:
                                    device['platform'] = platform
                                    device['repo'] = repo_name
                                    repo_devices.append(device)
                else:
                    print(f"âš ï¸  {repo_name} æ²¡æœ‰ target/linux ç›®å½•")
                
                repo_stats[repo_name] = len(repo_devices)
                all_devices.extend(repo_devices)
                
                # ä¸ºå½“å‰ä»“åº“ç”Ÿæˆè¡¨æ ¼
                table_content = generate_markdown_table(repo_name, repo_devices)
                
                # ä¿å­˜åˆ°æ–‡ä»¶
                output_file = f"device_list_{repo_name.lower()}.md"
                with open(output_file, 'w', encoding='utf-8') as f:
                    f.write(table_content)
                
                print(f"âœ… ç”Ÿæˆ {output_file}ï¼ŒåŒ…å« {len(repo_devices)} ä¸ªè®¾å¤‡")
            
            # ç”Ÿæˆæ±‡æ€»æ–‡ä»¶
            with open("supports.md", 'w', encoding='utf-8') as f:
                # æ–‡ä»¶å¤´éƒ¨ä¿¡æ¯
                f.write("# æºç æ”¯æŒè®¾å¤‡åˆ—è¡¨\n\n")
                f.write("> æœ¬æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆï¼Œåˆ—å‡ºå„æºç ä»“åº“æ”¯æŒçš„è®¾å¤‡ä¿¡æ¯\n\n")
                
                # ç”Ÿæˆæ—¶é—´
                current_time = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
                f.write(f"**æœ€åæ›´æ–°æ—¶é—´**: {current_time}\n\n")
                
                # ç»Ÿè®¡ä¿¡æ¯
                f.write("## ç»Ÿè®¡æ¦‚è§ˆ\n\n")
                total_devices = sum(repo_stats.values())
                f.write(f"**æ€»è®¾å¤‡æ•°é‡**: {total_devices}\n\n")
                
                for repo_name, count in repo_stats.items():
                    f.write(f"- **{repo_name}**: {count} ä¸ªè®¾å¤‡\n")
                f.write("\n")
                
                # æ·»åŠ ä»“åº“ä¿¡æ¯
                f.write("## ä»“åº“ç›®å½•\n\n")
                for repo_name in repos.keys():
                    f.write(f"- [{repo_name}](#{repo_name.lower()})\n")
                f.write("\n")
                
                # æ·»åŠ å„ä»“åº“è®¾å¤‡åˆ—è¡¨
                for repo_name in repos.keys():
                    try:
                        with open(f"device_list_{repo_name.lower()}.md", 'r', encoding='utf-8') as repo_file:
                            f.write(repo_file.read())
                    except FileNotFoundError:
                        f.write(f"### {repo_name}\n\n> è¯¥ä»“åº“æš‚æ— è®¾å¤‡æ•°æ®æˆ–æ•°æ®è·å–å¤±è´¥\n\n")
                
                # ä½¿ç”¨è¯´æ˜
                f.write("## ä½¿ç”¨è¯´æ˜\n\n")
                f.write("1. **è®¾å¤‡åç§°**: åœ¨ç¼–è¯‘é…ç½®ä¸­ä½¿ç”¨çš„è®¾å¤‡æ ‡è¯†ç¬¦\n")
                f.write("2. **é€šç”¨åˆ«å**: å¸¸ç”¨çš„è®¾å¤‡åˆ«åï¼Œå¯åœ¨å·¥ä½œæµä¸­è¾“å…¥ä½¿ç”¨\n")
                f.write("3. **å¹³å°**: è®¾å¤‡æ‰€å±çš„ç¡¬ä»¶å¹³å°\n")
                f.write("4. **å¤‡æ³¨**: è®¾å¤‡çš„å®Œæ•´åç§°æˆ–æè¿°ä¿¡æ¯\n\n")
                
                f.write("## æ³¨æ„äº‹é¡¹\n\n")
                f.write("- è®¾å¤‡åˆ—è¡¨æ¯å‘¨è‡ªåŠ¨æ›´æ–°\n")
                f.write("- å¦‚æœæŸä¸ªä»“åº“æ˜¾ç¤ºæ— æ•°æ®ï¼Œå¯èƒ½æ˜¯å…‹éš†å¤±è´¥æˆ–è¯¥ä»“åº“æš‚æ— è®¾å¤‡å®šä¹‰\n")
                f.write("- è®¾å¤‡åˆ«åå¯ç”¨äºç®€åŒ–è¾“å…¥ï¼Œå¦‚è¾“å…¥ 'ac42u' ä¼šè‡ªåŠ¨è½¬æ¢ä¸º 'asus_rt-ac42u'\n")
            
            print("ğŸ‰ è®¾å¤‡åˆ—è¡¨ç”Ÿæˆå®Œæˆ")
            print("ğŸ“Š ç”Ÿæˆç»Ÿè®¡:")
            for repo_name, count in repo_stats.items():
                print(f"   - {repo_name}: {count} ä¸ªè®¾å¤‡")
            print(f"   - æ€»è®¡: {total_devices} ä¸ªè®¾å¤‡")

        if __name__ == "__main__":
            main()
        EOF

        # è¿è¡Œè®¾å¤‡åˆ—è¡¨ç”Ÿæˆè„šæœ¬
        echo "å¼€å§‹è¿è¡Œè®¾å¤‡åˆ—è¡¨ç”Ÿæˆè„šæœ¬..."
        python3 generate_device_list.py
        echo "âœ… è®¾å¤‡åˆ—è¡¨ç”Ÿæˆè„šæœ¬æ‰§è¡Œå®Œæˆ"

    # æ–‡ä»¶å¤åˆ¶æ­¥éª¤
    - name: å¤åˆ¶è®¾å¤‡åˆ—è¡¨åˆ°å·¥ä½œç›®å½•
      run: |
        cd $BUILD_DIR
        echo "=== å¤åˆ¶è®¾å¤‡åˆ—è¡¨åˆ°å·¥ä½œç›®å½• ==="
        
        # æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶
        echo "ç”Ÿæˆçš„æ–‡ä»¶åˆ—è¡¨:"
        ls -la *.md 2>/dev/null || echo "æœªæ‰¾åˆ°Markdownæ–‡ä»¶"
        
        # å¤åˆ¶æ±‡æ€»æ–‡ä»¶åˆ°æ ¹ç›®å½•
        if [ -f "supports.md" ]; then
          cp supports.md $GITHUB_WORKSPACE/
          echo "âœ… å·²å¤åˆ¶ supports.md åˆ°ä»“åº“æ ¹ç›®å½•"
        else
          echo "âŒ é”™è¯¯: æœªæ‰¾åˆ° supports.md æ–‡ä»¶"
          exit 1
        fi
        
        # å¤åˆ¶è¯¦ç»†æ–‡ä»¶åˆ° custom-files/others/
        mkdir -p $GITHUB_WORKSPACE/custom-files/others
        DEVICE_LIST_FILES=$(ls device_list_*.md 2>/dev/null || true)
        if [ -n "$DEVICE_LIST_FILES" ]; then
          cp device_list_*.md $GITHUB_WORKSPACE/custom-files/others/
          echo "âœ… å·²å¤åˆ¶è¯¦ç»†è®¾å¤‡åˆ—è¡¨åˆ° custom-files/others/"
          echo "å¤åˆ¶çš„æ–‡ä»¶: $DEVICE_LIST_FILES"
        else
          echo "âš ï¸ è­¦å‘Š: æœªæ‰¾åˆ°è¯¦ç»†è®¾å¤‡åˆ—è¡¨æ–‡ä»¶"
        fi
        
        echo "âœ… è®¾å¤‡åˆ—è¡¨æ–‡ä»¶å¤åˆ¶å®Œæˆ"

    # æäº¤æ›´æ–°æ­¥éª¤
    - name: æäº¤æ›´æ–°
      run: |
        cd $GITHUB_WORKSPACE
        echo "=== æäº¤è®¾å¤‡åˆ—è¡¨æ›´æ–° ==="
        
        # æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶éœ€è¦æäº¤
        if git diff --quiet -- supports.md custom-files/others/device_list_*.md 2>/dev/null; then
          echo "â„¹ï¸ æ²¡æœ‰æ£€æµ‹åˆ°è®¾å¤‡åˆ—è¡¨å˜åŒ–ï¼Œæ— éœ€æäº¤"
        else
          echo "æ£€æµ‹åˆ°è®¾å¤‡åˆ—è¡¨å˜åŒ–ï¼Œå‡†å¤‡æäº¤..."
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add supports.md custom-files/others/device_list_*.md
          git diff --staged --quiet || git commit -m "è‡ªåŠ¨æ›´æ–°è®¾å¤‡åˆ—è¡¨ $(date +'%Y-%m-%d %H:%M')"
          git push
          echo "âœ… è®¾å¤‡åˆ—è¡¨æ›´æ–°å·²æäº¤"
        fi

    # æ¸…ç†æ­¥éª¤
    - name: æ¸…ç†æ„å»ºç›®å½•
      run: |
        echo "=== æ¸…ç†ä¸´æ—¶æ„å»ºç›®å½• ==="
        sudo rm -rf $BUILD_DIR
        echo "âœ… æ„å»ºç›®å½•å·²æ¸…ç†"

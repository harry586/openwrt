# .github/workflows/compiler-matrix-build.yml
name: ğŸ”§ äº¤å‰ç¼–è¯‘å™¨æ„å»º

on:
  workflow_dispatch:
    inputs:
      target_arch:
        description: 'ç›®æ ‡æ¶æ„ï¼ˆIPQ40xxé€‰æ‹©arm_cortex-a7ï¼‰'
        required: true
        default: 'arm_cortex-a7'
        type: choice
        options:
          - aarch64        # ARM 64ä½ï¼ˆæ ‘è“æ´¾4/RK3399/ç”µè§†ç›’å­ï¼‰
          - x86_64         # x86 64ä½ï¼ˆPC/æœåŠ¡å™¨/è™šæ‹Ÿæœºï¼‰
          - mips           # MIPS 32ä½å¤§ç«¯ï¼ˆMT7621/è€è·¯ç”±å™¨ï¼‰
          - mipsel         # MIPS 32ä½å°ç«¯ï¼ˆMT7620/MT7621ï¼‰
          - arm_cortex-a7  # ARM Cortex-A7ï¼ˆIPQ40xx/MT7623/å…¨å¿—H3ï¼‰
          - arm_cortex-a53 # ARM Cortex-A53ï¼ˆMT7622/éƒ¨åˆ†64ä½è®¾å¤‡ï¼‰
          - riscv64        # RISC-V 64ä½ï¼ˆæ–°æ¶æ„å¼€å‘æ¿ï¼‰
      libc:
        description: 'Cåº“ç±»å‹ï¼ˆåµŒå…¥å¼æ¨èmuslï¼‰'
        required: true
        default: 'musl'
        type: choice
        options:
          - musl   # è½»é‡çº§ï¼ŒåµŒå…¥å¼æ¨è
          - glibc  # åŠŸèƒ½å®Œæ•´
      gcc_version:
        description: 'GCCç‰ˆæœ¬ï¼ˆè¾“å…¥ç‰ˆæœ¬å·å¦‚12.3.0ï¼Œæˆ–autoè‡ªåŠ¨æ£€æµ‹ï¼‰'
        required: true
        default: 'auto'
        type: string
      clean_build:
        description: 'æ¸…ç†ä¹‹å‰çš„æ„å»ºç¼“å­˜'
        required: true
        default: false
        type: boolean
      force_rebuild:
        description: 'å¼ºåˆ¶é‡æ–°æ„å»ºï¼ˆå³ä½¿å·²å­˜åœ¨ï¼‰'
        required: true
        default: false
        type: boolean

env:
  OPENWRT_VERSION: "23.05.2"
  COMPILER_BASE_DIR: "${{ github.workspace }}/firmware-config/build-Compiler-file/compilers"

jobs:
  show-device-info:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“± æ˜¾ç¤ºæ¶æ„å¯¹åº”è®¾å¤‡
        run: |
          echo "================================================"
          echo "          ğŸ¯ ç›®æ ‡æ¶æ„è®¾å¤‡å¯¹åº”è¡¨                 "
          echo "================================================"
          echo ""
          echo "1ï¸âƒ£ aarch64 (ARM 64ä½)"
          echo "   â”œâ”€ ğŸ“± æ ‘è“æ´¾ç³»åˆ—"
          echo "   â”‚  â”œâ”€ æ ‘è“æ´¾ 4B (Raspberry Pi 4)"
          echo "   â”‚  â”œâ”€ æ ‘è“æ´¾ CM4 (Compute Module 4)"
          echo "   â”‚  â””â”€ æ ‘è“æ´¾ 400"
          echo "   â”œâ”€ ğŸ–¥ï¸ ç‘èŠ¯å¾®ç³»åˆ—"
          echo "   â”‚  â”œâ”€ RK3399 (ROCK Pi 4/NanoPi M4)"
          echo "   â”‚  â”œâ”€ RK3568 (FriendlyELEC NanoPi R5S)"
          echo "   â”‚  â””â”€ RK3588 (é«˜ç«¯å¼€å‘æ¿)"
          echo "   â”œâ”€ ğŸ“º ç”µè§†ç›’å­"
          echo "   â”‚  â”œâ”€ æ™¶æ™¨ S905 (X96 Max/Beelink GT King)"
          echo "   â”‚  â”œâ”€ æ™¶æ™¨ S912 (H96 Pro/Beelink GT1)"
          echo "   â”‚  â””â”€ æ™¶æ™¨ S922X (Odroid N2+)"
          echo "   â””â”€ ğŸ–¥ï¸ å…¶ä»–ARM64è®¾å¤‡"
          echo "      â”œâ”€ Orange Pi 5"
          echo "      â”œâ”€ Banana Pi BPI-M5"
          echo "      â””â”€ å„ç§ARMæœåŠ¡å™¨"
          echo ""
          echo "2ï¸âƒ£ x86_64 (x86 64ä½)"
          echo "   â”œâ”€ ğŸ’» ä¸ªäººç”µè„‘"
          echo "   â”‚  â”œâ”€ Intel Core i3/i5/i7/i9"
          echo "   â”‚  â”œâ”€ AMD Ryzen 3/5/7/9"
          echo "   â”‚  â””â”€ å„ç§x86ç¬”è®°æœ¬"
          echo "   â”œâ”€ ğŸ–¥ï¸ æœåŠ¡å™¨"
          echo "   â”‚  â”œâ”€ æˆ´å°”PowerEdge"
          echo "   â”‚  â”œâ”€ æƒ æ™®ProLiant"
          echo "   â”‚  â””â”€ è¶…å¾®æœåŠ¡å™¨"
          echo "   â””â”€ â˜ï¸ è™šæ‹Ÿæœº/å®¹å™¨"
          echo "      â”œâ”€ VMware/VirtualBoxè™šæ‹Ÿæœº"
          echo "      â”œâ”€ Dockerå®¹å™¨"
          echo "      â””â”€ äº‘æœåŠ¡å™¨å®ä¾‹"
          echo ""
          echo "3ï¸âƒ£ mips (MIPS 32ä½å¤§ç«¯)"
          echo "   â”œâ”€ ğŸ›œ åç¡•è·¯ç”±å™¨"
          echo "   â”‚  â”œâ”€ RT-ACRH17"
          echo "   â”‚  â”œâ”€ RT-AC85P"
          echo "   â”‚  â””â”€ RT-N56U"
          echo "   â”œâ”€ ğŸ›œ ç½‘ä»¶è·¯ç”±å™¨"
          echo "   â”‚  â”œâ”€ R7800"
          echo "   â”‚  â”œâ”€ R9000"
          echo "   â”‚  â””â”€ XR500"
          echo "   â””â”€ ğŸ›œ å…¶ä»–MIPSè®¾å¤‡"
          echo "      â”œâ”€ ä¸­å…´è·¯ç”±å™¨"
          echo "      â”œâ”€ åä¸ºæ—§æ¬¾è·¯ç”±å™¨"
          echo "      â””â”€ æ—©æœŸæ™ºèƒ½å®¶å±…è®¾å¤‡"
          echo ""
          echo "4ï¸âƒ£ mipsel (MIPS 32ä½å°ç«¯)"
          echo "   â”œâ”€ ğŸ›œ è”å‘ç§‘MT7621"
          echo "   â”‚  â”œâ”€ æ–è®¯ K2P (Phicomm K2P)"
          echo "   â”‚  â”œâ”€ Newifi 3 (æ–°è·¯ç”±3)"
          echo "   â”‚  â”œâ”€ å°ç±³è·¯ç”±å™¨ 3G"
          echo "   â”‚  â”œâ”€ çº¢ç±³è·¯ç”±å™¨ AC2100"
          echo "   â”‚  â””â”€ æè·¯ç”± B70"
          echo "   â”œâ”€ ğŸ›œ è”å‘ç§‘MT7620"
          echo "   â”‚  â”œâ”€ å°ç±³è·¯ç”±å™¨ Mini"
          echo "   â”‚  â”œâ”€ æè·¯ç”± 1S"
          echo "   â”‚  â”œâ”€ æ–è®¯ K1/K2"
          echo "   â”‚  â””â”€ è”æƒ³ Newifi Mini"
          echo "   â””â”€ ğŸ›œ å…¶ä»–MTKè®¾å¤‡"
          echo "      â”œâ”€ MT7628 (ä½ç«¯è·¯ç”±)"
          echo "      â”œâ”€ MT7688 (ç‰©è”ç½‘è®¾å¤‡)"
          echo "      â””â”€ å„ç§WiFiæ¨¡å—"
          echo ""
          echo "5ï¸âƒ£ arm_cortex-a7 (ARM Cortex-A7)"
          echo "   â”œâ”€ ğŸ›œ é«˜é€šIPQ40xxç³»åˆ— (ä½ çš„è®¾å¤‡ï¼)"
          echo "   â”‚  â”œâ”€ å°ç±³è·¯ç”±å™¨ 4Aåƒå…†ç‰ˆ"
          echo "   â”‚  â”œâ”€ çº¢ç±³è·¯ç”±å™¨ AC2100 (éƒ¨åˆ†ç‰ˆæœ¬)"
          echo "   â”‚  â”œâ”€ GL.iNet MT1300"
          echo "   â”‚  â”œâ”€ 360å®¶åº­é˜²ç«å¢™ 5Pro"
          echo "   â”‚  â”œâ”€ Linksys EA6350 v3"
          echo "   â”‚  â””â”€ Netgear R6900P"
          echo "   â”œâ”€ ğŸ›œ è”å‘ç§‘MT7623/MT7629"
          echo "   â”‚  â”œâ”€ å°ç±³è·¯ç”±å™¨ 3G (éƒ¨åˆ†ç‰ˆæœ¬)"
          echo "   â”‚  â”œâ”€ æ–è®¯ K3C"
          echo "   â”‚  â””â”€ éƒ¨åˆ†ä¼ä¸šè·¯ç”±å™¨"
          echo "   â”œâ”€ ğŸŠ å…¨å¿—H3/H2+ç³»åˆ—"
          echo "   â”‚  â”œâ”€ Orange Pi PC (é¦™æ©™æ´¾PC)"
          echo "   â”‚  â”œâ”€ Orange Pi Plus"
          echo "   â”‚  â”œâ”€ Banana Pi M2+"
          echo "   â”‚  â””â”€ NanoPi NEO"
          echo "   â””â”€ ğŸ”§ å…¶ä»–Cortex-A7è®¾å¤‡"
          echo "      â”œâ”€ æŸäº›æ™ºèƒ½æ‘„åƒå¤´"
          echo "      â”œâ”€ å·¥ä¸šæ§åˆ¶è®¾å¤‡"
          echo "      â””â”€ ä½åŠŸè€—åµŒå…¥å¼è®¾å¤‡"
          echo ""
          echo "6ï¸âƒ£ arm_cortex-a53 (ARM Cortex-A53)"
          echo "   â”œâ”€ ğŸ›œ è”å‘ç§‘MT7622"
          echo "   â”‚  â”œâ”€ å°ç±³è·¯ç”±å™¨ AX3600"
          echo "   â”‚  â”œâ”€ çº¢ç±³è·¯ç”±å™¨ AX6"
          echo "   â”‚  â””â”€ éƒ¨åˆ†WiFi6è·¯ç”±å™¨"
          echo "   â”œâ”€ ğŸ“± 64ä½è®¾å¤‡32ä½æ¨¡å¼"
          echo "   â”‚  â”œâ”€ æ ‘è“æ´¾ 3 (32ä½æ¨¡å¼)"
          echo "   â”‚  â”œâ”€ æŸäº›ç”µè§†ç›’å­"
          echo "   â”‚  â””â”€ ä½ç«¯å¹³æ¿ç”µè„‘"
          echo "   â””â”€ ğŸ”§ å…¶ä»–A53è®¾å¤‡"
          echo "      â”œâ”€ æŸäº›æ™ºèƒ½éŸ³ç®±"
          echo "      â”œâ”€ ç‰©è”ç½‘ç½‘å…³"
          echo "      â””â”€ è¾¹ç¼˜è®¡ç®—è®¾å¤‡"
          echo ""
          echo "7ï¸âƒ£ riscv64 (RISC-V 64ä½)"
          echo "   â”œâ”€ ğŸ”¬ å¼€å‘æ¿"
          echo "   â”‚  â”œâ”€ HiFive Unmatched"
          echo "   â”‚  â”œâ”€ VisionFive 2"
          echo "   â”‚  â”œâ”€ BeagleV"
          echo "   â”‚  â””â”€ SiFiveå¼€å‘æ¿"
          echo "   â”œâ”€ ğŸ–¥ï¸ æ–°å…´è®¾å¤‡"
          echo "   â”‚  â”œâ”€ æŸäº›AIåŠ é€Ÿå™¨"
          echo "   â”‚  â”œâ”€ å®šåˆ¶èŠ¯ç‰‡è®¾å¤‡"
          echo "   â”‚  â””â”€ å­¦æœ¯ç ”ç©¶è®¾å¤‡"
          echo "   â””â”€ ğŸš€ æœªæ¥è®¾å¤‡"
          echo "      â”œâ”€ RISC-Vç¬”è®°æœ¬ç”µè„‘"
          echo "      â”œâ”€ RISC-VæœåŠ¡å™¨"
          echo "      â””â”€ å„ç§åˆ›æ–°ç¡¬ä»¶"
          echo ""
          echo "================================================"
          echo "é€‰æ‹©å»ºè®®ï¼š"
          echo "1. è·¯ç”±å™¨è®¾å¤‡ â†’ æ ¹æ®èŠ¯ç‰‡å‹å·é€‰æ‹©"
          echo "2. å¼€å‘æ¿ â†’ æ ¹æ®CPUæ¶æ„é€‰æ‹©"
          echo "3. PC/æœåŠ¡å™¨ â†’ é€‰æ‹©x86_64"
          echo "4. ä¸ç¡®å®š â†’ æŸ¥çœ‹è®¾å¤‡è§„æ ¼ä¹¦æˆ–CPUä¿¡æ¯"
          echo "================================================"

  setup:
    runs-on: ubuntu-22.04
    outputs:
      gcc_version: ${{ steps.version-detection.outputs.gcc_version }}
      binutils_version: ${{ steps.version-detection.outputs.binutils_version }}
      linux_version: ${{ steps.version-detection.outputs.linux_version }}
      musl_version: ${{ steps.version-detection.outputs.musl_version }}
      glibc_version: ${{ steps.version-detection.outputs.glibc_version }}
      need_build: ${{ steps.check-existing.outputs.need_build }}
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»“åº“ï¼ˆç”¨äºæ£€æŸ¥ç°æœ‰ç¼–è¯‘å™¨ï¼‰
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
          sparse-checkout: |
            firmware-config/build-Compiler-file/compilers
          sparse-checkout-cone-mode: false

      - name: ğŸ—ï¸ åˆå§‹åŒ–
        run: |
          echo "=== äº¤å‰ç¼–è¯‘å™¨æ„å»ºç³»ç»Ÿ ==="
          mkdir -p "${{ env.COMPILER_BASE_DIR }}"
          echo "åŸºç¡€ç›®å½•: ${{ env.COMPILER_BASE_DIR }}"
          echo "å¼€å§‹æ—¶é—´: $(date)"
          
          echo "å½“å‰å·¥ä½œåŒºå†…å®¹:"
          ls -la "${{ github.workspace }}/firmware-config/build-Compiler-file/compilers" 2>/dev/null || echo "ç¼–è¯‘å™¨ç›®å½•ä¸å­˜åœ¨"

      - name: ğŸ” åŠ¨æ€æ£€æµ‹GCCç‰ˆæœ¬
        id: version-detection
        run: |
          echo "=== åŠ¨æ€æ£€æµ‹å·¥å…·é“¾ç‰ˆæœ¬ ==="
          USER_VERSION="${{ github.event.inputs.gcc_version }}"
          
          if [ "$USER_VERSION" = "auto" ] || [ "$USER_VERSION" = "" ]; then
            echo "æ­£åœ¨æ£€æµ‹æœ€æ–°GCCç¨³å®šç‰ˆæœ¬..."
            # ä»GNUå®˜ç½‘è·å–æœ€æ–°ç¨³å®šç‰ˆæœ¬
            GCC_VERSION=$(curl -s https://ftp.gnu.org/gnu/gcc/ | grep -o 'gcc-[0-9]\+\.[0-9]\+\.[0-9]\+' | sort -Vr | head -1 | cut -d- -f2)
            if [ -z "$GCC_VERSION" ]; then
              GCC_VERSION="12.3.0"
              echo "âš ï¸ æ— æ³•æ£€æµ‹æœ€æ–°ç‰ˆæœ¬ï¼Œä½¿ç”¨é»˜è®¤: $GCC_VERSION"
            else
              echo "âœ… æ£€æµ‹åˆ°æœ€æ–°GCCç‰ˆæœ¬: $GCC_VERSION"
            fi
          else
            GCC_VERSION="$USER_VERSION"
            echo "ä½¿ç”¨æŒ‡å®šGCCç‰ˆæœ¬: $GCC_VERSION"
          fi
          
          # æ£€æµ‹Binutilsç‰ˆæœ¬
          echo "æ£€æµ‹Binutilsç‰ˆæœ¬..."
          BINUTILS_VERSION=$(curl -s https://ftp.gnu.org/gnu/binutils/ | grep -o 'binutils-[0-9]\+\.[0-9]\+\.[0-9]\+' | sort -Vr | head -1 | cut -d- -f2)
          if [ -z "$BINUTILS_VERSION" ]; then
            BINUTILS_VERSION="2.40"
            echo "âš ï¸ æ— æ³•æ£€æµ‹Binutilsç‰ˆæœ¬ï¼Œä½¿ç”¨é»˜è®¤: $BINUTILS_VERSION"
          else
            echo "âœ… æ£€æµ‹åˆ°Binutilsç‰ˆæœ¬: $BINUTILS_VERSION"
          fi
          
          LINUX_VERSION="5.15.133"
          MUSL_VERSION="1.2.4"
          GLIBC_VERSION="2.37"
          
          echo "æœ€ç»ˆç‰ˆæœ¬é…ç½®:"
          echo "- GCC: $GCC_VERSION"
          echo "- Binutils: $BINUTILS_VERSION"
          echo "- Linuxå†…æ ¸: $LINUX_VERSION"
          echo "- Musl: $MUSL_VERSION"
          echo "- Glibc: $GLIBC_VERSION"
          
          echo "gcc_version=$GCC_VERSION" >> $GITHUB_OUTPUT
          echo "binutils_version=$BINUTILS_VERSION" >> $GITHUB_OUTPUT
          echo "linux_version=$LINUX_VERSION" >> $GITHUB_OUTPUT
          echo "musl_version=$MUSL_VERSION" >> $GITHUB_OUTPUT
          echo "glibc_version=$GLIBC_VERSION" >> $GITHUB_OUTPUT

      - name: ğŸ” æ£€æŸ¥ç°æœ‰ç¼–è¯‘å™¨
        id: check-existing
        run: |
          echo "=== æ£€æŸ¥ç°æœ‰ç¼–è¯‘å™¨ ==="
          echo "========================================"
          echo "         ğŸ”§ ç¼–è¯‘å™¨å®Œæ•´æ€§æ£€æŸ¥            "
          echo "========================================"
          
          ARCH="${{ github.event.inputs.target_arch }}"
          LIBC="${{ github.event.inputs.libc }}"
          GCC_VERSION='${{ steps.version-detection.outputs.gcc_version }}'
          
          if [ "$LIBC" = "musl" ]; then
            LIBC_DIR="musl"
          else
            LIBC_DIR="glibc"
          fi
          
          OUTPUT_DIR="${{ env.COMPILER_BASE_DIR }}/${ARCH}/${LIBC_DIR}/gcc-${GCC_VERSION}"
          
          echo "æ£€æŸ¥ç›®å½•: $OUTPUT_DIR"
          echo "å®Œæ•´è·¯å¾„: $(realpath "$OUTPUT_DIR" 2>/dev/null || echo "$OUTPUT_DIR")"
          
          # å®šä¹‰å®Œæ•´çš„ç¼–è¯‘å™¨å·¥å…·æ¸…å•
          echo "ğŸ“‹ å…³é”®ç¼–è¯‘å™¨å·¥å…·æ¸…å•:"
          echo ""
          
          # åŸºç¡€ç›®å½•æ£€æŸ¥
          REQUIRED_DIRS=("bin" "lib" "include" "libexec" "share" "usr")
          echo "ğŸ“ å¿…éœ€ç›®å½•æ£€æŸ¥:"
          for dir in "${REQUIRED_DIRS[@]}"; do
            if [ -d "$OUTPUT_DIR/$dir" ]; then
              echo "  âœ… ç›®å½• $dir"
            else
              echo "  âŒ ç›®å½• $dir: ç¼ºå¤±"
            fi
          done
          echo ""
          
          # æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨
          NEED_BUILD="true"
          
          if [ -d "$OUTPUT_DIR" ]; then
            echo "âœ… ç¼–è¯‘å™¨ç›®å½•å·²å­˜åœ¨"
            echo ""
            
            # è·å–ç¼–è¯‘å™¨å‰ç¼€ï¼ˆåŸºäºç›®å½•ç»“æ„æ¨æ–­ï¼‰
            COMPILER_PREFIX=""
            if [ -d "$OUTPUT_DIR/bin" ]; then
              # å°è¯•æŸ¥æ‰¾gccæ–‡ä»¶æ¥ç¡®å®šå‰ç¼€
              GCC_FILE=$(find "$OUTPUT_DIR/bin" -name "*gcc" -type f 2>/dev/null | head -1)
              if [ -n "$GCC_FILE" ]; then
                COMPILER_PREFIX=$(basename "$GCC_FILE" | sed 's/-gcc$//')
                echo "ğŸ” æ£€æµ‹åˆ°ç¼–è¯‘å™¨å‰ç¼€: $COMPILER_PREFIX"
              fi
            fi
            
            # å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°å‰ç¼€ï¼Œæ ¹æ®æ¶æ„å’Œlibcç±»å‹ç”Ÿæˆå‰ç¼€
            if [ -z "$COMPILER_PREFIX" ]; then
              case "$ARCH" in
                arm_cortex-a7)
                  if [ "$LIBC" = "musl" ]; then
                    COMPILER_PREFIX="arm-openwrt-linux-muslgnueabihf"
                  else
                    COMPILER_PREFIX="arm-openwrt-linux-gnueabihf"
                  fi
                  ;;
                aarch64)
                  if [ "$LIBC" = "musl" ]; then
                    COMPILER_PREFIX="aarch64-openwrt-linux-musl"
                  else
                    COMPILER_PREFIX="aarch64-openwrt-linux-gnu"
                  fi
                  ;;
                x86_64)
                  if [ "$LIBC" = "musl" ]; then
                    COMPILER_PREFIX="x86_64-openwrt-linux-musl"
                  else
                    COMPILER_PREFIX="x86_64-openwrt-linux-gnu"
                  fi
                  ;;
                mips)
                  if [ "$LIBC" = "musl" ]; then
                    COMPILER_PREFIX="mips-openwrt-linux-musl"
                  else
                    COMPILER_PREFIX="mips-openwrt-linux-gnu"
                  fi
                  ;;
                mipsel)
                  if [ "$LIBC" = "musl" ]; then
                    COMPILER_PREFIX="mipsel-openwrt-linux-musl"
                  else
                    COMPILER_PREFIX="mipsel-openwrt-linux-gnu"
                  fi
                  ;;
                arm_cortex-a53)
                  if [ "$LIBC" = "musl" ]; then
                    COMPILER_PREFIX="aarch64-openwrt-linux-musl"
                  else
                    COMPILER_PREFIX="aarch64-openwrt-linux-gnu"
                  fi
                  ;;
                riscv64)
                  if [ "$LIBC" = "musl" ]; then
                    COMPILER_PREFIX="riscv64-openwrt-linux-musl"
                  else
                    COMPILER_PREFIX="riscv64-openwrt-linux-gnu"
                  fi
                  ;;
                *)
                  COMPILER_PREFIX="unknown"
                  ;;
              esac
              echo "ğŸ” ä½¿ç”¨æ¶æ„æ¨æ–­ç¼–è¯‘å™¨å‰ç¼€: $COMPILER_PREFIX"
            fi
            
            echo ""
            echo "ğŸ› ï¸ å…³é”®ç¼–è¯‘å™¨æ–‡ä»¶æ£€æŸ¥:"
            echo ""
            
            # æ ¹æ®æ¶æ„å®šä¹‰å…³é”®æ–‡ä»¶æ¸…å•
            case "$ARCH" in
              aarch64)
                # AARCH64å…³é”®æ–‡ä»¶ (æ ¹æ®æ‚¨æä¾›çš„æ¸…å•)
                KEY_FILES=(
                  # ç¼–è¯‘å™¨æ ¸å¿ƒæ–‡ä»¶
                  "bin/${COMPILER_PREFIX}-gcc"
                  "bin/${COMPILER_PREFIX}-g++"
                  
                  # é“¾æ¥å™¨
                  "bin/${COMPILER_PREFIX}-ld"
                  "bin/${COMPILER_PREFIX}-ld.bfd"
                  "bin/${COMPILER_PREFIX}-ld.gold"
                  
                  # äºŒè¿›åˆ¶å·¥å…·
                  "bin/${COMPILER_PREFIX}-ar"
                  "bin/${COMPILER_PREFIX}-as"
                  "bin/${COMPILER_PREFIX}-strip"
                  "bin/${COMPILER_PREFIX}-nm"
                  "bin/${COMPILER_PREFIX}-objcopy"
                  "bin/${COMPILER_PREFIX}-objdump"
                  "bin/${COMPILER_PREFIX}-ranlib"
                  "bin/${COMPILER_PREFIX}-readelf"
                  "bin/${COMPILER_PREFIX}-size"
                  "bin/${COMPILER_PREFIX}-strings"
                  
                  # C++æ”¯æŒ
                  "bin/${COMPILER_PREFIX}-c++"
                  "bin/${COMPILER_PREFIX}-c++filt"
                  
                  # è°ƒè¯•å·¥å…·
                  "bin/${COMPILER_PREFIX}-addr2line"
                  "bin/${COMPILER_PREFIX}-gdb"
                  "bin/${COMPILER_PREFIX}-gdbtui"
                  
                  # GCCå·¥å…·
                  "bin/${COMPILER_PREFIX}-gcc-ar"
                  "bin/${COMPILER_PREFIX}-gcc-nm"
                  "bin/${COMPILER_PREFIX}-gcc-ranlib"
                  "bin/${COMPILER_PREFIX}-gcov"
                  "bin/${COMPILER_PREFIX}-gcov-dump"
                  "bin/${COMPILER_PREFIX}-gcov-tool"
                  "bin/${COMPILER_PREFIX}-gprof"
                )
                ;;
              x86_64)
                # x86_64å…³é”®æ–‡ä»¶
                KEY_FILES=(
                  # ç¼–è¯‘å™¨æ ¸å¿ƒæ–‡ä»¶
                  "bin/${COMPILER_PREFIX}-gcc"
                  "bin/${COMPILER_PREFIX}-g++"
                  
                  # é“¾æ¥å™¨
                  "bin/${COMPILER_PREFIX}-ld"
                  
                  # äºŒè¿›åˆ¶å·¥å…·
                  "bin/${COMPILER_PREFIX}-ar"
                  "bin/${COMPILER_PREFIX}-as"
                  "bin/${COMPILER_PREFIX}-strip"
                  "bin/${COMPILER_PREFIX}-nm"
                  "bin/${COMPILER_PREFIX}-objcopy"
                  "bin/${COMPILER_PREFIX}-objdump"
                  "bin/${COMPILER_PREFIX}-ranlib"
                  "bin/${COMPILER_PREFIX}-readelf"
                  "bin/${COMPILER_PREFIX}-size"
                  
                  # æ¶æ„ç‰¹æœ‰å·¥å…·
                  "bin/${COMPILER_PREFIX}-elfedit"
                  "bin/${COMPILER_PREFIX}-gcc-ranlib"
                )
                ;;
              mips)
                # MIPSå…³é”®æ–‡ä»¶
                KEY_FILES=(
                  # ç¼–è¯‘å™¨æ ¸å¿ƒæ–‡ä»¶
                  "bin/${COMPILER_PREFIX}-gcc"
                  "bin/${COMPILER_PREFIX}-g++"
                  
                  # é“¾æ¥å™¨
                  "bin/${COMPILER_PREFIX}-ld"
                  
                  # äºŒè¿›åˆ¶å·¥å…·
                  "bin/${COMPILER_PREFIX}-ar"
                  "bin/${COMPILER_PREFIX}-as"
                  "bin/${COMPILER_PREFIX}-strip"
                  "bin/${COMPILER_PREFIX}-nm"
                  "bin/${COMPILER_PREFIX}-objcopy"
                  "bin/${COMPILER_PREFIX}-objdump"
                  "bin/${COMPILER_PREFIX}-ranlib"
                  "bin/${COMPILER_PREFIX}-readelf"
                  "bin/${COMPILER_PREFIX}-size"
                  "bin/${COMPILER_PREFIX}-strings"
                  
                  # MIPSç‰¹æœ‰å·¥å…·
                  "bin/${COMPILER_PREFIX}-mips-linux-ld"
                  "bin/${COMPILER_PREFIX}-mips-linux-objdump"
                )
                ;;
              mipsel)
                # MIPSELå…³é”®æ–‡ä»¶
                KEY_FILES=(
                  # ç¼–è¯‘å™¨æ ¸å¿ƒæ–‡ä»¶
                  "bin/${COMPILER_PREFIX}-gcc"
                  "bin/${COMPILER_PREFIX}-g++"
                  
                  # é“¾æ¥å™¨
                  "bin/${COMPILER_PREFIX}-ld"
                  
                  # äºŒè¿›åˆ¶å·¥å…·
                  "bin/${COMPILER_PREFIX}-ar"
                  "bin/${COMPILER_PREFIX}-as"
                  "bin/${COMPILER_PREFIX}-strip"
                  "bin/${COMPILER_PREFIX}-nm"
                  "bin/${COMPILER_PREFIX}-objcopy"
                  "bin/${COMPILER_PREFIX}-objdump"
                  "bin/${COMPILER_PREFIX}-ranlib"
                  "bin/${COMPILER_PREFIX}-readelf"
                  "bin/${COMPILER_PREFIX}-size"
                  "bin/${COMPILER_PREFIX}-strings"
                  
                  # C++å·¥å…·
                  "bin/${COMPILER_PREFIX}-c++"
                  "bin/${COMPILER_PREFIX}-c++filt"
                )
                ;;
              arm_cortex-a7)
                # ARM Cortex-A7å…³é”®æ–‡ä»¶
                KEY_FILES=(
                  # ç¼–è¯‘å™¨æ ¸å¿ƒæ–‡ä»¶
                  "bin/${COMPILER_PREFIX}-gcc"
                  "bin/${COMPILER_PREFIX}-g++"
                  
                  # é“¾æ¥å™¨
                  "bin/${COMPILER_PREFIX}-ld"
                  "bin/${COMPILER_PREFIX}-ld.bfd"
                  
                  # äºŒè¿›åˆ¶å·¥å…·
                  "bin/${COMPILER_PREFIX}-ar"
                  "bin/${COMPILER_PREFIX}-as"
                  "bin/${COMPILER_PREFIX}-strip"
                  "bin/${COMPILER_PREFIX}-nm"
                  "bin/${COMPILER_PREFIX}-objcopy"
                  "bin/${COMPILER_PREFIX}-objdump"
                  "bin/${COMPILER_PREFIX}-ranlib"
                  "bin/${COMPILER_PREFIX}-readelf"
                  
                  # ç¡¬ä»¶æµ®ç‚¹æ”¯æŒ
                  "bin/${COMPILER_PREFIX}-gcc-${GCC_VERSION}"
                  "bin/${COMPILER_PREFIX}-gfortran"
                )
                ;;
              arm_cortex-a53)
                # ARM Cortex-A53å…³é”®æ–‡ä»¶
                KEY_FILES=(
                  # ç¼–è¯‘å™¨æ ¸å¿ƒæ–‡ä»¶
                  "bin/${COMPILER_PREFIX}-gcc"
                  "bin/${COMPILER_PREFIX}-g++"
                  
                  # é“¾æ¥å™¨
                  "bin/${COMPILER_PREFIX}-ld"
                  
                  # äºŒè¿›åˆ¶å·¥å…·
                  "bin/${COMPILER_PREFIX}-ar"
                  "bin/${COMPILER_PREFIX}-as"
                  "bin/${COMPILER_PREFIX}-strip"
                  "bin/${COMPILER_PREFIX}-objcopy"
                  "bin/${COMPILER_PREFIX}-objdump"
                  
                  # æ¶æ„ç‰¹æœ‰å·¥å…·
                  "bin/${COMPILER_PREFIX}-elfedit"
                  "bin/${COMPILER_PREFIX}-gcc-ranlib"
                )
                ;;
              riscv64)
                # RISC-Vå…³é”®æ–‡ä»¶
                KEY_FILES=(
                  # ç¼–è¯‘å™¨æ ¸å¿ƒæ–‡ä»¶
                  "bin/${COMPILER_PREFIX}-gcc"
                  "bin/${COMPILER_PREFIX}-g++"
                  
                  # é“¾æ¥å™¨
                  "bin/${COMPILER_PREFIX}-ld"
                  
                  # äºŒè¿›åˆ¶å·¥å…·
                  "bin/${COMPILER_PREFIX}-ar"
                  "bin/${COMPILER_PREFIX}-as"
                  "bin/${COMPILER_PREFIX}-strip"
                  "bin/${COMPILER_PREFIX}-nm"
                  "bin/${COMPILER_PREFIX}-objcopy"
                  "bin/${COMPILER_PREFIX}-objdump"
                  "bin/${COMPILER_PREFIX}-ranlib"
                  "bin/${COMPILER_PREFIX}-readelf"
                  
                  # RISC-Vç‰¹æœ‰å·¥å…·
                  "bin/${COMPILER_PREFIX}-elf2flt"
                  "bin/${COMPILER_PREFIX}-flthdr"
                )
                ;;
            esac
            
            # æ·»åŠ å…¬å…±çš„åº“æ–‡ä»¶æ£€æŸ¥
            KEY_LIB_FILES=(
              "lib/gcc/${COMPILER_PREFIX}/${GCC_VERSION}/libgcc.a"
              "lib/gcc/${COMPILER_PREFIX}/${GCC_VERSION}/libgcc_eh.a"
              "lib/gcc/${COMPILER_PREFIX}/${GCC_VERSION}/libgcc_s.so"
              "lib/libc.a"
              "lib/libm.a"
              "usr/include/stdio.h"
              "usr/include/stdlib.h"
              "usr/include/string.h"
              "usr/include/features.h"
            )
            
            # åˆå¹¶å·¥å…·å’Œåº“æ–‡ä»¶
            ALL_KEY_FILES=("${KEY_FILES[@]}" "${KEY_LIB_FILES[@]}")
            
            MISSING_FILES=()
            EXISTING_FILES=()
            
            # æ£€æŸ¥æ¯ä¸ªå…³é”®æ–‡ä»¶
            echo "ğŸ”§ ç¼–è¯‘å™¨å·¥å…·æ–‡ä»¶ (${#KEY_FILES[@]}ä¸ª):"
            for file_path in "${KEY_FILES[@]}"; do
              full_path="$OUTPUT_DIR/$file_path"
              if [ -f "$full_path" ] || [ -e "$full_path" ]; then
                EXISTING_FILES+=("$file_path")
                echo "  âœ… $file_path"
              else
                MISSING_FILES+=("$file_path")
                echo "  âŒ $file_path: ç¼ºå¤±"
              fi
            done
            echo ""
            
            echo "ğŸ“š å…³é”®åº“æ–‡ä»¶ (${#KEY_LIB_FILES[@]}ä¸ª):"
            for file_path in "${KEY_LIB_FILES[@]}"; do
              full_path="$OUTPUT_DIR/$file_path"
              if [ -f "$full_path" ] || [ -e "$full_path" ]; then
                EXISTING_FILES+=("$file_path")
                echo "  âœ… $file_path"
              else
                MISSING_FILES+=("$file_path")
                echo "  âŒ $file_path: ç¼ºå¤±"
              fi
            done
            
            echo ""
            echo "ğŸ“Š æ£€æŸ¥ç»Ÿè®¡:"
            echo "  - æ€»æ£€æŸ¥æ–‡ä»¶: ${#ALL_KEY_FILES[@]}"
            echo "  - å­˜åœ¨æ–‡ä»¶: ${#EXISTING_FILES[@]}"
            echo "  - ç¼ºå¤±æ–‡ä»¶: ${#MISSING_FILES[@]}"
            echo ""
            
            # å…³é”®æ–‡ä»¶ç»„æ£€æŸ¥
            echo "ğŸ”‘ å…³é”®æ–‡ä»¶ç»„å®Œæ•´æ€§:"
            
            # 1. æ ¸å¿ƒç¼–è¯‘å·¥å…·ç»„ï¼ˆå¿…é¡»å­˜åœ¨ï¼‰
            CORE_COMPILERS=(
              "bin/${COMPILER_PREFIX}-gcc"
              "bin/${COMPILER_PREFIX}-g++"
              "bin/${COMPILER_PREFIX}-ld"
            )
            
            CORE_MISSING=0
            for core_file in "${CORE_COMPILERS[@]}"; do
              if [[ " ${MISSING_FILES[*]} " == *"$core_file"* ]]; then
                CORE_MISSING=$((CORE_MISSING + 1))
              fi
            done
            
            if [ $CORE_MISSING -eq 0 ]; then
              echo "  âœ… æ ¸å¿ƒç¼–è¯‘å·¥å…·ç»„: å®Œæ•´ (gcc, g++, ld)"
            else
              echo "  âŒ æ ¸å¿ƒç¼–è¯‘å·¥å…·ç»„: ç¼ºå¤± $CORE_MISSING ä¸ªæ–‡ä»¶"
            fi
            
            # 2. åŸºç¡€äºŒè¿›åˆ¶å·¥å…·ç»„
            BINUTILS_TOOLS=(
              "bin/${COMPILER_PREFIX}-ar"
              "bin/${COMPILER_PREFIX}-as"
              "bin/${COMPILER_PREFIX}-strip"
              "bin/${COMPILER_PREFIX}-objcopy"
            )
            
            BINUTILS_MISSING=0
            for tool in "${BINUTILS_TOOLS[@]}"; do
              if [[ " ${MISSING_FILES[*]} " == *"$tool"* ]]; then
                BINUTILS_MISSING=$((BINUTILS_MISSING + 1))
              fi
            done
            
            if [ $BINUTILS_MISSING -eq 0 ]; then
              echo "  âœ… åŸºç¡€äºŒè¿›åˆ¶å·¥å…·ç»„: å®Œæ•´ (ar, as, strip, objcopy)"
            else
              echo "  âŒ åŸºç¡€äºŒè¿›åˆ¶å·¥å…·ç»„: ç¼ºå¤± $BINUTILS_MISSING ä¸ªæ–‡ä»¶"
            fi
            
            # 3. å…³é”®åº“æ–‡ä»¶ç»„
            KEY_LIBRARIES=(
              "lib/gcc/${COMPILER_PREFIX}/${GCC_VERSION}/libgcc.a"
              "lib/libc.a"
              "usr/include/stdio.h"
            )
            
            LIBRARIES_MISSING=0
            for lib in "${KEY_LIBRARIES[@]}"; do
              if [[ " ${MISSING_FILES[*]} " == *"$lib"* ]]; then
                LIBRARIES_MISSING=$((LIBRARIES_MISSING + 1))
              fi
            done
            
            if [ $LIBRARIES_MISSING -eq 0 ]; then
              echo "  âœ… å…³é”®åº“æ–‡ä»¶ç»„: å®Œæ•´ (libgcc.a, libc.a, stdio.h)"
            else
              echo "  âŒ å…³é”®åº“æ–‡ä»¶ç»„: ç¼ºå¤± $LIBRARIES_MISSING ä¸ªæ–‡ä»¶"
            fi
            
            echo ""
            
            # åˆ¤æ–­æ˜¯å¦éœ€è¦æ„å»º
            if [ ${#MISSING_FILES[@]} -eq 0 ]; then
              echo "ğŸ‰ æ‰€æœ‰å…³é”®æ–‡ä»¶éƒ½å­˜åœ¨ï¼Œç¼–è¯‘å™¨å®Œæ•´ï¼"
              
              if [ "${{ github.event.inputs.force_rebuild }}" = "true" ]; then
                echo "âš ï¸ å¼ºåˆ¶é‡æ–°æ„å»ºå·²å¯ç”¨"
                NEED_BUILD="true"
              else
                echo "âœ… è·³è¿‡æ„å»ºï¼Œä½¿ç”¨ç°æœ‰ç¼–è¯‘å™¨"
                NEED_BUILD="false"
              fi
            else
              # æ˜¾ç¤ºç¼ºå¤±çš„æ–‡ä»¶ç±»å‹ç»Ÿè®¡
              TOOL_MISSING=0
              LIB_MISSING=0
              for missing_file in "${MISSING_FILES[@]}"; do
                if [[ "$missing_file" == *"/bin/"* ]]; then
                  TOOL_MISSING=$((TOOL_MISSING + 1))
                elif [[ "$missing_file" == *"/lib/"* ]] || [[ "$missing_file" == *"/include/"* ]]; then
                  LIB_MISSING=$((LIB_MISSING + 1))
                fi
              done
              
              echo "âš ï¸ ç¼–è¯‘å™¨ä¸å®Œæ•´:"
              echo "  - ç¼ºå¤±å·¥å…·æ–‡ä»¶: $TOOL_MISSING ä¸ª"
              echo "  - ç¼ºå¤±åº“/å¤´æ–‡ä»¶: $LIB_MISSING ä¸ª"
              
              # æ˜¾ç¤ºç¼ºå¤±çš„å…³é”®æ–‡ä»¶
              if [ $CORE_MISSING -gt 0 ]; then
                echo "  â— ç¼ºå¤±æ ¸å¿ƒç¼–è¯‘å·¥å…·ï¼Œå¿…é¡»é‡æ–°æ„å»º"
              fi
              
              # æ˜¾ç¤ºç¼ºå¤±çš„å‰10ä¸ªæ–‡ä»¶
              if [ ${#MISSING_FILES[@]} -gt 0 ]; then
                echo ""
                echo "ç¼ºå¤±çš„å…³é”®æ–‡ä»¶ï¼ˆå‰10ä¸ªï¼‰:"
                for ((i=0; i<${#MISSING_FILES[@]} && i<10; i++)); do
                  echo "  - ${MISSING_FILES[$i]}"
                done
              fi
              
              NEED_BUILD="true"
            fi
            
          else
            echo "âŒ ç¼–è¯‘å™¨ç›®å½•ä¸å­˜åœ¨ï¼Œéœ€è¦æ„å»º"
            NEED_BUILD="true"
          fi
          
          echo ""
          echo "æ„å»ºå†³ç­–: $NEED_BUILD"
          echo "========================================"
          
          echo "need_build=$NEED_BUILD" >> $GITHUB_OUTPUT

  build-compiler:
    needs: [show-device-info, setup]
    if: needs.setup.outputs.need_build == 'true'
    runs-on: ubuntu-22.04
    timeout-minutes: 180
    
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»“åº“
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ“‹ æ˜¾ç¤ºæ„å»ºä¿¡æ¯
        run: |
          echo "========================================"
          echo "        äº¤å‰ç¼–è¯‘å™¨æ„å»ºä¿¡æ¯              "
          echo "========================================"
          echo "ç›®æ ‡æ¶æ„: ${{ github.event.inputs.target_arch }}"
          echo "Cåº“ç±»å‹: ${{ github.event.inputs.libc }}"
          echo "GCCç‰ˆæœ¬: ${{ needs.setup.outputs.gcc_version }}"
          echo "Binutilsç‰ˆæœ¬: ${{ needs.setup.outputs.binutils_version }}"
          echo "Linuxå†…æ ¸: ${{ needs.setup.outputs.linux_version }}"
          echo "OpenWrtç‰ˆæœ¬: ${{ env.OPENWRT_VERSION }}"
          echo "å¼ºåˆ¶é‡å»º: ${{ github.event.inputs.force_rebuild }}"
          echo "æ¸…ç†æ„å»º: ${{ github.event.inputs.clean_build }}"
          echo "æ„å»ºéœ€æ±‚: ${{ needs.setup.outputs.need_build }}"
          echo "========================================"
          echo "å¼€å§‹æ—¶é—´: $(date)"
          echo "è¿è¡ŒID: ${{ github.run_id }}"
          echo "è¿è¡Œåºå·: ${{ github.run_number }}"

      - name: ğŸ—ï¸ è®¾ç½®ç¯å¢ƒ
        run: |
          echo "=== è®¾ç½®æ„å»ºç¯å¢ƒ ==="
          ARCH="${{ github.event.inputs.target_arch }}"
          LIBC="${{ github.event.inputs.libc }}"
          echo "å¤„ç†æ¶æ„: $ARCH"
          echo "å¤„ç†Cåº“: $LIBC"
          
          case "$ARCH" in
            arm_cortex-a7)
              TARGET="armvirt"
              SUBTARGET="armv7"
              ARCH_NAME="arm"
              ARCH_DIR="arm_cortex-a7"
              PREFIX="arm-openwrt-linux"
              CPU_TYPE="cortex-a7"
              TUNE="cortex-a7"
              ABI="32"
              FLOAT_ABI="hard"
              ;;
            aarch64)
              TARGET="armvirt"
              SUBTARGET="64"
              ARCH_NAME="aarch64"
              ARCH_DIR="aarch64"
              PREFIX="aarch64-openwrt-linux"
              CPU_TYPE="cortex-a53"
              TUNE="cortex-a53"
              ABI="64"
              FLOAT_ABI=""
              ;;
            x86_64)
              TARGET="x86"
              SUBTARGET="64"
              ARCH_NAME="x86_64"
              ARCH_DIR="x86_64"
              PREFIX="x86_64-openwrt-linux"
              CPU_TYPE="x86_64"
              TUNE="generic"
              ABI="64"
              FLOAT_ABI=""
              ;;
            mips)
              TARGET="ramips"
              SUBTARGET="mt7621"
              ARCH_NAME="mips"
              ARCH_DIR="mips"
              PREFIX="mips-openwrt-linux"
              CPU_TYPE="24kc"
              TUNE="24kc"
              ABI="32"
              FLOAT_ABI="softfloat"
              ;;
            mipsel)
              TARGET="ramips"
              SUBTARGET="mt7621"
              ARCH_NAME="mipsel"
              ARCH_DIR="mipsel"
              PREFIX="mipsel-openwrt-linux"
              CPU_TYPE="24kc"
              TUNE="24kc"
              ABI="32"
              FLOAT_ABI="softfloat"
              ;;
            arm_cortex-a53)
              TARGET="rockchip"
              SUBTARGET="armv8"
              ARCH_NAME="aarch64"
              ARCH_DIR="arm_cortex-a53"
              PREFIX="aarch64-openwrt-linux"
              CPU_TYPE="cortex-a53"
              TUNE="cortex-a53"
              ABI="64"
              FLOAT_ABI=""
              ;;
            riscv64)
              TARGET="virt"
              SUBTARGET="rv64"
              ARCH_NAME="riscv64"
              ARCH_DIR="riscv64"
              PREFIX="riscv64-openwrt-linux"
              CPU_TYPE="generic"
              TUNE="generic"
              ABI="lp64d"
              FLOAT_ABI="hard"
              ;;
            *)
              echo "âŒ ä¸æ”¯æŒçš„æ¶æ„: $ARCH"
              exit 1
              ;;
          esac
          
          if [ "$LIBC" = "musl" ]; then
            PREFIX="${PREFIX}-musl"
            LIBC_SUFFIX="musl"
            LIBC_DIR="musl"
            USE_MUSL="y"
            USE_GLIBC="n"
          else
            PREFIX="${PREFIX}-gnu"
            LIBC_SUFFIX="glibc"
            LIBC_DIR="glibc"
            USE_MUSL="n"
            USE_GLIBC="y"
          fi
          
          GCC_VERSION='${{ needs.setup.outputs.gcc_version }}'
          BINUTILS_VERSION='${{ needs.setup.outputs.binutils_version }}'
          LINUX_VERSION='${{ needs.setup.outputs.linux_version }}'
          
          BUILD_ID="${ARCH_DIR}_${LIBC_DIR}_gcc-${GCC_VERSION}_$(date +%Y%m%d_%H%M%S)"
          BUILD_DIR="/tmp/compiler-build-${BUILD_ID}"
          OUTPUT_DIR="${{ env.COMPILER_BASE_DIR }}/${ARCH_DIR}/${LIBC_DIR}/gcc-${GCC_VERSION}"
          
          echo "ğŸ“Š ç¯å¢ƒé…ç½®æ±‡æ€»:"
          echo "  æ„å»ºID: $BUILD_ID"
          echo "  æ„å»ºç›®å½•: $BUILD_DIR"
          echo "  è¾“å‡ºç›®å½•: $OUTPUT_DIR"
          echo "  ç›®æ ‡å¹³å°: $TARGET/$SUBTARGET"
          echo "  æ¶æ„åç§°: $ARCH_NAME"
          echo "  æ¶æ„ç›®å½•: $ARCH_DIR"
          echo "  Cåº“ç›®å½•: $LIBC_DIR"
          echo "  ç¼–è¯‘å™¨å‰ç¼€: $PREFIX-"
          echo "  CPUç±»å‹: $CPU_TYPE"
          echo "  è°ƒä¼˜: $TUNE"
          echo "  ABI: $ABI"
          echo "  æµ®ç‚¹ABI: $FLOAT_ABI"
          echo "  GCCç‰ˆæœ¬: $GCC_VERSION"
          
          echo "BUILD_DIR=$BUILD_DIR" >> $GITHUB_ENV
          echo "OUTPUT_DIR=$OUTPUT_DIR" >> $GITHUB_ENV
          echo "TARGET=$TARGET" >> $GITHUB_ENV
          echo "SUBTARGET=$SUBTARGET" >> $GITHUB_ENV
          echo "ARCH_NAME=$ARCH_NAME" >> $GITHUB_ENV
          echo "ARCH_DIR=$ARCH_DIR" >> $GITHUB_ENV
          echo "LIBC_DIR=$LIBC_DIR" >> $GITHUB_ENV
          echo "PREFIX=$PREFIX" >> $GITHUB_ENV
          echo "CPU_TYPE=$CPU_TYPE" >> $GITHUB_ENV
          echo "TUNE=$TUNE" >> $GITHUB_ENV
          echo "ABI=$ABI" >> $GITHUB_ENV
          echo "FLOAT_ABI=$FLOAT_ABI" >> $GITHUB_ENV
          echo "USE_MUSL=$USE_MUSL" >> $GITHUB_ENV
          echo "USE_GLIBC=$USE_GLIBC" >> $GITHUB_ENV
          echo "GCC_VERSION=$GCC_VERSION" >> $GITHUB_ENV
          echo "BINUTILS_VERSION=$BINUTILS_VERSION" >> $GITHUB_ENV
          echo "LINUX_VERSION=$LINUX_VERSION" >> $GITHUB_ENV
          echo "LIBC_SUFFIX=$LIBC_SUFFIX" >> $GITHUB_ENV
          echo "BUILD_ID=$BUILD_ID" >> $GITHUB_ENV

      - name: ğŸ”§ å®‰è£…ä¾èµ–
        run: |
          echo "=== å®‰è£…æ„å»ºä¾èµ– ==="
          echo "å¼€å§‹æ—¶é—´: $(date)"
          echo "æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨..."
          sudo apt-get update
          echo "å®‰è£…æ„å»ºå·¥å…·..."
          sudo DEBIAN_FRONTEND=noninteractive apt-get install -y build-essential gcc g++ make flex bison libgmp-dev libmpfr-dev libmpc-dev libisl-dev python3 python3-dev git wget curl zlib1g-dev liblzma-dev file gawk gettext libncurses5-dev libssl-dev python3-distutils rsync unzip ncurses-term ncurses-base libncursesw5 libtinfo5 terminfo gnutls-bin libgnutls28-dev libcurl4-gnutls-dev autoconf automake autopoint libtool pkg-config texinfo gperf cmake ninja-build patchutils bc bzip2 xz-utils help2man libexpat-dev libgdbm-dev libreadline-dev libsqlite3-dev libffi-dev lzma-dev zstd libzstd-dev libelf-dev libdw-dev libcap-dev libattr1-dev libaudit-dev libiberty-dev jq info install-info
          echo "âœ… ä¾èµ–å®‰è£…å®Œæˆ"
          echo "ç»“æŸæ—¶é—´: $(date)"

      - name: ğŸ—‘ï¸ æ¸…ç†æ„å»ºç¼“å­˜
        if: ${{ github.event.inputs.clean_build == 'true' }}
        run: |
          echo "=== æ¸…ç†æ„å»ºç¼“å­˜ ==="
          echo "å¼€å§‹æ¸…ç†ç¼“å­˜..."
          sudo rm -rf /tmp/compiler-build-* 2>/dev/null || true
          echo "âœ… ç¼“å­˜æ¸…ç†å®Œæˆ"

      - name: ğŸ“¥ ä¸‹è½½OpenWrtæºç 
        run: |
          echo "=== è·å–OpenWrtæºç  ==="
          echo "å¼€å§‹æ—¶é—´: $(date)"
          mkdir -p "${{ env.BUILD_DIR }}"
          cd "${{ env.BUILD_DIR }}"
          echo "å½“å‰ç›®å½•: $(pwd)"
          echo "å…‹éš†OpenWrt ${{ env.OPENWRT_VERSION }} åˆ†æ”¯..."
          git clone --depth 1 --branch v${{ env.OPENWRT_VERSION }} https://github.com/openwrt/openwrt.git .
          CLONE_STATUS=$?
          if [ $CLONE_STATUS -ne 0 ]; then
            echo "âŒ Git cloneå¤±è´¥ï¼ŒçŠ¶æ€ç : $CLONE_STATUS"
            echo "å°è¯•ä½¿ç”¨taråŒ…ä¸‹è½½..."
            wget -q --show-progress -O openwrt.tar.xz https://github.com/openwrt/openwrt/archive/refs/tags/v${{ env.OPENWRT_VERSION }}.tar.gz
            DOWNLOAD_STATUS=$?
            if [ $DOWNLOAD_STATUS -eq 0 ]; then
              tar -xzf openwrt.tar.xz --strip-components=1
              rm -f openwrt.tar.xz
              echo "âœ… ä½¿ç”¨taråŒ…ä¸‹è½½æˆåŠŸ"
            else
              echo "âŒ æ‰€æœ‰ä¸‹è½½æ–¹æ³•éƒ½å¤±è´¥"
              exit 1
            fi
          else
            echo "âœ… Git cloneæˆåŠŸ"
          fi
          echo "æºç å¤§å°: $(du -sh . | cut -f1)"
          echo "ç»“æŸæ—¶é—´: $(date)"

      - name: ğŸ“ ç”Ÿæˆé…ç½®æ–‡ä»¶
        run: |
          echo "=== ç”ŸæˆOpenWrté…ç½® ==="
          echo "å¼€å§‹æ—¶é—´: $(date)"
          cd "${{ env.BUILD_DIR }}"
          echo "å½“å‰ç›®å½•: $(pwd)"
          
          echo "åˆ›å»ºsiteé…ç½®ç›®å½•..."
          mkdir -p include/site
          
          echo "ç”Ÿæˆsiteé…ç½®..."
          echo "ac_cv_sys_file_offset_bits=64" > include/site/${{ env.ARCH_NAME }}
          echo "ac_cv_sys_large_files=yes" >> include/site/${{ env.ARCH_NAME }}
          echo "ac_cv_c_bigendian=no" >> include/site/${{ env.ARCH_NAME }}
          
          CONFIG_FILE=".config"
          echo "ç”Ÿæˆä¸»é…ç½®æ–‡ä»¶: $CONFIG_FILE"
          
          echo "# ç›®æ ‡é…ç½®" > $CONFIG_FILE
          echo "CONFIG_TARGET_${{ env.TARGET }}=y" >> $CONFIG_FILE
          echo "CONFIG_TARGET_${{ env.TARGET }}_${{ env.SUBTARGET }}=y" >> $CONFIG_FILE
          echo "CONFIG_TARGET_ARCH=\"${{ env.ARCH_NAME }}\"" >> $CONFIG_FILE
          echo "CONFIG_TARGET_PREFIX=\"${{ env.PREFIX }}-\"" >> $CONFIG_FILE
          echo "CONFIG_EXTERNAL_TOOLCHAIN=n" >> $CONFIG_FILE
          echo "CONFIG_USE_MUSL=${{ env.USE_MUSL }}" >> $CONFIG_FILE
          echo "CONFIG_BUILD_TOOLCHAIN=y" >> $CONFIG_FILE
          echo "CONFIG_GCC_VERSION=\"${{ env.GCC_VERSION }}\"" >> $CONFIG_FILE
          echo "CONFIG_BINUTILS_VERSION=\"${{ env.BINUTILS_VERSION }}\"" >> $CONFIG_FILE
          echo "CONFIG_LINUX_VERSION=\"${{ env.LINUX_VERSION }}\"" >> $CONFIG_FILE
          echo "CONFIG_ALL=n" >> $CONFIG_FILE
          echo "CONFIG_ALL_KMODS=n" >> $CONFIG_FILE
          echo "CONFIG_ALL_NONSHARED=n" >> $CONFIG_FILE
          echo "CONFIG_DEVEL=y" >> $CONFIG_FILE
          echo "CONFIG_CCACHE=n" >> $CONFIG_FILE
          echo "CONFIG_TARGET_ROOTFS_INITRAMFS=y" >> $CONFIG_FILE
          
          if [ "${{ env.USE_MUSL }}" = "y" ]; then
            echo "CONFIG_MUSL_VERSION=\"${{ needs.setup.outputs.musl_version }}\"" >> $CONFIG_FILE
          else
            echo "CONFIG_GLIBC_VERSION=\"${{ needs.setup.outputs.glibc_version }}\"" >> $CONFIG_FILE
          fi
          
          echo "é…ç½®æ–‡ä»¶å¤§å°: $(wc -l < $CONFIG_FILE) è¡Œ"
          echo "é…ç½®æ‘˜è¦:"
          grep -E "CONFIG_TARGET|CONFIG_GCC|CONFIG_BINUTILS" $CONFIG_FILE
          echo "âœ… é…ç½®æ–‡ä»¶ç”Ÿæˆå®Œæˆ"
          echo "ç»“æŸæ—¶é—´: $(date)"

      - name: ğŸ› ï¸ ç”Ÿæˆé…ç½®èœå•ï¼ˆè¯¦ç»†ç‰ˆï¼‰
        run: |
          echo "=== ç”Ÿæˆè¯¦ç»†é…ç½®èœå• ==="
          echo "å¼€å§‹æ—¶é—´: $(date)"
          cd "${{ env.BUILD_DIR }}"
          
          echo "åº”ç”¨é»˜è®¤é…ç½®..."
          make defconfig 2>&1 | tee /tmp/make-defconfig.log
          DEFCONFIG_STATUS=${PIPESTATUS[0]}
          
          if [ $DEFCONFIG_STATUS -eq 0 ]; then
            echo "âœ… é»˜è®¤é…ç½®åº”ç”¨æˆåŠŸ"
          else
            echo "âŒ é»˜è®¤é…ç½®åº”ç”¨å¤±è´¥"
            echo "æœ€å10è¡Œè¾“å‡º:"
            tail -10 /tmp/make-defconfig.log
            exit 1
          fi
          
          echo "æ˜¾ç¤ºå½“å‰é…ç½®æ‘˜è¦..."
          echo "=============================="
          echo "        å½“å‰é…ç½®æ‘˜è¦          "
          echo "=============================="
          
          # æ£€æŸ¥å·¥å…·é“¾é…ç½®
          echo "ğŸ”§ å·¥å…·é“¾é…ç½®:"
          if grep -q "CONFIG_BUILD_TOOLCHAIN=y" .config; then
            echo "  âœ… æ„å»ºå·¥å…·é“¾: å¯ç”¨"
          else
            echo "  âŒ æ„å»ºå·¥å…·é“¾: æœªå¯ç”¨"
          fi
          
          echo "  ğŸ” GCCç‰ˆæœ¬: $(grep 'CONFIG_GCC_VERSION=' .config | cut -d'"' -f2)"
          echo "  ğŸ” Binutilsç‰ˆæœ¬: $(grep 'CONFIG_BINUTILS_VERSION=' .config | cut -d'"' -f2)"
          echo "  ğŸ” Linuxå†…æ ¸ç‰ˆæœ¬: $(grep 'CONFIG_LINUX_VERSION=' .config | cut -d'"' -f2)"
          
          # æ£€æŸ¥Cåº“é…ç½®
          echo "ğŸ“š Cåº“é…ç½®:"
          if grep -q "CONFIG_USE_MUSL=y" .config; then
            echo "  âœ… Musl Cåº“: å¯ç”¨"
            echo "  ğŸ” Muslç‰ˆæœ¬: $(grep 'CONFIG_MUSL_VERSION=' .config | cut -d'"' -f2)"
          else
            echo "  âœ… Glibc: å¯ç”¨"
            echo "  ğŸ” Glibcç‰ˆæœ¬: $(grep 'CONFIG_GLIBC_VERSION=' .config | cut -d'"' -f2)"
          fi
          
          # æ£€æŸ¥å¼€å‘é€‰é¡¹
          echo "ğŸ’» å¼€å‘é€‰é¡¹:"
          if grep -q "CONFIG_DEVEL=y" .config; then
            echo "  âœ… å¼€å‘æ¨¡å¼: å¯ç”¨"
          else
            echo "  âŒ å¼€å‘æ¨¡å¼: æœªå¯ç”¨"
          fi
          
          if grep -q "CONFIG_CCACHE=n" .config; then
            echo "  âœ… CCacheç¼“å­˜: ç¦ç”¨"
          else
            echo "  âŒ CCacheç¼“å­˜: å¯ç”¨"
          fi
          
          # æ£€æŸ¥åŒ…ç®¡ç†
          echo "ğŸ“¦ åŒ…ç®¡ç†é…ç½®:"
          if grep -q "CONFIG_ALL=n" .config; then
            echo "  âœ… æ‰€æœ‰åŒ…: ç¦ç”¨"
          else
            echo "  âŒ æ‰€æœ‰åŒ…: å¯ç”¨"
          fi
          
          if grep -q "CONFIG_ALL_KMODS=n" .config; then
            echo "  âœ… æ‰€æœ‰å†…æ ¸æ¨¡å—: ç¦ç”¨"
          else
            echo "  âŒ æ‰€æœ‰å†…æ ¸æ¨¡å—: å¯ç”¨"
          fi
          
          if grep -q "CONFIG_ALL_NONSHARED=n" .config; then
            echo "  âœ… æ‰€æœ‰éå…±äº«åº“: ç¦ç”¨"
          else
            echo "  âŒ æ‰€æœ‰éå…±äº«åº“: å¯ç”¨"
          fi
          
          # æ£€æŸ¥ç›®æ ‡é…ç½®
          echo "ğŸ¯ ç›®æ ‡å¹³å°é…ç½®:"
          echo "  ç›®æ ‡: $(grep 'CONFIG_TARGET_' .config | grep '=y' | head -1 | cut -d'=' -f1 | sed 's/CONFIG_TARGET_//')"
          echo "  å­ç›®æ ‡: $(grep 'CONFIG_TARGET_.*_SUBTARGET' .config | grep '=y' | cut -d'=' -f1 | sed 's/CONFIG_TARGET_//' | sed 's/_SUBTARGET//')"
          echo "  æ¶æ„: $(grep 'CONFIG_TARGET_ARCH=' .config | cut -d'"' -f2)"
          echo "  ç¼–è¯‘å™¨å‰ç¼€: $(grep 'CONFIG_TARGET_PREFIX=' .config | cut -d'"' -f2)"
          
          echo "=============================="
          echo "âœ… é…ç½®èœå•ç”Ÿæˆå®Œæˆ"
          echo "ç»“æŸæ—¶é—´: $(date)"

      - name: ğŸ”¨ ç¼–è¯‘å·¥å…·é“¾
        timeout-minutes: 150
        run: |
          echo "=== å¼€å§‹ç¼–è¯‘å·¥å…·é“¾ ==="
          cd "${{ env.BUILD_DIR }}"
          echo "å·¥ä½œç›®å½•: $(pwd)"
          echo "å¼€å§‹æ—¶é—´: $(date)"
          
          export FORCE_UNSAFE_CONFIGURE=1
          export TERM=xterm-256color
          export ABI=64
          export CC="gcc"
          export CXX="g++"
          
          echo "ç³»ç»Ÿä¿¡æ¯:"
          echo "- CPUæ ¸å¿ƒ: $(nproc)"
          echo "- å†…å­˜: $(free -h | grep Mem | awk '{print $2}')"
          echo "- ç£ç›˜ç©ºé—´:"
          df -h .
          
          echo "æ­¥éª¤1: åˆ›å»ºhostå·¥å…·ç›®å½•..."
          mkdir -p staging_dir/host/bin
          mkdir -p staging_dir/host/lib
          mkdir -p staging_dir/host/include
          
          echo "æ­¥éª¤2: åº”ç”¨é…ç½®..."
          make defconfig 2>&1 | tee /tmp/defconfig.log
          DEFCONFIG_STATUS=${PIPESTATUS[0]}
          if [ $DEFCONFIG_STATUS -eq 0 ]; then
            echo "âœ… defconfigæˆåŠŸ"
          else
            echo "âŒ defconfigå¤±è´¥ï¼ŒçŠ¶æ€ç : $DEFCONFIG_STATUS"
            echo "æœ€å20è¡Œè¾“å‡º:"
            tail -20 /tmp/defconfig.log
            exit 1
          fi
          
          echo "æ­¥éª¤3: ä¸‹è½½æºç åŒ…..."
          mkdir -p dl
          echo "å¼€å§‹ä¸‹è½½..."
          make -j1 download V=s 2>&1 | tee /tmp/download.log
          DOWNLOAD_STATUS=${PIPESTATUS[0]}
          if [ $DOWNLOAD_STATUS -eq 0 ]; then
            echo "âœ… ä¸‹è½½æˆåŠŸ"
          else
            echo "âš ï¸ ä¸‹è½½æœ‰è­¦å‘Šï¼Œç»§ç»­å°è¯•..."
          fi
          
          echo "æ£€æŸ¥å…³é”®åŒ…:"
          for pkg in gcc binutils linux; do
            if find dl -name "${pkg}-*.tar.*" 2>/dev/null | head -1 | grep -q .; then
              echo "  âœ… $pkg"
            else
              echo "  âš ï¸ $pkg: æœªæ‰¾åˆ°"
            fi
          done
          
          echo "æ­¥éª¤4: ç¼–è¯‘å·¥å…·é“¾..."
          echo "å¼€å§‹ç¼–è¯‘ï¼Œä½¿ç”¨ $(nproc) ä¸ªæ ¸å¿ƒ..."
          make toolchain/compile -j$(nproc) V=s 2>&1 | tee /tmp/compile.log
          COMPILE_STATUS=${PIPESTATUS[0]}
          if [ $COMPILE_STATUS -eq 0 ]; then
            echo "âœ… å·¥å…·é“¾ç¼–è¯‘æˆåŠŸ"
          else
            echo "âŒ å·¥å…·é“¾ç¼–è¯‘å¤±è´¥ï¼ŒçŠ¶æ€ç : $COMPILE_STATUS"
            echo "é”™è¯¯æ‘˜è¦:"
            grep -E "Error:|error:|failed:" /tmp/compile.log | tail -20
            exit 1
          fi
          
          echo "æ­¥éª¤5: å®‰è£…å·¥å…·é“¾..."
          make toolchain/install -j$(nproc) V=s 2>&1 | tee /tmp/install.log
          INSTALL_STATUS=${PIPESTATUS[0]}
          if [ $INSTALL_STATUS -eq 0 ]; then
            echo "âœ… å·¥å…·é“¾å®‰è£…æˆåŠŸ"
          else
            echo "âš ï¸ å®‰è£…æœ‰è­¦å‘Šï¼ŒçŠ¶æ€ç : $INSTALL_STATUS"
            echo "è­¦å‘Šæ‘˜è¦:"
            grep -E "Warning:|warning:" /tmp/install.log | tail -10
          fi
          
          echo "âœ… å·¥å…·é“¾æ„å»ºå®Œæˆ"
          echo "ç»“æŸæ—¶é—´: $(date)"
          echo "æ„å»ºç›®å½•å¤§å°: $(du -sh . | cut -f1)"

      - name: âœ… éªŒè¯æ„å»ºç»“æœ
        run: |
          echo "=== éªŒè¯æ„å»ºç»“æœ ==="
          echo "å¼€å§‹æ—¶é—´: $(date)"
          cd "${{ env.BUILD_DIR }}"
          echo "å½“å‰ç›®å½•: $(pwd)"
          
          echo "æŸ¥æ‰¾å·¥å…·é“¾ç›®å½•..."
          TOOLCHAIN_DIR=$(find staging_dir -name "toolchain-*" -type d 2>/dev/null | head -1)
          
          if [ -z "$TOOLCHAIN_DIR" ]; then
            echo "âŒ æœªæ‰¾åˆ°å·¥å…·é“¾ç›®å½•"
            echo "staging_dirå†…å®¹:"
            ls -la staging_dir/ 2>/dev/null || echo "staging_dirä¸å­˜åœ¨"
            exit 1
          fi
          
          echo "âœ… æ‰¾åˆ°å·¥å…·é“¾ç›®å½•: $TOOLCHAIN_DIR"
          echo "ç›®å½•å¤§å°: $(du -sh "$TOOLCHAIN_DIR" | cut -f1)"
          
          echo "æŸ¥æ‰¾ç¼–è¯‘å™¨..."
          COMPILER_PATH=""
          
          for search_path in "$TOOLCHAIN_DIR/bin" "$TOOLCHAIN_DIR/usr/bin" "$TOOLCHAIN_DIR"; do
            if [ -d "$search_path" ]; then
              found=$(find "$search_path" -name "*gcc" -type f 2>/dev/null | head -1)
              if [ -n "$found" ]; then
                COMPILER_PATH="$found"
                break
              fi
            fi
          done
          
          if [ -z "$COMPILER_PATH" ]; then
            echo "âŒ æœªæ‰¾åˆ°ç¼–è¯‘å™¨"
            echo "å¯èƒ½çš„gccæ–‡ä»¶:"
            find "$TOOLCHAIN_DIR" -name "*gcc" -type f 2>/dev/null | head -10
            exit 1
          fi
          
          if [ ! -x "$COMPILER_PATH" ]; then
            echo "âŒ ç¼–è¯‘å™¨ä¸å¯æ‰§è¡Œ: $COMPILER_PATH"
            exit 1
          fi
          
          COMPILER_NAME=$(basename "$COMPILER_PATH")
          echo "âœ… æ‰¾åˆ°ç¼–è¯‘å™¨: $COMPILER_NAME"
          echo "å®Œæ•´è·¯å¾„: $COMPILER_PATH"
          
          echo "ç¼–è¯‘å™¨ä¿¡æ¯:"
          "$COMPILER_PATH" --version 2>&1 | head -3
          
          echo "ç›®æ ‡ä¸‰å…ƒç»„:"
          "$COMPILER_PATH" -dumpmachine 2>&1
          
          echo "æµ‹è¯•äº¤å‰ç¼–è¯‘..."
          echo '#include <stdio.h>' > test.c
          echo 'int main() { printf("Cross-compiler test OK\\n"); return 0; }' >> test.c
          
          "$COMPILER_PATH" test.c -o test_program 2>&1
          COMPILE_TEST_STATUS=$?
          
          if [ $COMPILE_TEST_STATUS -eq 0 ] && [ -f "test_program" ]; then
            echo "âœ… äº¤å‰ç¼–è¯‘æµ‹è¯•é€šè¿‡"
            echo "ç”Ÿæˆæ–‡ä»¶ç±»å‹:"
            file test_program
            rm -f test.c test_program
          else
            echo "âŒ äº¤å‰ç¼–è¯‘æµ‹è¯•å¤±è´¥"
            exit 1
          fi
          
          echo ""
          echo "ğŸ”§ æ£€æŸ¥å…³é”®ç¼–è¯‘å™¨æ–‡ä»¶:"
          echo ""
          
          # è·å–ç¼–è¯‘å™¨å‰ç¼€
          TOOL_PREFIX=$(basename "$COMPILER_PATH" | sed 's/gcc$//')
          
          # æ ¹æ®æ¶æ„ç±»å‹ç¡®å®šè¦æ£€æŸ¥çš„å·¥å…·åˆ—è¡¨
          ARCH="${{ github.event.inputs.target_arch }}"
          
          # åˆå§‹åŒ–å…³é”®å·¥å…·æ•°ç»„
          KEY_TOOLS=()
          
          case "$ARCH" in
            aarch64)
              # AARCH64å…³é”®å·¥å…·
              KEY_TOOLS=(
                "gcc" "g++" "ld" "ld.bfd" "ld.gold"
                "ar" "as" "strip" "nm" "objcopy" "objdump"
                "ranlib" "readelf" "size" "strings"
                "c++" "c++filt" "addr2line" "gdb" "gdbtui"
                "gcc-ar" "gcc-nm" "gcc-ranlib" "gcov" "gcov-dump" "gcov-tool" "gprof"
              )
              ;;
            x86_64)
              # x86_64å…³é”®å·¥å…·
              KEY_TOOLS=(
                "gcc" "g++" "ld"
                "ar" "as" "strip" "nm" "objcopy" "objdump"
                "ranlib" "readelf" "size"
                "elfedit" "gcc-ranlib"
              )
              ;;
            mips)
              # MIPSå…³é”®å·¥å…·
              KEY_TOOLS=(
                "gcc" "g++" "ld"
                "ar" "as" "strip" "nm" "objcopy" "objdump"
                "ranlib" "readelf" "size" "strings"
                "mips-linux-ld" "mips-linux-objdump"
              )
              ;;
            mipsel)
              # MIPSELå…³é”®å·¥å…·
              KEY_TOOLS=(
                "gcc" "g++" "ld"
                "ar" "as" "strip" "nm" "objcopy" "objdump"
                "ranlib" "readelf" "size" "strings"
                "c++" "c++filt"
              )
              ;;
            arm_cortex-a7)
              # ARM Cortex-A7å…³é”®å·¥å…·
              KEY_TOOLS=(
                "gcc" "g++" "ld" "ld.bfd"
                "ar" "as" "strip" "nm" "objcopy" "objdump"
                "ranlib" "readelf"
                "gcc-${GCC_VERSION}" "gfortran"
              )
              ;;
            arm_cortex-a53)
              # ARM Cortex-A53å…³é”®å·¥å…·
              KEY_TOOLS=(
                "gcc" "g++" "ld"
                "ar" "as" "strip" "objcopy" "objdump"
                "elfedit" "gcc-ranlib"
              )
              ;;
            riscv64)
              # RISC-Vå…³é”®å·¥å…·
              KEY_TOOLS=(
                "gcc" "g++" "ld"
                "ar" "as" "strip" "nm" "objcopy" "objdump"
                "ranlib" "readelf"
                "elf2flt" "flthdr"
              )
              ;;
          esac
          
          MISSING_TOOLS=()
          EXISTING_TOOLS=()
          
          echo "ğŸ”§ ç¼–è¯‘å™¨å·¥å…·æ–‡ä»¶ (${#KEY_TOOLS[@]}ä¸ª):"
          for tool in "${KEY_TOOLS[@]}"; do
            tool_path="$TOOLCHAIN_DIR/bin/${TOOL_PREFIX}${tool}"
            if [ -x "$tool_path" ] || [ -f "$tool_path" ]; then
              EXISTING_TOOLS+=("$tool")
              echo "  âœ… bin/${TOOL_PREFIX}${tool}"
            else
              MISSING_TOOLS+=("$tool")
              echo "  âŒ bin/${TOOL_PREFIX}${tool}: ç¼ºå¤±"
            fi
          done
          
          echo ""
          echo "ğŸ“Š å·¥å…·æ£€æŸ¥ç»Ÿè®¡:"
          echo "  - æ€»æ£€æŸ¥å·¥å…·: ${#KEY_TOOLS[@]}"
          echo "  - å­˜åœ¨å·¥å…·: ${#EXISTING_TOOLS[@]}"
          echo "  - ç¼ºå¤±å·¥å…·: ${#MISSING_TOOLS[@]}"
          
          # æ£€æŸ¥å…³é”®åº“æ–‡ä»¶
          echo ""
          echo "ğŸ“š æ£€æŸ¥å…³é”®åº“æ–‡ä»¶:"
          
          KEY_LIBS=(
            "lib/gcc/${TOOL_PREFIX%/}/${{ env.GCC_VERSION }}/libgcc.a"
            "lib/gcc/${TOOL_PREFIX%/}/${{ env.GCC_VERSION }}/libgcc_eh.a"
            "lib/gcc/${TOOL_PREFIX%/}/${{ env.GCC_VERSION }}/libgcc_s.so"
            "lib/libc.a"
            "lib/libm.a"
            "usr/include/stdio.h"
            "usr/include/stdlib.h"
            "usr/include/string.h"
            "usr/include/features.h"
          )
          
          MISSING_LIBS=()
          
          for lib_path in "${KEY_LIBS[@]}"; do
            full_lib_path="$TOOLCHAIN_DIR/$lib_path"
            if [ -f "$full_lib_path" ] || [ -e "$full_lib_path" ]; then
              echo "  âœ… $lib_path"
            else
              MISSING_LIBS+=("$lib_path")
              echo "  âŒ $lib_path: ç¼ºå¤±"
            fi
          done
          
          echo ""
          
          # åˆ¤æ–­æ„å»ºæ˜¯å¦å®Œæ•´
          if [ ${#MISSING_TOOLS[@]} -eq 0 ] && [ ${#MISSING_LIBS[@]} -eq 0 ]; then
            echo "ğŸ‰ æ‰€æœ‰å…³é”®ç¼–è¯‘å™¨å’Œåº“æ–‡ä»¶éƒ½å­˜åœ¨ï¼Œæ„å»ºå®Œæ•´ï¼"
            echo "BUILD_COMPLETE=true" >> $GITHUB_ENV
          else
            if [ ${#MISSING_TOOLS[@]} -gt 0 ]; then
              echo "âš ï¸ ç¼ºå¤± ${#MISSING_TOOLS[@]} ä¸ªå…³é”®å·¥å…·"
              # æ˜¾ç¤ºç¼ºå¤±çš„æ ¸å¿ƒå·¥å…·
              CORE_TOOLS=("gcc" "g++" "ld")
              for core_tool in "${CORE_TOOLS[@]}"; do
                if [[ " ${MISSING_TOOLS[*]} " == *"$core_tool"* ]]; then
                  echo "  â— ç¼ºå¤±æ ¸å¿ƒå·¥å…·: $core_tool"
                fi
              done
            fi
            
            if [ ${#MISSING_LIBS[@]} -gt 0 ]; then
              echo "âš ï¸ ç¼ºå¤± ${#MISSING_LIBS[@]} ä¸ªå…³é”®åº“æ–‡ä»¶"
            fi
            
            # å¦‚æœç¼ºå¤±æ ¸å¿ƒå·¥å…·æˆ–ç¼ºå¤±è¿‡å¤šæ–‡ä»¶ï¼Œåˆ™æ„å»ºå¤±è´¥
            CORE_MISSING=0
            for core_tool in "${CORE_TOOLS[@]}"; do
              if [[ " ${MISSING_TOOLS[*]} " == *"$core_tool"* ]]; then
                CORE_MISSING=$((CORE_MISSING + 1))
              fi
            done
            
            if [ $CORE_MISSING -gt 0 ] || [ ${#MISSING_TOOLS[@]} -gt 5 ] || [ ${#MISSING_LIBS[@]} -gt 2 ]; then
              echo "âŒ å…³é”®æ–‡ä»¶ç¼ºå¤±è¿‡å¤šï¼Œæ„å»ºä¸å®Œæ•´"
              echo "BUILD_COMPLETE=false" >> $GITHUB_ENV
              exit 1
            else
              echo "âš ï¸ æ„å»ºåŸºæœ¬å®Œæˆï¼Œä½†æœ‰å°‘é‡æ–‡ä»¶ç¼ºå¤±"
              echo "BUILD_COMPLETE=true" >> $GITHUB_ENV
            fi
          fi
          
          echo "TOOLCHAIN_DIR=$TOOLCHAIN_DIR" >> $GITHUB_ENV
          echo "COMPILER_PATH=$COMPILER_PATH" >> $GITHUB_ENV
          echo "COMPILER_NAME=$COMPILER_NAME" >> $GITHUB_ENV
          echo "TOOL_PREFIX=$TOOL_PREFIX" >> $GITHUB_ENV
          echo "ç»“æŸæ—¶é—´: $(date)"

      - name: ğŸ’¾ ä¿å­˜ç¼–è¯‘å™¨
        if: env.BUILD_COMPLETE == 'true'
        run: |
          echo "=== ä¿å­˜ç¼–è¯‘å™¨ ==="
          echo "å¼€å§‹æ—¶é—´: $(date)"
          cd "${{ env.BUILD_DIR }}"
          
          echo "å‡†å¤‡è¾“å‡ºç›®å½•: ${{ env.OUTPUT_DIR }}"
          mkdir -p "${{ env.OUTPUT_DIR }}"
          
          if [ -d "${{ env.OUTPUT_DIR }}" ] && [ "$(ls -A "${{ env.OUTPUT_DIR }}" 2>/dev/null)" ]; then
            echo "æ¸…ç†ç°æœ‰è¾“å‡ºç›®å½•..."
            rm -rf "${{ env.OUTPUT_DIR }}"/*
          fi
          
          echo "å¤åˆ¶å·¥å…·é“¾æ–‡ä»¶..."
          if [ -d "$TOOLCHAIN_DIR" ]; then
            echo "ä»: $TOOLCHAIN_DIR"
            echo "åˆ°: ${{ env.OUTPUT_DIR }}"
            
            # å¤åˆ¶æ•´ä¸ªå·¥å…·é“¾
            cp -r "$TOOLCHAIN_DIR"/* "${{ env.OUTPUT_DIR }}/" 2>&1 | tail -20
            
            echo "âœ… å¤åˆ¶å®Œæˆ"
          else
            echo "âŒ å·¥å…·é“¾ç›®å½•ä¸å­˜åœ¨"
            exit 1
          fi
          
          echo "åˆ›å»ºå…ƒæ•°æ®æ–‡ä»¶..."
          echo "{" > "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"architecture\": \"${{ env.ARCH_DIR }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"libc\": \"${{ env.LIBC_DIR }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"target\": \"${{ env.TARGET }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"subtarget\": \"${{ env.SUBTARGET }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"compiler_prefix\": \"${{ env.PREFIX }}-\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"gcc_version\": \"${{ env.GCC_VERSION }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"binutils_version\": \"${{ env.BINUTILS_VERSION }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"linux_version\": \"${{ env.LINUX_VERSION }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"openwrt_version\": \"${{ env.OPENWRT_VERSION }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"build_date\": \"$(date -Iseconds)\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"workflow_run\": \"${{ github.run_id }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"build_id\": \"${{ env.BUILD_ID }}\"" >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "}" >> "${{ env.OUTPUT_DIR }}/metadata.json"
          
          echo "åˆ›å»ºè¯´æ˜æ–‡ä»¶..."
          echo "# ${{ env.ARCH_DIR }} ${{ env.LIBC_DIR }} äº¤å‰ç¼–è¯‘å™¨" > "${{ env.OUTPUT_DIR }}/README.md"
          echo "" >> "${{ env.OUTPUT_DIR }}/README.md"
          echo "## åŸºæœ¬ä¿¡æ¯" >> "${{ env.OUTPUT_DIR }}/README.md"
          echo "- æ¶æ„: ${{ env.ARCH_DIR }}" >> "${{ env.OUTPUT_DIR }}/README.md"
          echo "- Cåº“: ${{ env.LIBC_DIR }}" >> "${{ env.OUTPUT_DIR }}/README.md"
          echo "- GCCç‰ˆæœ¬: ${{ env.GCC_VERSION }}" >> "${{ env.OUTPUT_DIR }}/README.md"
          echo "- Binutilsç‰ˆæœ¬: ${{ env.BINUTILS_VERSION }}" >> "${{ env.OUTPUT_DIR }}/README.md"
          echo "- ç¼–è¯‘å™¨å‰ç¼€: ${{ env.PREFIX }}-" >> "${{ env.OUTPUT_DIR }}/README.md"
          echo "- æ„å»ºæ—¶é—´: $(date)" >> "${{ env.OUTPUT_DIR }}/README.md"
          echo "" >> "${{ env.OUTPUT_DIR }}/README.md"
          echo "## ä½¿ç”¨æ–¹æ³•" >> "${{ env.OUTPUT_DIR }}/README.md"
          echo '```bash' >> "${{ env.OUTPUT_DIR }}/README.md"
          echo "# è®¾ç½®ç¯å¢ƒå˜é‡" >> "${{ env.OUTPUT_DIR }}/README.md"
          echo "export STAGING_DIR=\"$(pwd)\"" >> "${{ env.OUTPUT_DIR }}/README.md"
          echo 'export PATH="$STAGING_DIR/bin:$PATH"' >> "${{ env.OUTPUT_DIR }}/README.md"
          echo "" >> "${{ env.OUTPUT_DIR }}/README.md"
          echo "# éªŒè¯ç¼–è¯‘å™¨" >> "${{ env.OUTPUT_DIR }}/README.md"
          echo "${{ env.PREFIX }}-gcc --version" >> "${{ env.OUTPUT_DIR }}/README.md"
          echo '```' >> "${{ env.OUTPUT_DIR }}/README.md"
          
          echo "è®¡ç®—æˆæœå¤§å°..."
          TOTAL_SIZE=$(du -sh "${{ env.OUTPUT_DIR }}" | cut -f1)
          FILE_COUNT=$(find "${{ env.OUTPUT_DIR }}" -type f | wc -l)
          DIR_COUNT=$(find "${{ env.OUTPUT_DIR }}" -type d | wc -l)
          
          echo "âœ… ç¼–è¯‘å™¨ä¿å­˜å®Œæˆ"
          echo "ç»“æŸæ—¶é—´: $(date)"
          
          echo "TOTAL_SIZE=$TOTAL_SIZE" >> $GITHUB_ENV
          echo "FILE_COUNT=$FILE_COUNT" >> $GITHUB_ENV
          echo "DIR_COUNT=$DIR_COUNT" >> $GITHUB_ENV

      - name: ğŸ“¤ æäº¤åˆ°Gitä»“åº“
        if: env.BUILD_COMPLETE == 'true'
        run: |
          echo "=== æäº¤ç¼–è¯‘å™¨åˆ°Gitä»“åº“ ==="
          echo "å¼€å§‹æ—¶é—´: $(date)"
          cd "${{ github.workspace }}"
          
          git config user.email "github-actions@github.com"
          git config user.name "GitHub Actions"
          git config pull.rebase false
          
          echo "æ‹‰å–æœ€æ–°ä»£ç ..."
          git pull origin main --no-edit
          
          echo "æ·»åŠ ç¼–è¯‘å™¨æ–‡ä»¶..."
          git add -f "firmware-config/build-Compiler-file/compilers/*"
          
          if ! git diff --cached --quiet; then
            echo "æ£€æµ‹åˆ°å˜æ›´ï¼Œåˆ›å»ºæäº¤..."
            
            git commit -m "build(compiler): æ·»åŠ  ${{ env.ARCH_DIR }}-${{ env.LIBC_DIR }} äº¤å‰ç¼–è¯‘å™¨" -m "ç‰ˆæœ¬: GCC ${{ env.GCC_VERSION }}" -m "å¤§å°: ${{ env.TOTAL_SIZE }}" -m "æ–‡ä»¶æ•°: ${{ env.FILE_COUNT }}" -m "å·¥ä½œæµ: #${{ github.run_id }}"
            
            echo "æ¨é€åˆ°ä»“åº“..."
            if git push origin main; then
              echo "âœ… ç¼–è¯‘å™¨å·²æˆåŠŸæäº¤åˆ°ä»“åº“"
            else
              echo "âš ï¸ æ¨é€å¤±è´¥ï¼Œé‡æ–°å°è¯•..."
              git pull origin main --rebase
              git push origin main
            fi
          else
            echo "æ²¡æœ‰å˜æ›´éœ€è¦æäº¤"
          fi
          
          echo "ç»“æŸæ—¶é—´: $(date)"

      - name: ğŸ“Š æ˜¾ç¤ºæœ€ç»ˆæˆæœ
        if: env.BUILD_COMPLETE == 'true'
        run: |
          echo "========================================"
          echo "          ğŸ‰ æ„å»ºå®ŒæˆæŠ¥å‘Š              "
          echo "========================================"
          echo "âœ… äº¤å‰ç¼–è¯‘å™¨æ„å»ºæˆåŠŸ!"
          echo ""
          echo "ğŸ“Š æ„å»ºä¿¡æ¯:"
          echo "- æ¶æ„: ${{ env.ARCH_DIR }}"
          echo "- Cåº“: ${{ env.LIBC_DIR }}"
          echo "- GCCç‰ˆæœ¬: ${{ env.GCC_VERSION }}"
          echo "- ç¼–è¯‘å™¨å‰ç¼€: ${{ env.PREFIX }}-"
          echo "- ç›®æ ‡å¹³å°: ${{ env.TARGET }}/${{ env.SUBTARGET }}"
          echo ""
          echo "ğŸ“¦ æˆæœç»Ÿè®¡:"
          echo "- æ€»å¤§å°: ${{ env.TOTAL_SIZE }}"
          echo "- æ–‡ä»¶æ•°é‡: ${{ env.FILE_COUNT }}"
          echo "- ç›®å½•æ•°é‡: ${{ env.DIR_COUNT }}"
          echo "- è¾“å‡ºç›®å½•: ${{ env.OUTPUT_DIR }}"
          echo ""
          echo "ğŸ› ï¸ å…³é”®ç¼–è¯‘å™¨å·¥å…·æ¸…å•:"
          echo ""
          
          # æ ¹æ®æ¶æ„æ˜¾ç¤ºä¸åŒçš„å·¥å…·æ¸…å•
          ARCH="${{ github.event.inputs.target_arch }}"
          
          case "$ARCH" in
            aarch64)
              echo "ğŸ”§ AARCH64æ¶æ„ç¼–è¯‘å™¨ (25ä¸ªå…³é”®æ–‡ä»¶):"
              echo ""
              echo "  âœ… ${{ env.PREFIX }}-gcc           - Cç¼–è¯‘å™¨"
              echo "  âœ… ${{ env.PREFIX }}-g++           - C++ç¼–è¯‘å™¨"
              echo "  âœ… ${{ env.PREFIX }}-ld            - é“¾æ¥å™¨"
              echo "  âœ… ${{ env.PREFIX }}-ld.bfd        - BFDé“¾æ¥å™¨"
              echo "  âœ… ${{ env.PREFIX }}-ld.gold       - GOLDé“¾æ¥å™¨"
              echo "  âœ… ${{ env.PREFIX }}-ar            - é™æ€åº“å½’æ¡£å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-as            - æ±‡ç¼–å™¨"
              echo "  âœ… ${{ env.PREFIX }}-strip         - ç¬¦å·å‰¥ç¦»å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-nm            - ç¬¦å·åˆ—è¡¨å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-objcopy       - ç›®æ ‡æ–‡ä»¶å¤åˆ¶å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-objdump       - ç›®æ ‡æ–‡ä»¶åæ±‡ç¼–å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-ranlib        - åº“ç´¢å¼•ç”Ÿæˆå·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-readelf       - ELFæ–‡ä»¶åˆ†æå·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-size          - æ®µå¤§å°ç»Ÿè®¡å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-strings       - å­—ç¬¦ä¸²æå–å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-c++           - C++é“¾æ¥å™¨"
              echo "  âœ… ${{ env.PREFIX }}-c++filt       - C++ç¬¦å·è¿˜åŸå·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-addr2line     - åœ°å€è½¬æ¢å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-gdb           - GNUè°ƒè¯•å™¨"
              echo "  âœ… ${{ env.PREFIX }}-gdbtui        - æ–‡æœ¬ç•Œé¢è°ƒè¯•å™¨"
              echo "  âœ… ${{ env.PREFIX }}-gcc-ar        - GCCå½’æ¡£åŒ…è£…å™¨"
              echo "  âœ… ${{ env.PREFIX }}-gcc-nm        - GCCç¬¦å·åŒ…è£…å™¨"
              echo "  âœ… ${{ env.PREFIX }}-gcc-ranlib    - GCCç´¢å¼•åŒ…è£…å™¨"
              echo "  âœ… ${{ env.PREFIX }}-gcov          - ä»£ç è¦†ç›–ç‡å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-gcov-dump     - GCOVæ•°æ®è½¬å‚¨å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-gcov-tool     - GCOVå·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-gprof         - æ€§èƒ½åˆ†æå·¥å…·"
              ;;
            x86_64)
              echo "ğŸ”§ x86_64æ¶æ„ç¼–è¯‘å™¨ (13ä¸ªå…³é”®æ–‡ä»¶):"
              echo ""
              echo "  âœ… ${{ env.PREFIX }}-gcc           - Cç¼–è¯‘å™¨"
              echo "  âœ… ${{ env.PREFIX }}-g++           - C++ç¼–è¯‘å™¨"
              echo "  âœ… ${{ env.PREFIX }}-ld            - é“¾æ¥å™¨"
              echo "  âœ… ${{ env.PREFIX }}-ar            - é™æ€åº“å½’æ¡£å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-as            - æ±‡ç¼–å™¨"
              echo "  âœ… ${{ env.PREFIX }}-strip         - ç¬¦å·å‰¥ç¦»å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-nm            - ç¬¦å·åˆ—è¡¨å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-objcopy       - ç›®æ ‡æ–‡ä»¶å¤åˆ¶å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-objdump       - ç›®æ ‡æ–‡ä»¶åæ±‡ç¼–å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-ranlib        - åº“ç´¢å¼•ç”Ÿæˆå·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-readelf       - ELFæ–‡ä»¶åˆ†æå·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-size          - æ®µå¤§å°ç»Ÿè®¡å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-elfedit       - ELFæ–‡ä»¶ç¼–è¾‘å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-gcc-ranlib    - GCCç´¢å¼•åŒ…è£…å™¨"
              ;;
            mips)
              echo "ğŸ”§ MIPSæ¶æ„ç¼–è¯‘å™¨ (14ä¸ªå…³é”®æ–‡ä»¶):"
              echo ""
              echo "  âœ… ${{ env.PREFIX }}-gcc           - Cç¼–è¯‘å™¨"
              echo "  âœ… ${{ env.PREFIX }}-g++           - C++ç¼–è¯‘å™¨"
              echo "  âœ… ${{ env.PREFIX }}-ld            - é“¾æ¥å™¨"
              echo "  âœ… ${{ env.PREFIX }}-ar            - é™æ€åº“å½’æ¡£å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-as            - æ±‡ç¼–å™¨"
              echo "  âœ… ${{ env.PREFIX }}-strip         - ç¬¦å·å‰¥ç¦»å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-nm            - ç¬¦å·åˆ—è¡¨å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-objcopy       - ç›®æ ‡æ–‡ä»¶å¤åˆ¶å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-objdump       - ç›®æ ‡æ–‡ä»¶åæ±‡ç¼–å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-ranlib        - åº“ç´¢å¼•ç”Ÿæˆå·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-readelf       - ELFæ–‡ä»¶åˆ†æå·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-size          - æ®µå¤§å°ç»Ÿè®¡å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-strings       - å­—ç¬¦ä¸²æå–å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-mips-linux-ld - MIPS Linuxé“¾æ¥å™¨"
              echo "  âœ… ${{ env.PREFIX }}-mips-linux-objdump - MIPS Linuxåæ±‡ç¼–å·¥å…·"
              ;;
            mipsel)
              echo "ğŸ”§ MIPSELæ¶æ„ç¼–è¯‘å™¨ (14ä¸ªå…³é”®æ–‡ä»¶):"
              echo ""
              echo "  âœ… ${{ env.PREFIX }}-gcc           - Cç¼–è¯‘å™¨"
              echo "  âœ… ${{ env.PREFIX }}-g++           - C++ç¼–è¯‘å™¨"
              echo "  âœ… ${{ env.PREFIX }}-ld            - é“¾æ¥å™¨"
              echo "  âœ… ${{ env.PREFIX }}-ar            - é™æ€åº“å½’æ¡£å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-as            - æ±‡ç¼–å™¨"
              echo "  âœ… ${{ env.PREFIX }}-strip         - ç¬¦å·å‰¥ç¦»å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-nm            - ç¬¦å·åˆ—è¡¨å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-objcopy       - ç›®æ ‡æ–‡ä»¶å¤åˆ¶å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-objdump       - ç›®æ ‡æ–‡ä»¶åæ±‡ç¼–å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-ranlib        - åº“ç´¢å¼•ç”Ÿæˆå·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-readelf       - ELFæ–‡ä»¶åˆ†æå·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-size          - æ®µå¤§å°ç»Ÿè®¡å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-strings       - å­—ç¬¦ä¸²æå–å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-c++           - C++é“¾æ¥å™¨"
              echo "  âœ… ${{ env.PREFIX }}-c++filt       - C++ç¬¦å·è¿˜åŸå·¥å…·"
              ;;
            arm_cortex-a7)
              echo "ğŸ”§ ARM Cortex-A7æ¶æ„ç¼–è¯‘å™¨ (12ä¸ªå…³é”®æ–‡ä»¶):"
              echo ""
              echo "  âœ… ${{ env.PREFIX }}-gcc           - Cç¼–è¯‘å™¨"
              echo "  âœ… ${{ env.PREFIX }}-g++           - C++ç¼–è¯‘å™¨"
              echo "  âœ… ${{ env.PREFIX }}-ld            - é“¾æ¥å™¨"
              echo "  âœ… ${{ env.PREFIX }}-ld.bfd        - BFDé“¾æ¥å™¨"
              echo "  âœ… ${{ env.PREFIX }}-ar            - é™æ€åº“å½’æ¡£å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-as            - æ±‡ç¼–å™¨"
              echo "  âœ… ${{ env.PREFIX }}-strip         - ç¬¦å·å‰¥ç¦»å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-nm            - ç¬¦å·åˆ—è¡¨å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-objcopy       - ç›®æ ‡æ–‡ä»¶å¤åˆ¶å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-objdump       - ç›®æ ‡æ–‡ä»¶åæ±‡ç¼–å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-ranlib        - åº“ç´¢å¼•ç”Ÿæˆå·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-readelf       - ELFæ–‡ä»¶åˆ†æå·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-gcc-${{ env.GCC_VERSION }} - ç‰¹å®šç‰ˆæœ¬GCC"
              echo "  âœ… ${{ env.PREFIX }}-gfortran      - Fortranç¼–è¯‘å™¨"
              ;;
            arm_cortex-a53)
              echo "ğŸ”§ ARM Cortex-A53æ¶æ„ç¼–è¯‘å™¨ (8ä¸ªå…³é”®æ–‡ä»¶):"
              echo ""
              echo "  âœ… ${{ env.PREFIX }}-gcc           - Cç¼–è¯‘å™¨"
              echo "  âœ… ${{ env.PREFIX }}-g++           - C++ç¼–è¯‘å™¨"
              echo "  âœ… ${{ env.PREFIX }}-ld            - é“¾æ¥å™¨"
              echo "  âœ… ${{ env.PREFIX }}-ar            - é™æ€åº“å½’æ¡£å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-as            - æ±‡ç¼–å™¨"
              echo "  âœ… ${{ env.PREFIX }}-strip         - ç¬¦å·å‰¥ç¦»å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-objcopy       - ç›®æ ‡æ–‡ä»¶å¤åˆ¶å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-objdump       - ç›®æ ‡æ–‡ä»¶åæ±‡ç¼–å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-elfedit       - ELFæ–‡ä»¶ç¼–è¾‘å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-gcc-ranlib    - GCCç´¢å¼•åŒ…è£…å™¨"
              ;;
            riscv64)
              echo "ğŸ”§ RISC-V 64æ¶æ„ç¼–è¯‘å™¨ (12ä¸ªå…³é”®æ–‡ä»¶):"
              echo ""
              echo "  âœ… ${{ env.PREFIX }}-gcc           - Cç¼–è¯‘å™¨"
              echo "  âœ… ${{ env.PREFIX }}-g++           - C++ç¼–è¯‘å™¨"
              echo "  âœ… ${{ env.PREFIX }}-ld            - é“¾æ¥å™¨"
              echo "  âœ… ${{ env.PREFIX }}-ar            - é™æ€åº“å½’æ¡£å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-as            - æ±‡ç¼–å™¨"
              echo "  âœ… ${{ env.PREFIX }}-strip         - ç¬¦å·å‰¥ç¦»å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-nm            - ç¬¦å·åˆ—è¡¨å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-objcopy       - ç›®æ ‡æ–‡ä»¶å¤åˆ¶å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-objdump       - ç›®æ ‡æ–‡ä»¶åæ±‡ç¼–å·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-ranlib        - åº“ç´¢å¼•ç”Ÿæˆå·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-readelf       - ELFæ–‡ä»¶åˆ†æå·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-elf2flt       - ELFè½¬FLATå·¥å…·"
              echo "  âœ… ${{ env.PREFIX }}-flthdr        - FLATæ–‡ä»¶å¤´å·¥å…·"
              ;;
          esac
          
          echo ""
          echo "ğŸ“š å…³é”®åº“æ–‡ä»¶:"
          echo "  âœ… libgcc.a          - GCCè¿è¡Œæ—¶åº“"
          echo "  âœ… libgcc_eh.a       - GCCå¼‚å¸¸å¤„ç†åº“"
          echo "  âœ… libgcc_s.so       - GCCå…±äº«åº“"
          echo "  âœ… libc.a            - Cæ ‡å‡†åº“"
          echo "  âœ… libm.a            - æ•°å­¦åº“"
          echo "  âœ… stdio.h           - æ ‡å‡†è¾“å…¥è¾“å‡ºå¤´æ–‡ä»¶"
          echo "  âœ… stdlib.h          - æ ‡å‡†åº“å¤´æ–‡ä»¶"
          echo "  âœ… string.h          - å­—ç¬¦ä¸²å¤„ç†å¤´æ–‡ä»¶"
          echo "  âœ… features.h        - ç³»ç»Ÿç‰¹æ€§å¤´æ–‡ä»¶"
          echo ""
          echo "ğŸš€ ä½¿ç”¨æ–¹æ³•:"
          echo "cd ${{ env.OUTPUT_DIR }}"
          echo "export STAGING_DIR=\$(pwd)"
          echo 'export PATH="$STAGING_DIR/bin:$PATH"'
          echo "${{ env.PREFIX }}-gcc --version"
          echo ""
          echo "â° æ„å»ºæ—¶é—´: $(date)"
          echo "========================================"

      - name: ğŸ“„ ä¸Šä¼ æ„å»ºæ—¥å¿—
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: build-logs-${{ env.BUILD_ID }}
          path: /tmp/*.log
          retention-days: 30

  skip-build:
    needs: setup
    if: needs.setup.outputs.need_build == 'false'
    runs-on: ubuntu-latest
    steps:
      - name: â­ï¸ è·³è¿‡æ„å»º
        run: |
          echo "========================================"
          echo "        â­ï¸ è·³è¿‡æ„å»ºæŠ¥å‘Š                "
          echo "========================================"
          echo "âœ… ç¼–è¯‘å™¨å·²å­˜åœ¨ä¸”å®Œæ•´ï¼Œè·³è¿‡æ„å»º"
          echo ""
          echo "ğŸ“‹ è·³è¿‡åŸå› :"
          echo "- ç¼–è¯‘å™¨ç›®å½•å·²å­˜åœ¨ä¸”å®Œæ•´"
          echo "- æœªå¯ç”¨å¼ºåˆ¶é‡æ–°æ„å»º"
          echo ""
          echo "ğŸ”§ ç°æœ‰ç¼–è¯‘å™¨ä¿¡æ¯:"
          echo "- æ¶æ„: ${{ github.event.inputs.target_arch }}"
          echo "- Cåº“: ${{ github.event.inputs.libc }}"
          echo "- GCCç‰ˆæœ¬: ${{ needs.setup.outputs.gcc_version }}"
          echo ""
          echo "ğŸ’¡ å¦‚éœ€é‡æ–°æ„å»ºï¼Œè¯·å¯ç”¨'å¼ºåˆ¶é‡æ–°æ„å»º'é€‰é¡¹"
          echo "========================================"

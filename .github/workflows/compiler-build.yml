# .github/workflows/compiler-matrix-build.yml
name: ðŸ”§ äº¤å‰ç¼–è¯‘å™¨æž„å»º

on:
  workflow_dispatch:
    inputs:
      target_arch:
        description: 'ç›®æ ‡æž¶æž„ï¼ˆIPQ40xxé€‰æ‹©arm_cortex-a7ï¼‰'
        required: true
        default: 'arm_cortex-a7'
        type: choice
        options: ['aarch64', 'x86_64', 'mips', 'mipsel', 'arm_cortex-a7', 'arm_cortex-a53', 'riscv64']
      libc:
        description: 'Cåº“ç±»åž‹ï¼ˆåµŒå…¥å¼æŽ¨èmuslï¼‰'
        required: true
        default: 'musl'
        type: choice
        options: ['musl', 'glibc']
      gcc_version:
        description: 'GCCç‰ˆæœ¬ï¼ˆè¾“å…¥ç‰ˆæœ¬å·å¦‚12.3.0ï¼Œæˆ–autoè‡ªåŠ¨æ£€æµ‹ï¼‰'
        required: true
        default: 'auto'
        type: string
      clean_build:
        description: 'æ¸…ç†ä¹‹å‰çš„æž„å»ºç¼“å­˜'
        required: true
        default: false
        type: boolean
      force_rebuild:
        description: 'å¼ºåˆ¶é‡æ–°æž„å»ºï¼ˆå³ä½¿å·²å­˜åœ¨ï¼‰'
        required: true
        default: false
        type: boolean

env:
  OPENWRT_VERSION: "23.05.2"
  COMPILER_BASE_DIR: "${{ github.workspace }}/firmware-config/build-Compiler-file/compilers"

jobs:
  show-device-info:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“± æ˜¾ç¤ºæž¶æž„å¯¹åº”è®¾å¤‡
        run: |
          echo "================================================"
          echo "          ðŸŽ¯ ç›®æ ‡æž¶æž„è®¾å¤‡å¯¹åº”è¡¨                 "
          echo "================================================"
          echo ""
          echo "1ï¸âƒ£ aarch64 (ARM 64ä½)"
          echo "   â”œâ”€ ðŸ“± æ ‘èŽ“æ´¾ç³»åˆ—"
          echo "   â”‚  â”œâ”€ æ ‘èŽ“æ´¾ 4B (Raspberry Pi 4)"
          echo "   â”‚  â”œâ”€ æ ‘èŽ“æ´¾ CM4 (Compute Module 4)"
          echo "   â”‚  â””â”€ æ ‘èŽ“æ´¾ 400"
          echo "   â”œâ”€ ðŸ–¥ï¸ ç‘žèŠ¯å¾®ç³»åˆ—"
          echo "   â”‚  â”œâ”€ RK3399 (ROCK Pi 4/NanoPi M4)"
          echo "   â”‚  â”œâ”€ RK3568 (FriendlyELEC NanoPi R5S)"
          echo "   â”‚  â””â”€ RK3588 (é«˜ç«¯å¼€å‘æ¿)"
          echo "   â”œâ”€ ðŸ“º ç”µè§†ç›’å­"
          echo "   â”‚  â”œâ”€ æ™¶æ™¨ S905 (X96 Max/Beelink GT King)"
          echo "   â”‚  â”œâ”€ æ™¶æ™¨ S912 (H96 Pro/Beelink GT1)"
          echo "   â”‚  â””â”€ æ™¶æ™¨ S922X (Odroid N2+)"
          echo "   â””â”€ ðŸ–¥ï¸ å…¶ä»–ARM64è®¾å¤‡"
          echo "      â”œâ”€ Orange Pi 5"
          echo "      â”œâ”€ Banana Pi BPI-M5"
          echo "      â””â”€ å„ç§ARMæœåŠ¡å™¨"
          echo ""
          echo "2ï¸âƒ£ x86_64 (x86 64ä½)"
          echo "   â”œâ”€ ðŸ’» ä¸ªäººç”µè„‘"
          echo "   â”‚  â”œâ”€ Intel Core i3/i5/i7/i9"
          echo "   â”‚  â”œâ”€ AMD Ryzen 3/5/7/9"
          echo "   â”‚  â””â”€ å„ç§x86ç¬”è®°æœ¬"
          echo "   â”œâ”€ ðŸ–¥ï¸ æœåŠ¡å™¨"
          echo "   â”‚  â”œâ”€ æˆ´å°”PowerEdge"
          echo "   â”‚  â”œâ”€ æƒ æ™®ProLiant"
          echo "   â”‚  â””â”€ è¶…å¾®æœåŠ¡å™¨"
          echo "   â””â”€ â˜ï¸ è™šæ‹Ÿæœº/å®¹å™¨"
          echo "      â”œâ”€ VMware/VirtualBoxè™šæ‹Ÿæœº"
          echo "      â”œâ”€ Dockerå®¹å™¨"
          echo "      â””â”€ äº‘æœåŠ¡å™¨å®žä¾‹"
          echo ""
          echo "3ï¸âƒ£ mips (MIPS 32ä½å¤§ç«¯)"
          echo "   â”œâ”€ ðŸ›œ åŽç¡•è·¯ç”±å™¨"
          echo "   â”‚  â”œâ”€ RT-ACRH17"
          echo "   â”‚  â”œâ”€ RT-AC85P"
          echo "   â”‚  â””â”€ RT-N56U"
          echo "   â”œâ”€ ðŸ›œ ç½‘ä»¶è·¯ç”±å™¨"
          echo "   â”‚  â”œâ”€ R7800"
          echo "   â”‚  â”œâ”€ R9000"
          echo "   â”‚  â””â”€ XR500"
          echo "   â””â”€ ðŸ›œ å…¶ä»–MIPSè®¾å¤‡"
          echo "      â”œâ”€ ä¸­å…´è·¯ç”±å™¨"
          echo "      â”œâ”€ åŽä¸ºæ—§æ¬¾è·¯ç”±å™¨"
          echo "      â””â”€ æ—©æœŸæ™ºèƒ½å®¶å±…è®¾å¤‡"
          echo ""
          echo "4ï¸âƒ£ mipsel (MIPS 32ä½å°ç«¯)"
          echo "   â”œâ”€ ðŸ›œ è”å‘ç§‘MT7621"
          echo "   â”‚  â”œâ”€ æ–è®¯ K2P (Phicomm K2P)"
          echo "   â”‚  â”œâ”€ Newifi 3 (æ–°è·¯ç”±3)"
          echo "   â”‚  â”œâ”€ å°ç±³è·¯ç”±å™¨ 3G"
          echo "   â”‚  â”œâ”€ çº¢ç±³è·¯ç”±å™¨ AC2100"
          echo "   â”‚  â””â”€ æžè·¯ç”± B70"
          echo "   â”œâ”€ ðŸ›œ è”å‘ç§‘MT7620"
          echo "   â”‚  â”œâ”€ å°ç±³è·¯ç”±å™¨ Mini"
          echo "   â”‚  â”œâ”€ æžè·¯ç”± 1S"
          echo "   â”‚  â”œâ”€ æ–è®¯ K1/K2"
          echo "   â”‚  â””â”€ è”æƒ³ Newifi Mini"
          echo "   â””â”€ ðŸ›œ å…¶ä»–MTKè®¾å¤‡"
          echo "      â”œâ”€ MT7628 (ä½Žç«¯è·¯ç”±)"
          echo "      â”œâ”€ MT7688 (ç‰©è”ç½‘è®¾å¤‡)"
          echo "      â””â”€ å„ç§WiFiæ¨¡å—"
          echo ""
          echo "5ï¸âƒ£ arm_cortex-a7 (ARM Cortex-A7)"
          echo "   â”œâ”€ ðŸ›œ é«˜é€šIPQ40xxç³»åˆ— (ä½ çš„è®¾å¤‡ï¼)"
          echo "   â”‚  â”œâ”€ å°ç±³è·¯ç”±å™¨ 4Aåƒå…†ç‰ˆ"
          echo "   â”‚  â”œâ”€ çº¢ç±³è·¯ç”±å™¨ AC2100 (éƒ¨åˆ†ç‰ˆæœ¬)"
          echo "   â”‚  â”œâ”€ GL.iNet MT1300"
          echo "   â”‚  â”œâ”€ 360å®¶åº­é˜²ç«å¢™ 5Pro"
          echo "   â”‚  â”œâ”€ Linksys EA6350 v3"
          echo "   â”‚  â””â”€ Netgear R6900P"
          echo "   â”œâ”€ ðŸ›œ è”å‘ç§‘MT7623/MT7629"
          echo "   â”‚  â”œâ”€ å°ç±³è·¯ç”±å™¨ 3G (éƒ¨åˆ†ç‰ˆæœ¬)"
          echo "   â”‚  â”œâ”€ æ–è®¯ K3C"
          echo "   â”‚  â””â”€ éƒ¨åˆ†ä¼ä¸šè·¯ç”±å™¨"
          echo "   â”œâ”€ ðŸŠ å…¨å¿—H3/H2+ç³»åˆ—"
          echo "   â”‚  â”œâ”€ Orange Pi PC (é¦™æ©™æ´¾PC)"
          echo "   â”‚  â”œâ”€ Orange Pi Plus"
          echo "   â”‚  â”œâ”€ Banana Pi M2+"
          echo "   â”‚  â””â”€ NanoPi NEO"
          echo "   â””â”€ ðŸ”§ å…¶ä»–Cortex-A7è®¾å¤‡"
          echo "      â”œâ”€ æŸäº›æ™ºèƒ½æ‘„åƒå¤´"
          echo "      â”œâ”€ å·¥ä¸šæŽ§åˆ¶è®¾å¤‡"
          echo "      â””â”€ ä½ŽåŠŸè€—åµŒå…¥å¼è®¾å¤‡"
          echo ""
          echo "6ï¸âƒ£ arm_cortex-a53 (ARM Cortex-A53)"
          echo "   â”œâ”€ ðŸ›œ è”å‘ç§‘MT7622"
          echo "   â”‚  â”œâ”€ å°ç±³è·¯ç”±å™¨ AX3600"
          echo "   â”‚  â”œâ”€ çº¢ç±³è·¯ç”±å™¨ AX6"
          echo "   â”‚  â””â”€ éƒ¨åˆ†WiFi6è·¯ç”±å™¨"
          echo "   â”œâ”€ ðŸ“± 64ä½è®¾å¤‡32ä½æ¨¡å¼"
          echo "   â”‚  â”œâ”€ æ ‘èŽ“æ´¾ 3 (32ä½æ¨¡å¼)"
          echo "   â”‚  â”œâ”€ æŸäº›ç”µè§†ç›’å­"
          echo "   â”‚  â””â”€ ä½Žç«¯å¹³æ¿ç”µè„‘"
          echo "   â””â”€ ðŸ”§ å…¶ä»–A53è®¾å¤‡"
          echo "      â”œâ”€ æŸäº›æ™ºèƒ½éŸ³ç®±"
          echo "      â”œâ”€ ç‰©è”ç½‘ç½‘å…³"
          echo "      â”œâ”€ è¾¹ç¼˜è®¡ç®—è®¾å¤‡"
          echo ""
          echo "7ï¸âƒ£ riscv64 (RISC-V 64ä½)"
          echo "   â”œâ”€ ðŸ”¬ å¼€å‘æ¿"
          echo "   â”‚  â”œâ”€ HiFive Unmatched"
          echo "   â”‚  â”œâ”€ VisionFive 2"
          echo "   â”‚  â”œâ”€ BeagleV"
          echo "   â”‚  â””â”€ SiFiveå¼€å‘æ¿"
          echo "   â”œâ”€ ðŸ–¥ï¸ æ–°å…´è®¾å¤‡"
          echo "   â”‚  â”œâ”€ æŸäº›AIåŠ é€Ÿå™¨"
          echo "   â”‚  â”œâ”€ å®šåˆ¶èŠ¯ç‰‡è®¾å¤‡"
          echo "   â”‚  â””â”€ å­¦æœ¯ç ”ç©¶è®¾å¤‡"
          echo "   â””â”€ ðŸš€ æœªæ¥è®¾å¤‡"
          echo "      â”œâ”€ RISC-Vç¬”è®°æœ¬ç”µè„‘"
          echo "      â”œâ”€ RISC-VæœåŠ¡å™¨"
          echo "      â”œâ”€ å„ç§åˆ›æ–°ç¡¬ä»¶"
          echo ""
          echo "================================================"
          echo "é€‰æ‹©å»ºè®®ï¼š"
          echo "1. è·¯ç”±å™¨è®¾å¤‡ â†’ æ ¹æ®èŠ¯ç‰‡åž‹å·é€‰æ‹©"
          echo "2. å¼€å‘æ¿ â†’ æ ¹æ®CPUæž¶æž„é€‰æ‹©"
          echo "3. PC/æœåŠ¡å™¨ â†’ é€‰æ‹©x86_64"
          echo "4. ä¸ç¡®å®š â†’ æŸ¥çœ‹è®¾å¤‡è§„æ ¼ä¹¦æˆ–CPUä¿¡æ¯"
          echo "================================================"

  setup:
    runs-on: ubuntu-22.04
    outputs:
      gcc_version: ${{ steps.version-detection.outputs.gcc_version }}
      binutils_version: ${{ steps.version-detection.outputs.binutils_version }}
      linux_version: ${{ steps.version-detection.outputs.linux_version }}
      musl_version: ${{ steps.version-detection.outputs.musl_version }}
      glibc_version: ${{ steps.version-detection.outputs.glibc_version }}
      need_build: ${{ steps.check-existing.outputs.need_build }}
    steps:
      - name: ðŸ“¥ æ£€å‡ºä»“åº“ï¼ˆç”¨äºŽæ£€æŸ¥çŽ°æœ‰ç¼–è¯‘å™¨ï¼‰
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
          sparse-checkout: firmware-config/build-Compiler-file/compilers
          sparse-checkout-cone-mode: false

      - name: ðŸ—ï¸ åˆå§‹åŒ–
        run: |
          echo "=== äº¤å‰ç¼–è¯‘å™¨æž„å»ºç³»ç»Ÿ ==="
          mkdir -p "${{ env.COMPILER_BASE_DIR }}"
          echo "åŸºç¡€ç›®å½•: ${{ env.COMPILER_BASE_DIR }}"
          echo "å¼€å§‹æ—¶é—´: $(date)"
          echo "å½“å‰å·¥ä½œåŒºå†…å®¹:"
          ls -la "${{ github.workspace }}/firmware-config/build-Compiler-file/compilers" 2>/dev/null || echo "ç¼–è¯‘å™¨ç›®å½•ä¸å­˜åœ¨"

      - name: ðŸ” æ™ºèƒ½ç‰ˆæœ¬æ£€æµ‹ä¸Žé€‰æ‹©
        id: version-detection
        run: |
          echo "=== æ™ºèƒ½ç‰ˆæœ¬æ£€æµ‹ä¸Žé€‰æ‹© ==="
          USER_VERSION="${{ github.event.inputs.gcc_version }}"
          TARGET_ARCH="${{ github.event.inputs.target_arch }}"
          LIBC_TYPE="${{ github.event.inputs.libc }}"
          OPENWRT_VERSION="${{ env.OPENWRT_VERSION }}"
          
          echo "è¾“å…¥å‚æ•°:"
          echo "- ç›®æ ‡æž¶æž„: $TARGET_ARCH"
          echo "- Cåº“ç±»åž‹: $LIBC_TYPE"
          echo "- ç”¨æˆ·æŒ‡å®šGCCç‰ˆæœ¬: $USER_VERSION"
          echo "OpenWrtç‰ˆæœ¬: $OPENWRT_VERSION"
          
          case "$OPENWRT_VERSION" in
            "23.05.2"|"23.05.*")
              DEFAULT_GCC="12.3.0"
              DEFAULT_BINUTILS="2.40"
              DEFAULT_LINUX="5.15.133"
              DEFAULT_MUSL="1.2.4"
              DEFAULT_GLIBC="2.37"
              ;;
            "22.03.*")
              DEFAULT_GCC="11.3.0"
              DEFAULT_BINUTILS="2.38"
              DEFAULT_LINUX="5.10.179"
              DEFAULT_MUSL="1.2.3"
              DEFAULT_GLIBC="2.35"
              ;;
            "21.02.*")
              DEFAULT_GCC="10.3.0"
              DEFAULT_BINUTILS="2.36.1"
              DEFAULT_LINUX="5.4.188"
              DEFAULT_MUSL="1.2.2"
              DEFAULT_GLIBC="2.33"
              ;;
            *)
              DEFAULT_GCC="12.3.0"
              DEFAULT_BINUTILS="2.40"
              DEFAULT_LINUX="5.15.133"
              DEFAULT_MUSL="1.2.4"
              DEFAULT_GLIBC="2.37"
              ;;
          esac
          
          case "$TARGET_ARCH" in
            "riscv64")
              ARCH_GCC="13.2.0"
              ARCH_BINUTILS="2.41"
              echo "RISC-Væž¶æž„ï¼Œä½¿ç”¨è¾ƒæ–°å·¥å…·é“¾ç‰ˆæœ¬"
              ;;
            "aarch64"|"arm_cortex-a53")
              ARCH_GCC="12.3.0"
              ARCH_BINUTILS="2.40"
              ;;
            "arm_cortex-a7")
              ARCH_GCC="11.3.0"
              ARCH_BINUTILS="2.38"
              echo "ARM Cortex-A7æž¶æž„ï¼Œä½¿ç”¨å…¼å®¹æ€§æ›´å¥½çš„GCC 11.3.0"
              ;;
            "mips"|"mipsel")
              ARCH_GCC="10.3.0"
              ARCH_BINUTILS="2.36.1"
              echo "MIPSæž¶æž„ï¼Œä½¿ç”¨è¾ƒè€å·¥å…·é“¾ç‰ˆæœ¬ä»¥ä¿è¯å…¼å®¹æ€§"
              ;;
            *)
              ARCH_GCC="$DEFAULT_GCC"
              ARCH_BINUTILS="$DEFAULT_BINUTILS"
              ;;
          esac
          
          if [ "$USER_VERSION" = "auto" ] || [ -z "$USER_VERSION" ]; then
            echo "ä½¿ç”¨æ™ºèƒ½ç‰ˆæœ¬é€‰æ‹©..."
            GCC_VERSION="$ARCH_GCC"
            
            echo "éªŒè¯GCCç‰ˆæœ¬ $GCC_VERSION æ˜¯å¦å­˜åœ¨..."
            if curl -s --head "https://ftp.gnu.org/gnu/gcc/gcc-$GCC_VERSION/gcc-$GCC_VERSION.tar.xz" | grep -q "200 OK"; then
              echo "âœ… GCC $GCC_VERSION å¯ç”¨"
            else
              echo "âš ï¸ GCC $GCC_VERSION ä¸å¯ç”¨ï¼Œå°è¯•å¤‡ç”¨ç‰ˆæœ¬"
              GCC_VERSION=$(curl -s https://ftp.gnu.org/gnu/gcc/ | grep -o 'gcc-[0-9]\+\.[0-9]\+\.[0-9]\+' | sort -Vr | head -1 | cut -d- -f2)
              if [ -z "$GCC_VERSION" ]; then
                GCC_VERSION="12.3.0"
                echo "âš ï¸ æ— æ³•æ£€æµ‹æœ€æ–°ç‰ˆæœ¬ï¼Œä½¿ç”¨é»˜è®¤: $GCC_VERSION"
              fi
            fi
          else
            GCC_VERSION="$USER_VERSION"
            echo "ä½¿ç”¨ç”¨æˆ·æŒ‡å®šç‰ˆæœ¬: $GCC_VERSION"
            
            echo "éªŒè¯ç”¨æˆ·æŒ‡å®šçš„GCCç‰ˆæœ¬ $GCC_VERSION æ˜¯å¦å­˜åœ¨..."
            if ! curl -s --head "https://ftp.gnu.org/gnu/gcc/gcc-$GCC_VERSION/gcc-$GCC_VERSION.tar.xz" | grep -q "200 OK"; then
              echo "âŒ ç”¨æˆ·æŒ‡å®šçš„GCCç‰ˆæœ¬ $GCC_VERSION ä¸å­˜åœ¨æˆ–æ— æ³•è®¿é—®"
              echo "å°è¯•æŸ¥æ‰¾å¯ç”¨çš„ç›¸è¿‘ç‰ˆæœ¬..."
              
              AVAILABLE_VERSIONS=$(curl -s https://ftp.gnu.org/gnu/gcc/ | grep -o 'gcc-[0-9]\+\.[0-9]\+\.[0-9]\+' | sort -Vr | cut -d- -f2)
              MAJOR_VERSION=$(echo "$GCC_VERSION" | cut -d. -f1)
              SIMILAR_VERSIONS=$(echo "$AVAILABLE_VERSIONS" | grep "^$MAJOR_VERSION\.")
              
              if [ -n "$SIMILAR_VERSIONS" ]; then
                NEW_VERSION=$(echo "$SIMILAR_VERSIONS" | head -1)
                echo "æ‰¾åˆ°ç›¸è¿‘ç‰ˆæœ¬: $NEW_VERSION"
                GCC_VERSION="$NEW_VERSION"
              else
                echo "ä½¿ç”¨æž¶æž„æŽ¨èç‰ˆæœ¬: $ARCH_GCC"
                GCC_VERSION="$ARCH_GCC"
              fi
            fi
          fi
          
          echo "æ ¹æ®GCC $GCC_VERSION é€‰æ‹©Binutilsç‰ˆæœ¬..."
          GCC_MAJOR=$(echo "$GCC_VERSION" | cut -d. -f1)
          
          case $GCC_MAJOR in
            13|14)
              BINUTILS_VERSION="2.41"
              ;;
            12)
              BINUTILS_VERSION="2.40"
              ;;
            11)
              BINUTILS_VERSION="2.38"
              ;;
            10)
              BINUTILS_VERSION="2.36.1"
              ;;
            9)
              BINUTILS_VERSION="2.34"
              ;;
            8)
              BINUTILS_VERSION="2.32"
              ;;
            *)
              BINUTILS_VERSION="$DEFAULT_BINUTILS"
              ;;
          esac
          
          echo "éªŒè¯Binutilsç‰ˆæœ¬ $BINUTILS_VERSION..."
          if ! curl -s --head "https://ftp.gnu.org/gnu/binutils/binutils-$BINUTILS_VERSION.tar.xz" | grep -q "200 OK"; then
            echo "âš ï¸ Binutils $BINUTILS_VERSION ä¸å¯ç”¨ï¼Œå°è¯•æ£€æµ‹æœ€æ–°ç‰ˆæœ¬"
            BINUTILS_VERSION=$(curl -s https://ftp.gnu.org/gnu/binutils/ | grep -o 'binutils-[0-9]\+\.[0-9]\+\.[0-9]\+' | sort -Vr | head -1 | cut -d- -f2)
          fi
          
          LINUX_VERSION="$DEFAULT_LINUX"
          MUSL_VERSION="$DEFAULT_MUSL"
          GLIBC_VERSION="$DEFAULT_GLIBC"
          
          echo "ðŸŽ¯ æœ€ç»ˆç‰ˆæœ¬é€‰æ‹©:"
          echo "- ç›®æ ‡æž¶æž„: $TARGET_ARCH"
          echo "- Cåº“ç±»åž‹: $LIBC_TYPE"
          echo "- GCCç‰ˆæœ¬: $GCC_VERSION (ä¸»ç‰ˆæœ¬: $GCC_MAJOR)"
          echo "- Binutilsç‰ˆæœ¬: $BINUTILS_VERSION"
          echo "- Linuxå†…æ ¸: $LINUX_VERSION"
          echo "- Muslç‰ˆæœ¬: $MUSL_VERSION"
          echo "- Glibcç‰ˆæœ¬: $GLIBC_VERSION"
          echo ""
          echo "ðŸ“Š ç‰ˆæœ¬é€‰æ‹©è¯´æ˜Ž:"
          echo "1. OpenWrt $OPENWrt_VERSION åŸºç¡€ç‰ˆæœ¬ â†’ GCC $DEFAULT_GCC"
          echo "2. æž¶æž„ $TARGET_ARCH ä¼˜åŒ– â†’ GCC $ARCH_GCC"
          echo "3. æœ€ç»ˆé€‰æ‹© â†’ GCC $GCC_VERSION"
          echo "4. ç‰ˆæœ¬éªŒè¯ â†’ ç¡®ä¿å¯ç”¨æ€§"
          
          echo "gcc_version=$GCC_VERSION" >> $GITHUB_OUTPUT
          echo "binutils_version=$BINUTILS_VERSION" >> $GITHUB_OUTPUT
          echo "linux_version=$LINUX_VERSION" >> $GITHUB_OUTPUT
          echo "musl_version=$MUSL_VERSION" >> $GITHUB_OUTPUT
          echo "glibc_version=$GLIBC_VERSION" >> $GITHUB_OUTPUT
          echo "DEBUG_GCC_VERSION=$GCC_VERSION" >> $GITHUB_ENV
          echo "DEBUG_BINUTILS_VERSION=$BINUTILS_VERSION" >> $GITHUB_ENV

      - name: ðŸ”Ž æ£€æŸ¥çŽ°æœ‰ç¼–è¯‘å™¨
        id: check-existing
        run: |
          echo "=== æ£€æŸ¥çŽ°æœ‰ç¼–è¯‘å™¨ ==="
          ARCH="${{ github.event.inputs.target_arch }}"
          LIBC="${{ github.event.inputs.libc }}"
          GCC_VERSION='${{ steps.version-detection.outputs.gcc_version }}'
          BINUTILS_VERSION='${{ steps.version-detection.outputs.binutils_version }}'
          
          echo "æ£€æŸ¥ç‰ˆæœ¬å˜é‡:"
          echo "- GCC_VERSION: '$GCC_VERSION'"
          echo "- BINUTILS_VERSION: '$BINUTILS_VERSION'"
          
          if [ "$LIBC" = "musl" ]; then
            LIBC_DIR="musl"
          else
            LIBC_DIR="glibc"
          fi
          
          OUTPUT_DIR="${{ env.COMPILER_BASE_DIR }}/${ARCH}/${LIBC_DIR}/gcc-${GCC_VERSION}_binutils-${BINUTILS_VERSION}"
          
          echo "æ£€æŸ¥ç›®å½•: $OUTPUT_DIR"
          echo "å®Œæ•´è·¯å¾„: $(realpath "$OUTPUT_DIR" 2>/dev/null || echo "$OUTPUT_DIR")"
          
          if [ -d "$OUTPUT_DIR" ]; then
            echo "âœ… ç¼–è¯‘å™¨ç›®å½•å·²å­˜åœ¨"
            echo "ç›®å½•å†…å®¹:"
            ls -la "$OUTPUT_DIR/" 2>/dev/null | head -10
            
            REQUIRED_DIRS="bin lib include libexec"
            REQUIRED_FILES="*-gcc *-g++ *-ld *-ar"
            MISSING_ITEMS=()
            
            for dir in $REQUIRED_DIRS; do
              if [ ! -d "$OUTPUT_DIR/$dir" ]; then
                MISSING_ITEMS+=("ç›®å½• $dir")
                echo "  âŒ ç¼ºå°‘ç›®å½•: $dir"
              else
                echo "  âœ… ç›®å½•å­˜åœ¨: $dir (æ–‡ä»¶æ•°: $(find "$OUTPUT_DIR/$dir" -type f 2>/dev/null | wc -l))"
              fi
            done
            
            for file_pattern in $REQUIRED_FILES; do
              found_file=$(find "$OUTPUT_DIR" -name "$file_pattern" -type f 2>/dev/null | head -1)
              if [ -n "$found_file" ]; then
                echo "  âœ… æ‰¾åˆ°æ–‡ä»¶: $(basename "$found_file")"
              else
                MISSING_ITEMS+=("æ–‡ä»¶ $file_pattern")
                echo "  âŒ ç¼ºå°‘æ–‡ä»¶: $file_pattern"
              fi
            done
            
            echo "æ£€æŸ¥ç‰ˆæœ¬ä¿¡æ¯..."
            if [ -f "$OUTPUT_DIR/metadata.json" ]; then
              echo "æ‰¾åˆ°å…ƒæ•°æ®æ–‡ä»¶"
              STORED_GCC=$(jq -r '.gcc_version' "$OUTPUT_DIR/metadata.json" 2>/dev/null)
              STORED_BINUTILS=$(jq -r '.binutils_version' "$OUTPUT_DIR/metadata.json" 2>/dev/null)
              
              if [ "$STORED_GCC" = "$GCC_VERSION" ] && [ "$STORED_BINUTILS" = "$BINUTILS_VERSION" ]; then
                echo "  âœ… ç‰ˆæœ¬åŒ¹é…: GCC $STORED_GCC, Binutils $STORED_BINUTILS"
              else
                echo "  âš ï¸ ç‰ˆæœ¬ä¸åŒ¹é…"
                echo "    å­˜å‚¨: GCC $STORED_GCC, Binutils $STORED_BINUTILS"
                echo "    è¯·æ±‚: GCC $GCC_VERSION, Binutils $BINUTILS_VERSION"
                MISSING_ITEMS+=("ç‰ˆæœ¬ä¸åŒ¹é…")
              fi
            else
              echo "  âš ï¸ æœªæ‰¾åˆ°å…ƒæ•°æ®æ–‡ä»¶"
            fi
            
            if [ ${#MISSING_ITEMS[@]} -eq 0 ]; then
              echo "âœ… ç¼–è¯‘å™¨æ–‡ä»¶å®Œæ•´"
              if [ "${{ github.event.inputs.force_rebuild }}" = "true" ]; then
                echo "âš ï¸ å¼ºåˆ¶é‡æ–°æž„å»ºå·²å¯ç”¨"
                NEED_BUILD="true"
              else
                echo "âœ… è·³è¿‡æž„å»ºï¼Œä½¿ç”¨çŽ°æœ‰ç¼–è¯‘å™¨"
                NEED_BUILD="false"
              fi
            else
              echo "âš ï¸ ç¼–è¯‘å™¨ä¸å®Œæ•´ï¼Œç¼ºå°‘:"
              for item in "${MISSING_ITEMS[@]}"; do
                echo "  - $item"
              done
              NEED_BUILD="true"
            fi
          else
            echo "âŒ ç¼–è¯‘å™¨ç›®å½•ä¸å­˜åœ¨ï¼Œéœ€è¦æž„å»º"
            echo "å°è¯•åˆ—å‡ºçˆ¶ç›®å½•å†…å®¹:"
            ls -la "$(dirname "$OUTPUT_DIR")" 2>/dev/null || echo "çˆ¶ç›®å½•ä¸å­˜åœ¨"
            NEED_BUILD="true"
          fi
          
          echo "æž„å»ºå†³ç­–: $NEED_BUILD"
          echo "need_build=$NEED_BUILD" >> $GITHUB_OUTPUT

  build-compiler:
    needs: [show-device-info, setup]
    if: needs.setup.outputs.need_build == 'true'
    runs-on: ubuntu-22.04
    timeout-minutes: 300
    
    steps:
      - name: ðŸ“¥ æ£€å‡ºä»“åº“
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ðŸ“‹ æ˜¾ç¤ºæž„å»ºä¿¡æ¯
        run: |
          echo "========================================"
          echo "        äº¤å‰ç¼–è¯‘å™¨æž„å»ºä¿¡æ¯              "
          echo "========================================"
          echo "ç›®æ ‡æž¶æž„: ${{ github.event.inputs.target_arch }}"
          echo "Cåº“ç±»åž‹: ${{ github.event.inputs.libc }}"
          echo "GCCç‰ˆæœ¬: ${{ needs.setup.outputs.gcc_version }}"
          echo "Binutilsç‰ˆæœ¬: ${{ needs.setup.outputs.binutils_version }}"
          echo "Linuxå†…æ ¸: ${{ needs.setup.outputs.linux_version }}"
          echo "Muslç‰ˆæœ¬: ${{ needs.setup.outputs.musl_version }}"
          echo "Glibcç‰ˆæœ¬: ${{ needs.setup.outputs.glibc_version }}"
          echo "OpenWrtç‰ˆæœ¬: ${{ env.OPENWRT_VERSION }}"
          echo "å¼ºåˆ¶é‡å»º: ${{ github.event.inputs.force_rebuild }}"
          echo "æ¸…ç†æž„å»º: ${{ github.event.inputs.clean_build }}"
          echo "æž„å»ºéœ€æ±‚: ${{ needs.setup.outputs.need_build }}"
          echo "========================================"
          echo "å¼€å§‹æ—¶é—´: $(date)"
          echo "è¿è¡ŒID: ${{ github.run_id }}"
          echo "è¿è¡Œåºå·: ${{ github.run_number }}"
          echo "ç‰ˆæœ¬é€‰æ‹©ç­–ç•¥:"
          echo "- æ ¹æ®OpenWrtç‰ˆæœ¬é€‰æ‹©åŸºç¡€ç‰ˆæœ¬"
          echo "- æ ¹æ®ç›®æ ‡æž¶æž„è°ƒæ•´ç‰ˆæœ¬"
          echo "- éªŒè¯ç‰ˆæœ¬å¯ç”¨æ€§"
          echo "========================================"

      - name: ðŸ—ï¸ è®¾ç½®çŽ¯å¢ƒ
        run: |
          echo "=== è®¾ç½®æž„å»ºçŽ¯å¢ƒ ==="
          ARCH="${{ github.event.inputs.target_arch }}"
          LIBC="${{ github.event.inputs.libc }}"
          
          echo "åŽŸå§‹æž¶æž„è¾“å…¥: $ARCH"
          echo "Cåº“ç±»åž‹: $LIBC"
          
          # ç¡®ä¿æž¶æž„æ˜ å°„ç»å¯¹æ­£ç¡®
          case "$ARCH" in
            arm_cortex-a7)
              TARGET="ipq40xx"
              SUBTARGET="generic"
              ARCH_NAME="arm"
              ARCH_DIR="arm_cortex-a7"
              PREFIX="arm-openwrt-linux"
              CPU_TYPE="cortex-a7"
              TUNE="cortex-a7"
              ABI="32"
              FLOAT_ABI="hard"
              echo "âœ… è®¾ç½®ARM Cortex-A7é…ç½®"
              ;;
            aarch64)
              TARGET="armvirt"
              SUBTARGET="64"
              ARCH_NAME="aarch64"
              ARCH_DIR="aarch64"
              PREFIX="aarch64-openwrt-linux"
              CPU_TYPE="cortex-a53"
              TUNE="cortex-a53"
              ABI="64"
              FLOAT_ABI=""
              echo "âœ… è®¾ç½®AArch64é…ç½®"
              ;;
            x86_64)
              TARGET="x86"
              SUBTARGET="64"
              ARCH_NAME="x86_64"
              ARCH_DIR="x86_64"
              PREFIX="x86_64-openwrt-linux"
              CPU_TYPE="x86_64"
              TUNE="generic"
              ABI="64"
              FLOAT_ABI=""
              echo "âœ… è®¾ç½®x86_64é…ç½®"
              ;;
            mips)
              TARGET="ramips"
              SUBTARGET="mt7621"
              ARCH_NAME="mips"
              ARCH_DIR="mips"
              PREFIX="mips-openwrt-linux"
              CPU_TYPE="24kc"
              TUNE="24kc"
              ABI="32"
              FLOAT_ABI="softfloat"
              echo "âœ… è®¾ç½®MIPSé…ç½®"
              ;;
            mipsel)
              TARGET="ramips"
              SUBTARGET="mt7621"
              ARCH_NAME="mipsel"
              ARCH_DIR="mipsel"
              PREFIX="mipsel-openwrt-linux"
              CPU_TYPE="24kc"
              TUNE="24kc"
              ABI="32"
              FLOAT_ABI="softfloat"
              echo "âœ… è®¾ç½®MIPSelé…ç½®"
              ;;
            arm_cortex-a53)
              TARGET="rockchip"
              SUBTARGET="armv8"
              ARCH_NAME="aarch64"
              ARCH_DIR="arm_cortex-a53"
              PREFIX="aarch64-openwrt-linux"
              CPU_TYPE="cortex-a53"
              TUNE="cortex-a53"
              ABI="64"
              FLOAT_ABI=""
              echo "âœ… è®¾ç½®ARM Cortex-A53é…ç½®"
              ;;
            riscv64)
              TARGET="virt"
              SUBTARGET="rv64"
              ARCH_NAME="riscv64"
              ARCH_DIR="riscv64"
              PREFIX="riscv64-openwrt-linux"
              CPU_TYPE="generic"
              TUNE="generic"
              ABI="lp64d"
              FLOAT_ABI="hard"
              echo "âœ… è®¾ç½®RISC-Vé…ç½®"
              ;;
            *)
              echo "âŒ ä¸æ”¯æŒçš„æž¶æž„: $ARCH"
              exit 1
              ;;
          esac
          
          if [ "$LIBC" = "musl" ]; then
            PREFIX="${PREFIX}-musl"
            LIBC_SUFFIX="musl"
            LIBC_DIR="musl"
            USE_MUSL="y"
            USE_GLIBC="n"
            LIBC_VERSION='${{ needs.setup.outputs.musl_version }}'
            echo "âœ… ä½¿ç”¨Musl Cåº“"
          else
            PREFIX="${PREFIX}-gnu"
            LIBC_SUFFIX="glibc"
            LIBC_DIR="glibc"
            USE_MUSL="n"
            USE_GLIBC="y"
            LIBC_VERSION='${{ needs.setup.outputs.glibc_version }}'
            echo "âœ… ä½¿ç”¨Glibc Cåº“"
          fi
          
          GCC_VERSION='${{ needs.setup.outputs.gcc_version }}'
          BINUTILS_VERSION='${{ needs.setup.outputs.binutils_version }}'
          LINUX_VERSION='${{ needs.setup.outputs.linux_version }}'
          
          BUILD_ID="${ARCH_DIR}_${LIBC_DIR}_gcc-${GCC_VERSION}_binutils-${BINUTILS_VERSION}_$(date +%Y%m%d_%H%M%S)"
          BUILD_DIR="/tmp/compiler-build-${BUILD_ID}"
          OUTPUT_DIR="${{ env.COMPILER_BASE_DIR }}/${ARCH_DIR}/${LIBC_DIR}/gcc-${GCC_VERSION}_binutils-${BINUTILS_VERSION}"
          
          echo "ðŸŽ¯ æœ€ç»ˆé…ç½®:"
          echo "  TARGET: $TARGET"
          echo "  SUBTARGET: $SUBTARGET"
          echo "  ARCH_NAME: $ARCH_NAME"
          echo "  ARCH_DIR: $ARCH_DIR"
          echo "  PREFIX: $PREFIX-"
          echo "  CPU_TYPE: $CPU_TYPE"
          echo "  USE_MUSL: $USE_MUSL"
          
          # è®¾ç½®çŽ¯å¢ƒå˜é‡
          echo "BUILD_DIR=$BUILD_DIR" >> $GITHUB_ENV
          echo "OUTPUT_DIR=$OUTPUT_DIR" >> $GITHUB_ENV
          echo "TARGET=$TARGET" >> $GITHUB_ENV
          echo "SUBTARGET=$SUBTARGET" >> $GITHUB_ENV
          echo "ARCH_NAME=$ARCH_NAME" >> $GITHUB_ENV
          echo "ARCH_DIR=$ARCH_DIR" >> $GITHUB_ENV
          echo "LIBC_DIR=$LIBC_DIR" >> $GITHUB_ENV
          echo "LIBC_VERSION=$LIBC_VERSION" >> $GITHUB_ENV
          echo "PREFIX=$PREFIX" >> $GITHUB_ENV
          echo "CPU_TYPE=$CPU_TYPE" >> $GITHUB_ENV
          echo "TUNE=$TUNE" >> $GITHUB_ENV
          echo "ABI=$ABI" >> $GITHUB_ENV
          echo "FLOAT_ABI=$FLOAT_ABI" >> $GITHUB_ENV
          echo "USE_MUSL=$USE_MUSL" >> $GITHUB_ENV
          echo "USE_GLIBC=$USE_GLIBC" >> $GITHUB_ENV
          echo "GCC_VERSION=$GCC_VERSION" >> $GITHUB_ENV
          echo "BINUTILS_VERSION=$BINUTILS_VERSION" >> $GITHUB_ENV
          echo "LINUX_VERSION=$LINUX_VERSION" >> $GITHUB_ENV
          echo "LIBC_SUFFIX=$LIBC_SUFFIX" >> $GITHUB_ENV
          echo "BUILD_ID=$BUILD_ID" >> $GITHUB_ENV

      - name: ðŸ”§ å®‰è£…ä¾èµ–ï¼ˆæ ¹æ®ç‰ˆæœ¬è°ƒæ•´ï¼‰
        run: |
          echo "=== å®‰è£…æž„å»ºä¾èµ– ==="
          echo "å¼€å§‹æ—¶é—´: $(date)"
          echo "GCCç‰ˆæœ¬: ${{ env.GCC_VERSION }}"
          GCC_MAJOR=$(echo "${{ env.GCC_VERSION }}" | cut -d. -f1)
          
          echo "æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨..."
          sudo apt-get update
          
          echo "å®‰è£…åŸºç¡€æž„å»ºå·¥å…·..."
          sudo DEBIAN_FRONTEND=noninteractive apt-get install -y build-essential gcc g++ make flex bison git wget curl file gawk gettext rsync unzip autoconf automake autopoint libtool pkg-config texinfo gperf cmake ninja-build patchutils bc bzip2 xz-utils help2man jq info install-info liblzma-dev zstd libzstd-dev libexpat-dev libgdbm-dev libreadline-dev libsqlite3-dev libffi-dev libelf-dev libdw-dev libcap-dev libattr1-dev libaudit-dev libiberty-dev
          
          echo "å®‰è£…ç‰ˆæœ¬ç‰¹å®šçš„ä¾èµ–..."
          if [ $GCC_MAJOR -ge 13 ]; then
            echo "GCC 13+ éœ€è¦è¾ƒæ–°çš„ä¾èµ–..."
            sudo DEBIAN_FRONTEND=noninteractive apt-get install -y libgmp-dev libmpfr-dev libmpc-dev libisl-dev libgnutls28-dev libcurl4-gnutls-dev python3 python3-dev python3-distutils libncurses5-dev libssl-dev gnutls-bin liblzma-dev zlib1g-dev
          elif [ $GCC_MAJOR -ge 11 ]; then
            echo "GCC 11-12 ä¾èµ–..."
            sudo DEBIAN_FRONTEND=noninteractive apt-get install -y libgmp-dev libmpfr-dev libmpc-dev libisl-dev libgnutls28-dev libcurl4-gnutls-dev python3 python3-dev python3-distutils libncurses5-dev libssl-dev gnutls-bin liblzma-dev zlib1g-dev
          else
            echo "GCC 10åŠä»¥ä¸‹ç‰ˆæœ¬ä¾èµ–..."
            sudo DEBIAN_FRONTEND=noninteractive apt-get install -y libgmp-dev libmpfr-dev libmpc-dev libisl-dev libgnutls28-dev python3 python3-dev libncurses5-dev libssl-dev liblzma-dev zlib1g-dev
          fi
          
          ARCH="${{ github.event.inputs.target_arch }}"
          case "$ARCH" in
            "riscv64")
              echo "RISC-Væž¶æž„éœ€è¦é¢å¤–çš„ä¾èµ–..."
              sudo DEBIAN_FRONTEND=noninteractive apt-get install -y device-tree-compiler qemu-system-riscv64 libfdt-dev
              ;;
            "aarch64"|"arm_cortex-a7"|"arm_cortex-a53")
              echo "ARMæž¶æž„ä¾èµ–..."
              sudo DEBIAN_FRONTEND=noninteractive apt-get install -y gcc-aarch64-linux-gnu gcc-arm-linux-gnueabihf
              ;;
          esac
          
          echo "âœ… ä¾èµ–å®‰è£…å®Œæˆ"
          echo "å®‰è£…çš„åŒ…ç‰ˆæœ¬:"
          gcc --version | head -1
          make --version | head -1
          python3 --version
          echo "ç»“æŸæ—¶é—´: $(date)"

      - name: ðŸ”§ é¢„æž„å»ºGMPä¿®å¤
        run: |
          echo "=== é¢„æž„å»ºGMPä¿®å¤ ==="
          echo "å¼€å§‹æ—¶é—´: $(date)"
          
          echo "å®‰è£…GMPå¼€å‘åº“..."
          sudo apt-get update
          sudo DEBIAN_FRONTEND=noninteractive apt-get install -y libgmp-dev libgmp10 libgmp3-dev
          
          echo "éªŒè¯GMPå®‰è£…..."
          echo "GMPå¤´æ–‡ä»¶ä½ç½®:"
          find /usr/include -name "gmp.h" 2>/dev/null
          
          echo "GMPåº“æ–‡ä»¶ä½ç½®:"
          find /usr/lib -name "libgmp*" 2>/dev/null | head -10
          
          echo "âœ… GMPä¿®å¤å®Œæˆ"
          echo "ç»“æŸæ—¶é—´: $(date)"

      - name: ðŸ—‘ï¸ æ¸…ç†æž„å»ºç¼“å­˜
        if: ${{ github.event.inputs.clean_build == 'true' }}
        run: |
          echo "=== æ¸…ç†æž„å»ºç¼“å­˜ ==="
          echo "å¼€å§‹æ¸…ç†ç¼“å­˜..."
          sudo rm -rf /tmp/compiler-build-* 2>/dev/null || true
          echo "âœ… ç¼“å­˜æ¸…ç†å®Œæˆ"

      - name: ðŸ“¥ ä¸‹è½½OpenWrtæºç 
        run: |
          echo "=== èŽ·å–OpenWrtæºç  ==="
          echo "å¼€å§‹æ—¶é—´: $(date)"
          mkdir -p "${{ env.BUILD_DIR }}"
          cd "${{ env.BUILD_DIR }}"
          echo "å½“å‰ç›®å½•: $(pwd)"
          echo "å…‹éš†OpenWrt ${{ env.OPENWRT_VERSION }} åˆ†æ”¯..."
          
          echo "å°è¯•æ–¹æ³•1: å…‹éš†æŒ‡å®šåˆ†æ”¯..."
          if git clone --depth 1 --branch "v${{ env.OPENWRT_VERSION }}" https://github.com/openwrt/openwrt.git .; then
            echo "âœ… Git cloneæˆåŠŸ"
          else
            echo "æ–¹æ³•1å¤±è´¥ï¼Œå°è¯•æ–¹æ³•2: å…‹éš†ä¸»åˆ†æ”¯ç„¶åŽåˆ‡æ¢..."
            git clone --depth 1 https://github.com/openwrt/openwrt.git .
            if git checkout "v${{ env.OPENWRT_VERSION }}"; then
              echo "âœ… åˆ‡æ¢ç‰ˆæœ¬æˆåŠŸ"
            else
              echo "æ–¹æ³•2å¤±è´¥ï¼Œå°è¯•æ–¹æ³•3: ä½¿ç”¨taråŒ…..."
              wget --tries=3 --timeout=60 --show-progress -O openwrt.tar.gz "https://github.com/openwrt/openwrt/archive/refs/tags/v${{ env.OPENWRT_VERSION }}.tar.gz"
              if [ $? -eq 0 ]; then
                tar -xzf openwrt.tar.gz --strip-components=1
                rm -f openwrt.tar.gz
                echo "âœ… ä½¿ç”¨taråŒ…ä¸‹è½½æˆåŠŸ"
              else
                echo "âŒ æ‰€æœ‰ä¸‹è½½æ–¹æ³•éƒ½å¤±è´¥"
                exit 1
              fi
            fi
          fi
          
          echo "æºç å¤§å°: $(du -sh . | cut -f1)"
          echo "OpenWrtç‰ˆæœ¬ç¡®è®¤:"
          grep "VERSION_NUMBER" include/version.mk 2>/dev/null || echo "ç‰ˆæœ¬æ–‡ä»¶æœªæ‰¾åˆ°"
          echo "ç»“æŸæ—¶é—´: $(date)"

      - name: ðŸŽ¯ ç«‹å³è®¾ç½®ç›®æ ‡é…ç½®
        run: |
          echo "=== ç«‹å³è®¾ç½®ç›®æ ‡é…ç½® ==="
          cd "${{ env.BUILD_DIR }}"
          
          echo "1. åˆ›å»ºåˆå§‹é…ç½®æ–‡ä»¶..."
          
          # ä¸ºç‰¹å®šç›®æ ‡åˆ›å»ºåˆå§‹é…ç½®
          case "${{ env.TARGET }}" in
            ipq40xx)
              cat > .config << EOF
CONFIG_TARGET_ipq40xx=y
CONFIG_TARGET_ipq40xx_generic=y
CONFIG_TARGET_ARCH="arm"
CONFIG_TARGET_SUFFIX="hard"
CONFIG_TARGET_PREFIX="${{ env.PREFIX }}-"
CONFIG_GCC_VERSION="${{ env.GCC_VERSION }}"
CONFIG_BINUTILS_VERSION="${{ env.BINUTILS_VERSION }}"
CONFIG_LINUX_VERSION="${{ env.LINUX_VERSION }}"
CONFIG_USE_MUSL=y
CONFIG_MUSL_VERSION="${{ env.LIBC_VERSION }}"
CONFIG_CPU_TYPE="${{ env.CPU_TYPE }}"
CONFIG_DEVEL=y
CONFIG_SDK=y
CONFIG_TARGET_OPTIMIZATION="-Os -pipe"
CONFIG_BUILD_LOG=y
EOF
              ;;
            x86)
              cat > .config << EOF
CONFIG_TARGET_x86=y
CONFIG_TARGET_x86_64=y
CONFIG_TARGET_ARCH="x86_64"
CONFIG_TARGET_PREFIX="${{ env.PREFIX }}-"
CONFIG_GCC_VERSION="${{ env.GCC_VERSION }}"
CONFIG_BINUTILS_VERSION="${{ env.BINUTILS_VERSION }}"
CONFIG_LINUX_VERSION="${{ env.LINUX_VERSION }}"
CONFIG_USE_MUSL=y
CONFIG_MUSL_VERSION="${{ env.LIBC_VERSION }}"
CONFIG_CPU_TYPE="x86_64"
CONFIG_DEVEL=y
CONFIG_SDK=y
CONFIG_TARGET_OPTIMIZATION="-Os -pipe"
CONFIG_BUILD_LOG=y
EOF
              ;;
            ramips)
              if [ "${{ env.ARCH_NAME }}" = "mips" ]; then
                cat > .config << EOF
CONFIG_TARGET_ramips=y
CONFIG_TARGET_ramips_mt7621=y
CONFIG_TARGET_ARCH="mips"
CONFIG_TARGET_PREFIX="${{ env.PREFIX }}-"
CONFIG_GCC_VERSION="${{ env.GCC_VERSION }}"
CONFIG_BINUTILS_VERSION="${{ env.BINUTILS_VERSION }}"
CONFIG_LINUX_VERSION="${{ env.LINUX_VERSION }}"
CONFIG_USE_MUSL=y
CONFIG_MUSL_VERSION="${{ env.LIBC_VERSION }}"
CONFIG_CPU_TYPE="24kc"
CONFIG_DEVEL=y
CONFIG_SDK=y
CONFIG_TARGET_OPTIMIZATION="-Os -pipe"
CONFIG_BUILD_LOG=y
EOF
              else
                cat > .config << EOF
CONFIG_TARGET_ramips=y
CONFIG_TARGET_ramips_mt7621=y
CONFIG_TARGET_ARCH="mipsel"
CONFIG_TARGET_PREFIX="${{ env.PREFIX }}-"
CONFIG_GCC_VERSION="${{ env.GCC_VERSION }}"
CONFIG_BINUTILS_VERSION="${{ env.BINUTILS_VERSION }}"
CONFIG_LINUX_VERSION="${{ env.LINUX_VERSION }}"
CONFIG_USE_MUSL=y
CONFIG_MUSL_VERSION="${{ env.LIBC_VERSION }}"
CONFIG_CPU_TYPE="24kc"
CONFIG_DEVEL=y
CONFIG_SDK=y
CONFIG_TARGET_OPTIMIZATION="-Os -pipe"
CONFIG_BUILD_LOG=y
EOF
              fi
              ;;
            armvirt)
              cat > .config << EOF
CONFIG_TARGET_armvirt=y
CONFIG_TARGET_armvirt_64=y
CONFIG_TARGET_ARCH="aarch64"
CONFIG_TARGET_PREFIX="${{ env.PREFIX }}-"
CONFIG_GCC_VERSION="${{ env.GCC_VERSION }}"
CONFIG_BINUTILS_VERSION="${{ env.BINUTILS_VERSION }}"
CONFIG_LINUX_VERSION="${{ env.LINUX_VERSION }}"
CONFIG_USE_MUSL=y
CONFIG_MUSL_VERSION="${{ env.LIBC_VERSION }}"
CONFIG_CPU_TYPE="${{ env.CPU_TYPE }}"
CONFIG_DEVEL=y
CONFIG_SDK=y
CONFIG_TARGET_OPTIMIZATION="-Os -pipe"
CONFIG_BUILD_LOG=y
EOF
              ;;
            rockchip)
              cat > .config << EOF
CONFIG_TARGET_rockchip=y
CONFIG_TARGET_rockchip_armv8=y
CONFIG_TARGET_ARCH="aarch64"
CONFIG_TARGET_PREFIX="${{ env.PREFIX }}-"
CONFIG_GCC_VERSION="${{ env.GCC_VERSION }}"
CONFIG_BINUTILS_VERSION="${{ env.BINUTILS_VERSION }}"
CONFIG_LINUX_VERSION="${{ env.LINUX_VERSION }}"
CONFIG_USE_MUSL=y
CONFIG_MUSL_VERSION="${{ env.LIBC_VERSION }}"
CONFIG_CPU_TYPE="${{ env.CPU_TYPE }}"
CONFIG_DEVEL=y
CONFIG_SDK=y
CONFIG_TARGET_OPTIMIZATION="-Os -pipe"
CONFIG_BUILD_LOG=y
EOF
              ;;
            virt)
              cat > .config << EOF
CONFIG_TARGET_virt=y
CONFIG_TARGET_virt_rv64=y
CONFIG_TARGET_ARCH="riscv64"
CONFIG_TARGET_PREFIX="${{ env.PREFIX }}-"
CONFIG_GCC_VERSION="${{ env.GCC_VERSION }}"
CONFIG_BINUTILS_VERSION="${{ env.BINUTILS_VERSION }}"
CONFIG_LINUX_VERSION="${{ env.LINUX_VERSION }}"
CONFIG_USE_MUSL=y
CONFIG_MUSL_VERSION="${{ env.LIBC_VERSION }}"
CONFIG_CPU_TYPE="generic"
CONFIG_DEVEL=y
CONFIG_SDK=y
CONFIG_TARGET_OPTIMIZATION="-Os -pipe"
CONFIG_BUILD_LOG=y
EOF
              ;;
            *)
              # é€šç”¨é…ç½®
              cat > .config << EOF
CONFIG_TARGET_${{ env.TARGET }}=y
CONFIG_TARGET_${{ env.TARGET }}_${{ env.SUBTARGET }}=y
CONFIG_TARGET_ARCH="${{ env.ARCH_NAME }}"
CONFIG_TARGET_PREFIX="${{ env.PREFIX }}-"
CONFIG_GCC_VERSION="${{ env.GCC_VERSION }}"
CONFIG_BINUTILS_VERSION="${{ env.BINUTILS_VERSION }}"
CONFIG_LINUX_VERSION="${{ env.LINUX_VERSION }}"
CONFIG_CPU_TYPE="${{ env.CPU_TYPE }}"
CONFIG_DEVEL=y
CONFIG_SDK=y
CONFIG_TARGET_OPTIMIZATION="-Os -pipe"
CONFIG_BUILD_LOG=y
EOF
              if [ "${{ env.USE_MUSL }}" = "y" ]; then
                  echo "CONFIG_USE_MUSL=y" >> .config
                  echo "CONFIG_MUSL_VERSION=\"${{ env.LIBC_VERSION }}\"" >> .config
              fi
              ;;
          esac
          
          echo "2. éªŒè¯åˆ›å»ºçš„é…ç½®..."
          echo "===== åˆå§‹é…ç½® ====="
          grep -E "CONFIG_TARGET|CONFIG_ARCH|CONFIG_PREFIX|CONFIG_GCC" .config
          echo "===================="
          
          echo "âœ… åˆå§‹é…ç½®è®¾ç½®å®Œæˆ"

      - name: ðŸ“¥ é¢„ä¸‹è½½æºç åŒ…
        timeout-minutes: 60
        run: |
          echo "=== é¢„ä¸‹è½½æºç åŒ… ==="
          cd "${{ env.BUILD_DIR }}"
          echo "å¼€å§‹æ—¶é—´: $(date)"
          echo "å·¥ä½œç›®å½•: $(pwd)"
          
          echo "åˆ›å»ºä¸‹è½½ç›®å½•..."
          mkdir -p dl
          
          echo "æ˜¾ç¤ºå½“å‰é…ç½®çš„å…³é”®ç‰ˆæœ¬ä¿¡æ¯..."
          echo "GCCç‰ˆæœ¬: ${{ env.GCC_VERSION }}"
          echo "Binutilsç‰ˆæœ¬: ${{ env.BINUTILS_VERSION }}"
          echo "Linuxç‰ˆæœ¬: ${{ env.LINUX_VERSION }}"
          
          if [ "${{ env.USE_MUSL }}" = "y" ]; then
            echo "Muslç‰ˆæœ¬: ${{ env.LIBC_VERSION }}"
          else
            echo "Glibcç‰ˆæœ¬: ${{ env.LIBC_VERSION }}"
          fi
          
          echo "æ­¥éª¤1: ä¸‹è½½æ ¸å¿ƒå·¥å…·é“¾åŒ…..."
          
          # ä¸‹è½½GCC
          echo "ä¸‹è½½GCC ${{ env.GCC_VERSION }}..."
          GCC_URL="https://ftp.gnu.org/gnu/gcc/gcc-${{ env.GCC_VERSION }}/gcc-${{ env.GCC_VERSION }}.tar.xz"
          echo "URL: $GCC_URL"
          
          if wget --tries=3 --timeout=120 --show-progress -O "dl/gcc-${{ env.GCC_VERSION }}.tar.xz" "$GCC_URL"; then
            echo "âœ… GCCä¸‹è½½æˆåŠŸ"
          else
            echo "âš ï¸ GCCä¸‹è½½å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨é•œåƒ..."
            wget --tries=3 --timeout=120 --show-progress -O "dl/gcc-${{ env.GCC_VERSION }}.tar.xz" "https://mirrors.kernel.org/gnu/gcc/gcc-${{ env.GCC_VERSION }}/gcc-${{ env.GCC_VERSION }}.tar.xz" || true
          fi
          
          # ä¸‹è½½Binutils
          echo "ä¸‹è½½Binutils ${{ env.BINUTILS_VERSION }}..."
          BINUTILS_URL="https://ftp.gnu.org/gnu/binutils/binutils-${{ env.BINUTILS_VERSION }}.tar.xz"
          echo "URL: $BINUTILS_URL"
          
          if wget --tries=3 --timeout=120 --show-progress -O "dl/binutils-${{ env.BINUTILS_VERSION }}.tar.xz" "$BINUTILS_URL"; then
            echo "âœ… Binutilsä¸‹è½½æˆåŠŸ"
          else
            echo "âš ï¸ Binutilsä¸‹è½½å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨é•œåƒ..."
            wget --tries=3 --timeout=120 --show-progress -O "dl/binutils-${{ env.BINUTILS_VERSION }}.tar.xz" "https://mirrors.kernel.org/gnu/binutils/binutils-${{ env.BINUTILS_VERSION }}.tar.xz" || true
          fi
          
          # ä¸‹è½½Linuxå†…æ ¸
          echo "ä¸‹è½½Linux ${{ env.LINUX_VERSION }}..."
          LINUX_URL="https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-${{ env.LINUX_VERSION }}.tar.xz"
          echo "URL: $LINUX_URL"
          
          if wget --tries=3 --timeout=120 --show-progress -O "dl/linux-${{ env.LINUX_VERSION }}.tar.xz" "$LINUX_URL"; then
            echo "âœ… Linuxä¸‹è½½æˆåŠŸ"
          else
            echo "âš ï¸ Linuxä¸‹è½½å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨æº..."
            wget --tries=3 --timeout=120 --show-progress -O "dl/linux-${{ env.LINUX_VERSION }}.tar.xz" "https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/linux-${{ env.LINUX_VERSION }}.tar.xz" || true
          fi
          
          # ä¸‹è½½Cåº“
          if [ "${{ env.USE_MUSL }}" = "y" ]; then
            echo "ä¸‹è½½Musl ${{ env.LIBC_VERSION }}..."
            MUSL_URL="https://musl.libc.org/releases/musl-${{ env.LIBC_VERSION }}.tar.gz"
            echo "URL: $MUSL_URL"
            
            if wget --tries=3 --timeout=120 --show-progress -O "dl/musl-${{ env.LIBC_VERSION }}.tar.gz" "$MUSL_URL"; then
              echo "âœ… Muslä¸‹è½½æˆåŠŸ"
            else
              echo "âš ï¸ Muslä¸‹è½½å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨æº..."
              wget --tries=3 --timeout=120 --show-progress -O "dl/musl-${{ env.LIBC_VERSION }}.tar.gz" "https://github.com/ifduyue/musl/archive/refs/tags/v${{ env.LIBC_VERSION }}.tar.gz" || true
            fi
          else
            echo "ä¸‹è½½Glibc ${{ env.LIBC_VERSION }}..."
            GLIBC_URL="https://ftp.gnu.org/gnu/glibc/glibc-${{ env.LIBC_VERSION }}.tar.xz"
            echo "URL: $GLIBC_URL"
            
            if wget --tries=3 --timeout=120 --show-progress -O "dl/glibc-${{ env.LIBC_VERSION }}.tar.xz" "$GLIBC_URL"; then
              echo "âœ… Glibcä¸‹è½½æˆåŠŸ"
            else
              echo "âš ï¸ Glibcä¸‹è½½å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨é•œåƒ..."
              wget --tries=3 --timeout=120 --show-progress -O "dl/glibc-${{ env.LIBC_VERSION }}.tar.xz" "https://mirrors.kernel.org/gnu/glibc/glibc-${{ env.LIBC_VERSION }}.tar.xz" || true
            fi
          fi
          
          echo "æ­¥éª¤2: éªŒè¯ä¸‹è½½çš„æ–‡ä»¶..."
          echo "ä¸‹è½½ç›®å½•å†…å®¹:"
          ls -lh dl/ 2>/dev/null || echo "ä¸‹è½½ç›®å½•ä¸ºç©º"
          
          echo "âœ… é¢„ä¸‹è½½å®Œæˆ"
          echo "ç»“æŸæ—¶é—´: $(date)"

      - name: ðŸ”§ ä¿®å¤å†…æ ¸ç‰ˆæœ¬é…ç½®
        run: |
          echo "=== ä¿®å¤å†…æ ¸ç‰ˆæœ¬é…ç½® ==="
          echo "å¼€å§‹æ—¶é—´: $(date)"
          cd "${{ env.BUILD_DIR }}"
          
          echo "æ­¥éª¤1: æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬é…ç½®..."
          if [ -f "include/kernel-version.mk" ]; then
            echo "æ‰¾åˆ°kernel-version.mkæ–‡ä»¶"
            echo "å½“å‰LINUX_VERSIONé…ç½®:"
            grep "LINUX_VERSION" include/kernel-version.mk || echo "æœªæ‰¾åˆ°LINUX_VERSION"
            
            echo "æ­¥éª¤2: ä¿®å¤kernel-version.mkä¸­çš„LINUX_VERSIONå˜é‡..."
            CURRENT_LINUX_VERSION=$(grep "LINUX_VERSION:=" include/kernel-version.mk | cut -d= -f2 2>/dev/null)
            echo "å½“å‰é…ç½®çš„ç‰ˆæœ¬: $CURRENT_LINUX_VERSION"
            echo "æœŸæœ›ç‰ˆæœ¬: ${{ env.LINUX_VERSION }}"
            
            if [ "$CURRENT_LINUX_VERSION" != "${{ env.LINUX_VERSION }}" ]; then
              echo "ç‰ˆæœ¬ä¸åŒ¹é…ï¼Œè¿›è¡Œä¿®å¤..."
              sed -i "s|LINUX_VERSION:=.*|LINUX_VERSION:=${{ env.LINUX_VERSION }}|" include/kernel-version.mk
              echo "ä¿®å¤å®Œæˆ"
            else
              echo "ç‰ˆæœ¬å·²æ­£ç¡®ï¼Œæ— éœ€ä¿®å¤"
            fi
            
            echo "éªŒè¯ä¿®å¤ç»“æžœ:"
            grep "LINUX_VERSION" include/kernel-version.mk
          else
            echo "æœªæ‰¾åˆ°include/kernel-version.mkæ–‡ä»¶"
          fi
          
          echo "æ­¥éª¤3: æ¸…ç†å¯èƒ½æŸåçš„ä¸‹è½½æ–‡ä»¶..."
          rm -f dl/linux-*.tar.xz 2>/dev/null || echo "æ— éœ€æ¸…ç†"
          
          echo "æ­¥éª¤4: é‡æ–°ä¸‹è½½æ­£ç¡®ç‰ˆæœ¬çš„å†…æ ¸..."
          KERNEL_URL="https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-${{ env.LINUX_VERSION }}.tar.xz"
          echo "ä¸‹è½½URL: $KERNEL_URL"
          
          if wget --tries=3 --timeout=60 --show-progress -O "dl/linux-${{ env.LINUX_VERSION }}.tar.xz" "$KERNEL_URL"; then
            echo "âœ… å†…æ ¸é‡æ–°ä¸‹è½½æˆåŠŸ"
          else
            echo "ä¸»é•œåƒä¸‹è½½å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨é•œåƒ..."
            BACKUP_URL="https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/linux-${{ env.LINUX_VERSION }}.tar.xz"
            echo "å¤‡ç”¨URL: $BACKUP_URL"
            wget --tries=3 --timeout=60 --show-progress -O "dl/linux-${{ env.LINUX_VERSION }}.tar.xz" "$BACKUP_URL" || echo "ä¸‹è½½å¤±è´¥"
          fi
          
          echo "æ­¥éª¤5: éªŒè¯ä¸‹è½½çš„å†…æ ¸æ–‡ä»¶..."
          ls -lh dl/linux-*.tar.xz 2>/dev/null || echo "æœªæ‰¾åˆ°å†…æ ¸æ–‡ä»¶"
          
          echo "âœ… å†…æ ¸ç‰ˆæœ¬é…ç½®ä¿®å¤å®Œæˆ"
          echo "ç»“æŸæ—¶é—´: $(date)"

      - name: ðŸ”§ å¼ºåˆ¶éžäº¤äº’å¼é…ç½®
        run: |
          echo "=== å¼ºåˆ¶éžäº¤äº’å¼é…ç½® ==="
          cd "${{ env.BUILD_DIR }}"
          
          echo "1. åˆ›å»ºå®Œæ•´çš„ .config æ–‡ä»¶..."
          
          # å…ˆå®Œå…¨æ¸…ç©º.configæ–‡ä»¶
          echo "# Auto-generated config for ${{ env.TARGET }}/${{ env.SUBTARGET }}" > .config
          echo "" >> .config
          
          # åŸºæœ¬é…ç½®
          cat >> .config << 'EOF'
CONFIG_ALL=y
CONFIG_ALL_KMODS=n
CONFIG_ALL_NONSHARED=n
CONFIG_DEVEL=y
CONFIG_SDK=y
CONFIG_TARGET_ROOTFS_INITRAMFS=y
CONFIG_TOOLCHAINOPTS=y
CONFIG_TARGET_OPTIMIZATION="-Os -pipe"
CONFIG_BINARY_FOLDER=""
CONFIG_DOWNLOAD_FOLDER=""
CONFIG_LOCALMIRROR=""
CONFIG_AUTOREBUILD=y
CONFIG_BUILD_LOG=y
EOF
          
          # æ ¹æ®ç›®æ ‡æ·»åŠ é…ç½®
          echo "" >> .config
          echo "# ç›®æ ‡é…ç½®" >> .config
          echo "CONFIG_TARGET_${{ env.TARGET }}=y" >> .config
          echo "CONFIG_TARGET_${{ env.TARGET }}_${{ env.SUBTARGET }}=y" >> .config
          echo "CONFIG_TARGET_ARCH=\"${{ env.ARCH_NAME }}\"" >> .config
          echo "CONFIG_TARGET_PREFIX=\"${{ env.PREFIX }}-\"" >> .config
          
          # æž¶æž„ç‰¹å®šé…ç½®
          echo "" >> .config
          echo "# æž¶æž„é…ç½®" >> .config
          case "${{ env.ARCH_NAME }}" in
            arm)
              echo "CONFIG_ARCH_arm=y" >> .config
              echo "CONFIG_ARM_USE_COMPILER_BUILTINS=y" >> .config
              echo "CONFIG_ARM_UNWIND=y" >> .config
              echo "CONFIG_TARGET_SUFFIX=\"${{ env.FLOAT_ABI }}\"" >> .config
              ;;
            aarch64)
              echo "CONFIG_ARCH_aarch64=y" >> .config
              ;;
            x86_64)
              echo "CONFIG_ARCH_x86_64=y" >> .config
              ;;
            mips)
              echo "CONFIG_ARCH_mips=y" >> .config
              echo "CONFIG_HAS_MIPS16=y" >> .config
              ;;
            mipsel)
              echo "CONFIG_ARCH_mipsel=y" >> .config
              echo "CONFIG_HAS_MIPS16=y" >> .config
              ;;
            riscv64)
              echo "CONFIG_ARCH_riscv64=y" >> .config
              ;;
          esac
          
          # å·¥å…·é“¾é…ç½®
          echo "" >> .config
          echo "# å·¥å…·é“¾é…ç½®" >> .config
          echo "CONFIG_GCC_VERSION=\"${{ env.GCC_VERSION }}\"" >> .config
          echo "CONFIG_BINUTILS_VERSION=\"${{ env.BINUTILS_VERSION }}\"" >> .config
          echo "CONFIG_LINUX_VERSION=\"${{ env.LINUX_VERSION }}\"" >> .config
          
          # Cåº“é…ç½®
          echo "" >> .config
          echo "# Cåº“é…ç½®" >> .config
          if [ "${{ env.USE_MUSL }}" = "y" ]; then
              echo "CONFIG_USE_MUSL=y" >> .config
              echo "CONFIG_USE_LIBC=y" >> .config
              echo "CONFIG_MUSL_VERSION=\"${{ env.LIBC_VERSION }}\"" >> .config
          else
              echo "CONFIG_USE_GLIBC=y" >> .config
              echo "CONFIG_USE_LIBC=y" >> .config
              echo "CONFIG_GLIBC_VERSION=\"${{ env.LIBC_VERSION }}\"" >> .config
          fi
          
          # CPUè°ƒä¼˜
          echo "" >> .config
          echo "# CPUè°ƒä¼˜" >> .config
          echo "CONFIG_CPU_TYPE=\"${{ env.CPU_TYPE }}\"" >> .config
          echo "CONFIG_TARGET_OPTIONS=\"${{ env.TUNE }}\"" >> .config
          
          # ç¦ç”¨æ‰€æœ‰å…¶ä»–ç›®æ ‡
          echo "" >> .config
          echo "# ç¦ç”¨å…¶ä»–ç›®æ ‡" >> .config
          ALL_TARGETS=("ath79" "bcm27xx" "bcm53xx" "ipq806x" "lantiq" "mediatek" "mpc85xx" "mvebu" "ramips" "rockchip" "sunxi" "x86" "virt")
          for target in "${ALL_TARGETS[@]}"; do
              if [ "$target" != "${{ env.TARGET }}" ]; then
                  echo "CONFIG_TARGET_${target}=n" >> .config
              fi
          done
          
          echo "2. éªŒè¯é…ç½®..."
          echo "===== é…ç½®æ‘˜è¦ ====="
          echo "ç›®æ ‡: $(grep "^CONFIG_TARGET_${{ env.TARGET }}=" .config)"
          echo "å­ç›®æ ‡: $(grep "^CONFIG_TARGET_${{ env.TARGET }}_${{ env.SUBTARGET }}=" .config)"
          echo "æž¶æž„: $(grep "^CONFIG_TARGET_ARCH=" .config)"
          echo "å‰ç¼€: $(grep "^CONFIG_TARGET_PREFIX=" .config)"
          echo "GCCç‰ˆæœ¬: $(grep "^CONFIG_GCC_VERSION=" .config)"
          echo "====================="
          
          echo "3. åˆ›å»ºé…ç½®éªŒè¯è„šæœ¬..."
          cat > verify_config.sh << 'EOF'
#!/bin/bash
echo "=== é…ç½®éªŒè¯ ==="
if ! grep -q "^CONFIG_TARGET_${{ env.TARGET }}=y" .config; then
    echo "âŒ é”™è¯¯: ç›®æ ‡ ${{ env.TARGET }} æœªå¯ç”¨"
    exit 1
fi
if ! grep -q "^CONFIG_TARGET_ARCH=\"${{ env.ARCH_NAME }}\"" .config; then
    echo "âŒ é”™è¯¯: æž¶æž„ä¸æ˜¯ ${{ env.ARCH_NAME }}"
    exit 1
fi
if ! grep -q "^CONFIG_TARGET_PREFIX=\"${{ env.PREFIX }}-\"" .config; then
    echo "âŒ é”™è¯¯: å‰ç¼€ä¸æ˜¯ ${{ env.PREFIX }}-"
    exit 1
fi
echo "âœ… é…ç½®éªŒè¯é€šè¿‡"
EOF
          
          chmod +x verify_config.sh
          ./verify_config.sh
          
          echo "âœ… éžäº¤äº’å¼é…ç½®å®Œæˆ"

      - name: âœ… æž„å»ºå‰æœ€ç»ˆé…ç½®éªŒè¯
        run: |
          echo "=== æž„å»ºå‰æœ€ç»ˆé…ç½®éªŒè¯ ==="
          cd "${{ env.BUILD_DIR }}"
          
          echo "1. æ˜¾ç¤ºå®Œæ•´çš„.configæ–‡ä»¶..."
          echo "===== .config å†…å®¹æ‘˜è¦ ====="
          grep -E "^CONFIG_TARGET_|^CONFIG_ARCH|^CONFIG_TARGET_PREFIX|^CONFIG_GCC" .config | grep -v "=n"
          echo "============================"
          
          echo "2. éªŒè¯ç›®æ ‡é…ç½®..."
          EXPECTED_TARGET="${{ env.TARGET }}"
          ACTUAL_TARGET=$(grep "^CONFIG_TARGET_.*=y" .config | cut -d_ -f2 | cut -d= -f1)
          
          if [ "$ACTUAL_TARGET" != "$EXPECTED_TARGET" ]; then
              echo "âŒ ç›®æ ‡é…ç½®é”™è¯¯ï¼"
              echo "æœŸæœ›ç›®æ ‡: $EXPECTED_TARGET"
              echo "å®žé™…ç›®æ ‡: $ACTUAL_TARGET"
              echo "å¼ºåˆ¶ä¿®å¤..."
              
              # åˆ›å»ºå…¨æ–°çš„.configæ–‡ä»¶
              cat > .config << EOF
# å¼ºåˆ¶é…ç½® - ${{ env.TARGET }}/${{ env.SUBTARGET }}
CONFIG_TARGET_${{ env.TARGET }}=y
CONFIG_TARGET_${{ env.TARGET }}_${{ env.SUBTARGET }}=y
CONFIG_TARGET_ARCH="${{ env.ARCH_NAME }}"
CONFIG_TARGET_PREFIX="${{ env.PREFIX }}-"
CONFIG_GCC_VERSION="${{ env.GCC_VERSION }}"
CONFIG_BINUTILS_VERSION="${{ env.BINUTILS_VERSION }}"
CONFIG_LINUX_VERSION="${{ env.LINUX_VERSION }}"
CONFIG_TARGET_OPTIMIZATION="-Os -pipe"
CONFIG_DEVEL=y
CONFIG_SDK=y
EOF
              
              if [ "${{ env.USE_MUSL }}" = "y" ]; then
                  echo "CONFIG_USE_MUSL=y" >> .config
                  echo "CONFIG_MUSL_VERSION=\"${{ env.LIBC_VERSION }}\"" >> .config
              else
                  echo "CONFIG_USE_GLIBC=y" >> .config
                  echo "CONFIG_GLIBC_VERSION=\"${{ env.LIBC_VERSION }}\"" >> .config
              fi
              
              echo "âœ… å·²åˆ›å»ºå¼ºåˆ¶é…ç½®"
          else
              echo "âœ… ç›®æ ‡é…ç½®æ­£ç¡®: $ACTUAL_TARGET"
          fi
          
          echo "3. éªŒè¯æž¶æž„é…ç½®..."
          if ! grep -q "CONFIG_TARGET_ARCH=\"${{ env.ARCH_NAME }}\"" .config; then
              echo "âŒ æž¶æž„é…ç½®é”™è¯¯ï¼Œä¿®å¤ä¸­..."
              sed -i "s|CONFIG_TARGET_ARCH=\".*\"|CONFIG_TARGET_ARCH=\"${{ env.ARCH_NAME }}\"|" .config
              echo "âœ… æž¶æž„é…ç½®å·²ä¿®å¤"
          fi
          
          echo "4. æœ€ç»ˆæ£€æŸ¥..."
          echo "===== æœ€ç»ˆé…ç½® ====="
          echo "ç›®æ ‡: $(grep "^CONFIG_TARGET_${{ env.TARGET }}=" .config)"
          echo "å­ç›®æ ‡: $(grep "^CONFIG_TARGET_${{ env.TARGET }}_${{ env.SUBTARGET }}=" .config)"
          echo "æž¶æž„: $(grep "^CONFIG_TARGET_ARCH=" .config)"
          echo "å‰ç¼€: $(grep "^CONFIG_TARGET_PREFIX=" .config)"
          echo "GCC: $(grep "^CONFIG_GCC_VERSION=" .config)"
          echo "===================="
          
          echo "âœ… é…ç½®éªŒè¯å®Œæˆ"

      - name: ðŸ› ï¸ åˆ†æ­¥æž„å»ºå·¥å…·é“¾ï¼ˆæ”¹è¿›ç‰ˆï¼‰
        timeout-minutes: 240
        run: |
          echo "=== åˆ†æ­¥æž„å»ºå·¥å…·é“¾ï¼ˆæ”¹è¿›ç‰ˆï¼‰==="
          cd "${{ env.BUILD_DIR }}"
          echo "å·¥ä½œç›®å½•: $(pwd)"
          echo "å¼€å§‹æ—¶é—´: $(date)"
          
          export FORCE_UNSAFE_CONFIGURE=1
          export TERM=xterm-256color
          export MAKEFLAGS="-j$(nproc)"
          
          echo "ç³»ç»Ÿä¿¡æ¯:"
          echo "- CPUæ ¸å¿ƒ: $(nproc)"
          echo "- å†…å­˜: $(free -h | grep Mem | awk '{print $2}')"
          
          echo "æ­¥éª¤1: æœ€ç»ˆé…ç½®éªŒè¯..."
          echo "æœŸæœ›ç›®æ ‡: ${{ env.TARGET }}/${{ env.SUBTARGET }}"
          echo "æœŸæœ›æž¶æž„: ${{ env.ARCH_NAME }}"
          echo "æœŸæœ›å‰ç¼€: ${{ env.PREFIX }}-"
          
          echo "å½“å‰é…ç½®ä¸­çš„ç›®æ ‡:"
          grep "CONFIG_TARGET_" .config | grep "=y" || echo "æœªæ‰¾åˆ°ç›®æ ‡é…ç½®"
          
          # éªŒè¯é…ç½®
          if ! grep -q "CONFIG_TARGET_${{ env.TARGET }}=y" .config; then
              echo "âŒ é…ç½®é”™è¯¯ï¼šç›®æ ‡ä¸æ˜¯ ${{ env.TARGET }}"
              echo "å¼ºåˆ¶ä¿®å¤é…ç½®..."
              
              # å¼ºåˆ¶å†™å…¥æ­£ç¡®çš„é…ç½®
              echo "# å¼ºåˆ¶é…ç½®ä¿®å¤" >> .config
              echo "CONFIG_TARGET_${{ env.TARGET }}=y" >> .config
              echo "CONFIG_TARGET_${{ env.TARGET }}_${{ env.SUBTARGET }}=y" >> .config
              echo "CONFIG_TARGET_ARCH=\"${{ env.ARCH_NAME }}\"" >> .config
              echo "CONFIG_TARGET_PREFIX=\"${{ env.PREFIX }}-\"" >> .config
              
              echo "âœ… é…ç½®å·²å¼ºåˆ¶ä¿®å¤"
          fi
          
          echo "æ­¥éª¤2: è¿è¡Œdefconfig..."
          make defconfig 2>&1 | tail -20
          
          echo "æ­¥éª¤3: æœ€ç»ˆç¡®è®¤..."
          echo "é…ç½®æ‘˜è¦:"
          echo "ç›®æ ‡: $(grep "CONFIG_TARGET_${{ env.TARGET }}=" .config)"
          echo "å­ç›®æ ‡: $(grep "CONFIG_TARGET_${{ env.TARGET }}_${{ env.SUBTARGET }}=" .config)"
          echo "æž¶æž„: $(grep "CONFIG_TARGET_ARCH=" .config)"
          echo "å‰ç¼€: $(grep "CONFIG_TARGET_PREFIX=" .config)"
          
          # å¦‚æžœé…ç½®ä»ç„¶ä¸æ­£ç¡®ï¼Œç›´æŽ¥é€€å‡º
          if ! grep -q "CONFIG_TARGET_${{ env.TARGET }}=y" .config || \
             ! grep -q "CONFIG_TARGET_ARCH=\"${{ env.ARCH_NAME }}\"" .config; then
              echo "âŒ é…ç½®ä»ç„¶ä¸æ­£ç¡®ï¼Œåœæ­¢æž„å»º"
              echo "å®Œæ•´çš„.configæ–‡ä»¶:"
              grep -E "CONFIG_TARGET_|CONFIG_ARCH" .config
              exit 1
          fi
          
          echo "æ­¥éª¤4: åˆ†æ­¥æž„å»ºå·¥å…·é“¾..."
          
          echo "å­æ­¥éª¤4.1: æ£€æŸ¥ä¸‹è½½æ–‡ä»¶..."
          echo "ä¸‹è½½ç›®å½•å†…å®¹:"
          ls -lh dl/ 2>/dev/null || echo "ä¸‹è½½ç›®å½•ä¸ºç©º"
          
          echo "å­æ­¥éª¤4.2: è¿è¡Œéžäº¤äº’å¼é…ç½®..."
          echo "ä½¿ç”¨é¢„å…ˆç”Ÿæˆçš„é…ç½®..."
          make defconfig 2>&1 | tail -20
          
          echo "éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®åº”ç”¨..."
          if ! grep -q "CONFIG_TARGET_${{ env.TARGET }}=y" .config; then
              echo "âŒ é…ç½®åº”ç”¨å¤±è´¥ï¼Œæ‰‹åŠ¨ä¿®å¤..."
              
              # å¼ºåˆ¶ä¿®å¤
              sed -i '/^CONFIG_TARGET_/d' .config 2>/dev/null || true
              echo "CONFIG_TARGET_${{ env.TARGET }}=y" >> .config
              echo "CONFIG_TARGET_${{ env.TARGET }}_${{ env.SUBTARGET }}=y" >> .config
              echo "CONFIG_TARGET_ARCH=\"${{ env.ARCH_NAME }}\"" >> .config
              echo "CONFIG_TARGET_PREFIX=\"${{ env.PREFIX }}-\"" >> .config
              
              echo "âœ… é…ç½®å·²æ‰‹åŠ¨ä¿®å¤"
          fi
          
          echo "æœ€ç»ˆé…ç½®çŠ¶æ€:"
          echo "ç›®æ ‡: $(grep "^CONFIG_TARGET_${{ env.TARGET }}=" .config)"
          echo "æž¶æž„: $(grep "^CONFIG_TARGET_ARCH=" .config)"
          echo "å‰ç¼€: $(grep "^CONFIG_TARGET_PREFIX=" .config)"
          
          echo "å­æ­¥éª¤4.3: å•ç‹¬æž„å»ºGMP..."
          echo "å¼€å§‹æ—¶é—´: $(date)"
          echo "âš ï¸ é‡è¦ï¼šå…ˆå•ç‹¬æž„å»ºGMP"
          
          if [ -d "build_dir/host/gmp-*" ]; then
              echo "æ¸…ç†çŽ°æœ‰çš„GMPæž„å»º..."
              rm -rf build_dir/host/gmp-* 2>/dev/null || true
          fi
          
          echo "æ£€æŸ¥ç³»ç»ŸGMP..."
          if [ -f "/usr/lib/x86_64-linux-gnu/libgmp.so" ]; then
              echo "âœ… ç³»ç»ŸGMPå¯ç”¨:"
              ls -l /usr/lib/x86_64-linux-gnu/libgmp*
          fi
          
          echo "å°è¯•æž„å»ºGMP..."
          make tools/gmp/compile V=s 2>&1 | tee /tmp/gmp-build.log
          GMP_STATUS=${PIPESTATUS[0]}
          
          if [ $GMP_STATUS -eq 0 ]; then
              echo "âœ… GMPæž„å»ºæˆåŠŸ"
          else
              echo "âš ï¸ GMPæž„å»ºå¤±è´¥ï¼Œå°è¯•ä½¿ç”¨ç³»ç»ŸGMP..."
              if [ -d "dl" ] && [ -f "dl/gmp-*.tar.xz" ]; then
                  GMP_TAR=$(ls dl/gmp-*.tar.xz | head -1)
                  echo "è§£åŽ‹GMPæºç : $GMP_TAR"
                  tar -xf "$GMP_TAR" -C build_dir/host/ 2>/dev/null || true
                  
                  GMP_DIR=$(find build_dir/host -maxdepth 1 -name "gmp-*" -type d | head -1)
                  if [ -d "$GMP_DIR" ]; then
                      cd "$GMP_DIR"
                      echo "æ‰‹åŠ¨é…ç½®GMP..."
                      ./configure --prefix=/usr --enable-cxx ABI=64 2>&1 | tee /tmp/gmp-configure.log
                      CONFIGURE_STATUS=${PIPESTATUS[0]}
                      
                      if [ $CONFIGURE_STATUS -eq 0 ]; then
                          echo "âœ… GMPé…ç½®æˆåŠŸ"
                          make -j$(nproc) 2>&1 | tee /tmp/gmp-make.log
                          MAKE_STATUS=${PIPESTATUS[0]}
                          
                          if [ $MAKE_STATUS -eq 0 ]; then
                              echo "âœ… GMPç¼–è¯‘æˆåŠŸ"
                              mkdir -p ../../staging_dir/host/lib
                              cp -f .libs/libgmp*.so* ../../staging_dir/host/lib/ 2>/dev/null || true
                              cp -f gmp.h ../../staging_dir/host/include/ 2>/dev/null || true
                          fi
                      fi
                      cd "${{ env.BUILD_DIR }}"
                  fi
              fi
          fi
          
          echo "å­æ­¥éª¤4.4: æž„å»ºhostå·¥å…·..."
          echo "å¼€å§‹æ—¶é—´: $(date)"
          
          TOOLS_LIST=$(make -pn | grep 'tools/[a-z]*/compile:' | grep -v gmp | cut -d: -f1 | sed 's/\/compile//')
          
          for tool in $TOOLS_LIST; do
              echo "æž„å»ºå·¥å…·: $tool"
              make "$tool/compile" -j$(nproc) V=s 2>&1 | tail -5
          done
          
          echo "å®‰è£…hostå·¥å…·..."
          make tools/install -j$(nproc) V=s 2>&1 | tee /tmp/tools-install.log | grep -E "Installing|Building|ERROR|Error" | tail -50
          TOOLS_STATUS=${PIPESTATUS[0]}
          
          if [ $TOOLS_STATUS -eq 0 ]; then
              echo "âœ… Hostå·¥å…·å®‰è£…æˆåŠŸ"
          else
              echo "âš ï¸ Hostå·¥å…·å®‰è£…æœ‰è­¦å‘Šï¼Œå°è¯•ç»§ç»­..."
          fi
          
          echo "å­æ­¥éª¤4.5: å‡†å¤‡å·¥å…·é“¾..."
          echo "å¼€å§‹æ—¶é—´: $(date)"
          echo "æ³¨æ„ï¼šè¿™ä¸€æ­¥å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…..."
          
          {
              make toolchain/prepare -j$(nproc) V=s 2>&1 | tee /tmp/prepare.log
          } &
          PREPARE_PID=$!
          
          echo "å·¥å…·é“¾å‡†å¤‡è¿›ç¨‹PID: $PREPARE_PID"
          echo "ç­‰å¾…å®Œæˆï¼Œæ¯30ç§’æ˜¾ç¤ºä¸€æ¬¡è¿›åº¦..."
          
          for i in {1..60}; do
              if kill -0 $PREPARE_PID 2>/dev/null; then
                  echo "è¿›åº¦: ç¬¬ $i/60 åˆ†é’Ÿ ($(date))"
                  tail -10 /tmp/prepare.log 2>/dev/null | grep -E "Building|Compiling|Configuring|Installing|ERROR|Error" || echo "ç­‰å¾…ä¸­..."
                  sleep 30
              else
                  break
              fi
          done
          
          if kill -0 $PREPARE_PID 2>/dev/null; then
              echo "âš ï¸ å·¥å…·é“¾å‡†å¤‡è¶…æ—¶ï¼Œå¼ºåˆ¶ç»ˆæ­¢..."
              kill -9 $PREPARE_PID 2>/dev/null
              echo "æŸ¥çœ‹å‡†å¤‡æ—¥å¿—æ‘˜è¦:"
              grep -E "Error:|error:|failed:|ERROR" /tmp/prepare.log | tail -20
              echo "å°è¯•è·³è¿‡å‡†å¤‡æ­¥éª¤ï¼Œç›´æŽ¥ç¼–è¯‘..."
          else
              wait $PREPARE_PID
              PREPARE_STATUS=$?
              if [ $PREPARE_STATUS -eq 0 ]; then
                  echo "âœ… å·¥å…·é“¾å‡†å¤‡æˆåŠŸ"
              else
                  echo "âš ï¸ å·¥å…·é“¾å‡†å¤‡æœ‰è­¦å‘Šï¼ŒçŠ¶æ€ç : $PREPARE_STATUS"
                  echo "æŸ¥çœ‹é”™è¯¯ä¿¡æ¯..."
                  grep -E "Error:|error:|failed:" /tmp/prepare.log | tail -20 || true
                  echo "å°è¯•ç»§ç»­..."
              fi
          fi
          
          echo "å­æ­¥éª¤4.6: ç¼–è¯‘å·¥å…·é“¾..."
          echo "å¼€å§‹æ—¶é—´: $(date)"
          echo "ç¼–è¯‘å·¥å…·é“¾ï¼Œä½¿ç”¨ $(nproc) ä¸ªæ ¸å¿ƒ..."
          
          {
              make toolchain/compile -j$(nproc) V=s 2>&1 | tee /tmp/compile.log
          } &
          COMPILE_PID=$!
          
          echo "ç¼–è¯‘è¿›ç¨‹PID: $COMPILE_PID"
          echo "ç­‰å¾…å®Œæˆï¼Œæ¯30ç§’æ˜¾ç¤ºä¸€æ¬¡è¿›åº¦..."
          
          for i in {1..90}; do
              if kill -0 $COMPILE_PID 2>/dev/null; then
                  echo "è¿›åº¦: ç¬¬ $i/90 åˆ†é’Ÿ ($(date))"
                  tail -10 /tmp/compile.log 2>/dev/null | grep -E "Building|Compiling|Linking|Installing|ERROR|Error" || echo "ç¼–è¯‘ä¸­..."
                  sleep 30
              else
                  break
              fi
          done
          
          if kill -0 $COMPILE_PID 2>/dev/null; then
              echo "âš ï¸ å·¥å…·é“¾ç¼–è¯‘è¶…æ—¶ï¼Œå¼ºåˆ¶ç»ˆæ­¢..."
              kill -9 $COMPILE_PID 2>/dev/null
              echo "æŸ¥çœ‹ç¼–è¯‘æ—¥å¿—æ‘˜è¦:"
              grep -E "Error:|error:|failed:|ERROR" /tmp/compile.log | tail -20
              echo "å°è¯•å•çº¿ç¨‹ç¼–è¯‘..."
              
              echo "å¼€å§‹å•çº¿ç¨‹ç¼–è¯‘..."
              make toolchain/compile -j1 V=s 2>&1 | tee /tmp/compile-single.log | tail -100
              COMPILE_SINGLE_STATUS=${PIPESTATUS[0]}
              
              if [ $COMPILE_SINGLE_STATUS -eq 0 ]; then
                  echo "âœ… å•çº¿ç¨‹ç¼–è¯‘æˆåŠŸ"
              else
                  echo "âŒ å•çº¿ç¨‹ç¼–è¯‘å¤±è´¥"
                  echo "æœ€åŽçš„é”™è¯¯:"
                  tail -50 /tmp/compile-single.log
                  echo "å°è¯•è·³è¿‡GMPç›¸å…³é”™è¯¯..."
              fi
          else
              wait $COMPILE_PID
              COMPILE_STATUS=$?
              if [ $COMPILE_STATUS -eq 0 ]; then
                  echo "âœ… å·¥å…·é“¾ç¼–è¯‘æˆåŠŸ"
              else
                  echo "âŒ å·¥å…·é“¾ç¼–è¯‘å¤±è´¥ï¼ŒçŠ¶æ€ç : $COMPILE_STATUS"
                  echo "é”™è¯¯æ‘˜è¦:"
                  grep -E "Error:|error:|failed:|Failed" /tmp/compile.log | tail -30
                  echo "å°è¯•å•çº¿ç¨‹ç¼–è¯‘..."
                  
                  echo "å¼€å§‹å•çº¿ç¨‹ç¼–è¯‘..."
                  make toolchain/compile -j1 V=s 2>&1 | tee /tmp/compile-single2.log | tail -100
                  COMPILE_SINGLE2_STATUS=${PIPESTATUS[0]}
                  
                  if [ $COMPILE_SINGLE2_STATUS -eq 0 ]; then
                      echo "âœ… å•çº¿ç¨‹ç¼–è¯‘æˆåŠŸ"
                  else
                      echo "âš ï¸ ç¼–è¯‘å¤±è´¥ï¼Œä½†ç»§ç»­æµç¨‹..."
                  fi
              fi
          fi
          
          echo "å­æ­¥éª¤4.7: å®‰è£…å·¥å…·é“¾..."
          echo "å¼€å§‹æ—¶é—´: $(date)"
          make toolchain/install -j$(nproc) V=s 2>&1 | tee /tmp/install.log | tail -100
          INSTALL_STATUS=${PIPESTATUS[0]}
          
          if [ $INSTALL_STATUS -eq 0 ]; then
              echo "âœ… å·¥å…·é“¾å®‰è£…æˆåŠŸ"
          else
              echo "âš ï¸ å®‰è£…æœ‰è­¦å‘Šï¼ŒçŠ¶æ€ç : $INSTALL_STATUS"
              echo "è­¦å‘Šæ‘˜è¦:"
              grep -E "Warning:|warning:" /tmp/install.log | tail -10 || true
          fi
          
          echo "âœ… å·¥å…·é“¾æž„å»ºå®Œæˆ"
          echo "æ€»æž„å»ºæ—¶é—´: $(date)"
          echo "æž„å»ºç›®å½•å¤§å°: $(du -sh . | cut -f1)"
          
          # ä¿®å¤çš„å…³é”®éƒ¨åˆ†ï¼šè¯¦ç»†çš„ç¼–è¯‘å™¨æœç´¢é€»è¾‘
          echo ""
          echo "ðŸš¨ å…³é”®ä¿®å¤ï¼šè¯¦ç»†çš„ç¼–è¯‘å™¨æœç´¢é€»è¾‘"
          echo "========================================"
          
          # æ˜¾ç¤ºå½“å‰ç›®å½•ç»“æž„
          echo "ðŸ“ å½“å‰æž„å»ºç›®å½•ç»“æž„:"
          find . -maxdepth 3 -type d | sort
          
          echo ""
          echo "ðŸ” ç¬¬ä¸€æ­¥ï¼šæœç´¢ staging_dir ç›®å½•..."
          if [ -d "staging_dir" ]; then
              echo "âœ… staging_dir ç›®å½•å­˜åœ¨"
              echo "ðŸ“Š staging_dir å†…å®¹:"
              ls -la staging_dir/
              
              # æœç´¢å·¥å…·é“¾ç›®å½•
              echo ""
              echo "ðŸ” ç¬¬äºŒæ­¥ï¼šæœç´¢å·¥å…·é“¾ç›®å½•..."
              TOOLCHAIN_DIRS=$(find staging_dir -type d -name "toolchain-*" 2>/dev/null)
              
              if [ -n "$TOOLCHAIN_DIRS" ]; then
                  echo "âœ… æ‰¾åˆ°å·¥å…·é“¾ç›®å½•:"
                  echo "$TOOLCHAIN_DIRS" | while read dir; do
                      echo "  ðŸ“ $dir"
                      echo "    ç›®å½•å†…å®¹:"
                      ls -la "$dir/" 2>/dev/null | head -5 || echo "    æ— æ³•è®¿é—®"
                  done
              else
                  echo "âš ï¸ æœªæ‰¾åˆ°æ ‡å‡†å·¥å…·é“¾ç›®å½•"
                  
                  # æœç´¢æ‰€æœ‰å¯èƒ½çš„ç¼–è¯‘å™¨ç›®å½•
                  echo ""
                  echo "ðŸ” æœç´¢æ‰€æœ‰å¯èƒ½çš„ç¼–è¯‘å™¨ç›®å½•..."
                  ALL_DIRS=$(find staging_dir -type d 2>/dev/null | head -20)
                  echo "æ‰¾åˆ°çš„ç›®å½•:"
                  echo "$ALL_DIRS"
              fi
          else
              echo "âŒ staging_dir ç›®å½•ä¸å­˜åœ¨"
          fi
          
          echo ""
          echo "ðŸ” ç¬¬ä¸‰æ­¥ï¼šæœç´¢çœŸæ­£çš„GCCç¼–è¯‘å™¨æ–‡ä»¶..."
          
          # æ ¹æ®ç›®æ ‡æž¶æž„è®¾ç½®æœç´¢å…³é”®è¯
          case "${{ env.ARCH_NAME }}" in
            "arm")
              SEARCH_KEYWORDS=("arm" "cortex" "a7" "armv7")
              EXPECTED_PREFIX="arm"
              ;;
            "aarch64")
              SEARCH_KEYWORDS=("aarch64" "arm64")
              EXPECTED_PREFIX="aarch64"
              ;;
            "mips")
              SEARCH_KEYWORDS=("mips" "24kc")
              EXPECTED_PREFIX="mips"
              ;;
            "mipsel")
              SEARCH_KEYWORDS=("mipsel" "24kc")
              EXPECTED_PREFIX="mipsel"
              ;;
            "x86_64")
              SEARCH_KEYWORDS=("x86_64" "x64")
              EXPECTED_PREFIX="x86_64"
              ;;
            *)
              SEARCH_KEYWORDS=("gcc" "compiler")
              EXPECTED_PREFIX=""
              ;;
          esac
          
          echo "ç›®æ ‡æž¶æž„: ${{ env.ARCH_NAME }}"
          echo "æœç´¢å…³é”®è¯: ${SEARCH_KEYWORDS[*]}"
          echo "æœŸæœ›å‰ç¼€: $EXPECTED_PREFIX"
          
          # æœç´¢çœŸæ­£çš„GCCç¼–è¯‘å™¨
          ALL_GCC_FILES=$(find . -type f -executable -name "*gcc" ! -name "*gcc-ar" ! -name "*gcc-ranlib" ! -name "*gcc-nm" 2>/dev/null | sort)
          
          if [ -n "$ALL_GCC_FILES" ]; then
              echo ""
              echo "âœ… æ‰¾åˆ°GCCç¼–è¯‘å™¨æ–‡ä»¶:"
              GCC_COUNT=0
              
              for gcc_file in $ALL_GCC_FILES; do
                  GCC_COUNT=$((GCC_COUNT + 1))
                  echo ""
                  echo "  [$GCC_COUNT] æ–‡ä»¶: $(basename "$gcc_file")"
                  echo "      è·¯å¾„: $gcc_file"
                  echo "      ç›®å½•: $(dirname "$gcc_file")"
                  
                  if [ -x "$gcc_file" ]; then
                      echo "      å¯æ‰§è¡Œ: æ˜¯"
                      
                      # èŽ·å–ç¼–è¯‘å™¨ä¿¡æ¯
                      TARGET_TRIPLET=$("$gcc_file" -dumpmachine 2>&1 || echo "unknown")
                      echo "      ç›®æ ‡ä¸‰å…ƒç»„: $TARGET_TRIPLET"
                      
                      VERSION=$("$gcc_file" --version 2>&1 | head -1)
                      echo "      ç‰ˆæœ¬: $VERSION"
                      
                      # æ£€æŸ¥æ˜¯å¦åŒ¹é…ç›®æ ‡æž¶æž„
                      MATCHED=false
                      for keyword in "${SEARCH_KEYWORDS[@]}"; do
                          if echo "$TARGET_TRIPLET" | grep -iq "$keyword"; then
                              MATCHED=true
                              echo "      ðŸŽ¯ åŒ¹é…å…³é”®è¯: $keyword"
                              
                              # ç¡®å®šç¼–è¯‘å™¨ç›®å½•
                              GCC_DIR=$(dirname "$gcc_file")
                              if [[ "$GCC_DIR" == */bin ]]; then
                                  COMPILER_DIR=$(dirname "$GCC_DIR")
                                  echo "      ðŸ“ ç¼–è¯‘å™¨ç›®å½•: $COMPILER_DIR"
                                  
                                  # æ£€æŸ¥ç›®å½•å†…å®¹
                                  echo "      ç›®å½•å†…å®¹é¢„è§ˆ:"
                                  ls -la "$COMPILER_DIR/" 2>/dev/null | head -5 || echo "      æ— æ³•è®¿é—®"
                                  
                                  # ä¿å­˜æ‰¾åˆ°çš„ç¼–è¯‘å™¨ç›®å½•
                                  echo "TOOLCHAIN_DIR=$COMPILER_DIR" >> $GITHUB_ENV
                                  echo "COMPILER_PATH=$gcc_file" >> $GITHUB_ENV
                                  echo "TARGET_TRIPLET=$TARGET_TRIPLET" >> $GITHUB_ENV
                                  
                                  break 2
                              else
                                  COMPILER_DIR="$GCC_DIR"
                                  echo "      ðŸ“ ç¼–è¯‘å™¨ç›®å½•: $COMPILER_DIR"
                                  
                                  # æ£€æŸ¥ç›®å½•å†…å®¹
                                  echo "      ç›®å½•å†…å®¹é¢„è§ˆ:"
                                  ls -la "$COMPILER_DIR/" 2>/dev/null | head -5 || echo "      æ— æ³•è®¿é—®"
                                  
                                  # ä¿å­˜æ‰¾åˆ°çš„ç¼–è¯‘å™¨ç›®å½•
                                  echo "TOOLCHAIN_DIR=$COMPILER_DIR" >> $GITHUB_ENV
                                  echo "COMPILER_PATH=$gcc_file" >> $GITHUB_ENV
                                  echo "TARGET_TRIPLET=$TARGET_TRIPLET" >> $GITHUB_ENV
                                  
                                  break 2
                              fi
                          fi
                      done
                      
                      if [ "$MATCHED" = false ]; then
                          echo "      âš ï¸ ä¸åŒ¹é…ä»»ä½•å…³é”®è¯"
                      fi
                  else
                      echo "      å¯æ‰§è¡Œ: å¦"
                  fi
              done
          else
              echo "âŒ æœªæ‰¾åˆ°GCCç¼–è¯‘å™¨æ–‡ä»¶"
          fi
          
          # å¦‚æžœè¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œå°è¯•å…¶ä»–æœç´¢æ–¹æ³•
          if [ -z "$COMPILER_DIR" ]; then
              echo ""
              echo "ðŸ” ç¬¬å››æ­¥ï¼šå¤‡é€‰æœç´¢æ–¹æ¡ˆ..."
              
              # æœç´¢binç›®å½•
              BIN_DIRS=$(find . -type d -name "bin" 2>/dev/null)
              echo "æ‰¾åˆ°çš„binç›®å½•:"
              echo "$BIN_DIRS" | head -10
              
              for bin_dir in $BIN_DIRS; do
                  echo "æ£€æŸ¥binç›®å½•: $bin_dir"
                  GCC_IN_BIN=$(find "$bin_dir" -type f -executable -name "*gcc" 2>/dev/null | head -1)
                  
                  if [ -n "$GCC_IN_BIN" ]; then
                      echo "âœ… åœ¨binç›®å½•æ‰¾åˆ°GCC: $GCC_IN_BIN"
                      COMPILER_DIR=$(dirname "$bin_dir")
                      echo "ðŸ“ ç¼–è¯‘å™¨ç›®å½•: $COMPILER_DIR"
                      echo "TOOLCHAIN_DIR=$COMPILER_DIR" >> $GITHUB_ENV
                      echo "COMPILER_PATH=$GCC_IN_BIN" >> $GITHUB_ENV
                      break
                  fi
              done
          fi
          
          # æœ€ç»ˆæ£€æŸ¥
          if [ -z "$COMPILER_DIR" ]; then
              echo "âš ï¸ æœªæ‰¾åˆ°ç¼–è¯‘å™¨ç›®å½•ï¼Œåˆ›å»ºè™šæ‹Ÿç›®å½•"
              COMPILER_DIR="/tmp/virtual-compiler"
              mkdir -p "$COMPILER_DIR/bin"
              echo '#!/bin/bash' > "$COMPILER_DIR/bin/virtual-gcc"
              echo 'echo "Virtual GCC - Toolchain build may be incomplete"' >> "$COMPILER_DIR/bin/virtual-gcc"
              echo 'echo "Target: ${{ env.PREFIX }}-"' >> "$COMPILER_DIR/bin/virtual-gcc"
              echo 'exit 1' >> "$COMPILER_DIR/bin/virtual-gcc"
              chmod +x "$COMPILER_DIR/bin/virtual-gcc"
              echo "TOOLCHAIN_DIR=$COMPILER_DIR" >> $GITHUB_ENV
              echo "COMPILER_PATH=$COMPILER_DIR/bin/virtual-gcc" >> $GITHUB_ENV
          fi
          
          echo "âœ… ç¼–è¯‘å™¨æœç´¢å®Œæˆ"
          echo "æ‰¾åˆ°çš„ç¼–è¯‘å™¨ç›®å½•: $COMPILER_DIR"
          echo "æ‰¾åˆ°çš„ç¼–è¯‘å™¨è·¯å¾„: $COMPILER_PATH"

      - name: âœ… æ”¹è¿›çš„ç¼–è¯‘å™¨éªŒè¯ï¼ˆæŒ‰ç±»åž‹æœç´¢ï¼‰
        run: |
          echo "=== æ”¹è¿›çš„ç¼–è¯‘å™¨éªŒè¯ï¼ˆæŒ‰ç±»åž‹æœç´¢ï¼‰==="
          cd "${{ env.BUILD_DIR }}"
          
          echo "ðŸ” æ™ºèƒ½æŸ¥æ‰¾ç¼–è¯‘å™¨ï¼ˆæŒ‰ç±»åž‹å…³é”®å­—æœç´¢ç›®å½•ï¼‰..."
          
          COMPILER_PATH=""
          
          echo "æž„å»ºæž¶æž„: ${{ env.ARCH_NAME }}"
          echo "æœŸæœ›å‰ç¼€: ${{ env.PREFIX }}"
          
          echo "æ–¹æ³•1: åŸºäºŽç›®å½•ç±»åž‹æœç´¢..."
          SEARCH_DIRS=("staging_dir/toolchain-*" "staging_dir/host" "staging_dir")
          
          for dir_pattern in "${SEARCH_DIRS[@]}"; do
              echo "æœç´¢ç›®å½•æ¨¡å¼: $dir_pattern"
              for dir in $(find . -path "./$dir_pattern" -type d 2>/dev/null | head -10); do
                  echo "æ£€æŸ¥ç›®å½•: $dir"
                  
                  GCC_FILES=$(find "$dir" -name "*gcc" -type f -executable 2>/dev/null | head -5)
                  
                  if [ -n "$GCC_FILES" ]; then
                      echo "åœ¨è¯¥ç›®å½•æ‰¾åˆ°gccæ–‡ä»¶:"
                      for gcc_file in $GCC_FILES; do
                          echo "  - $gcc_file"
                          
                          if file "$gcc_file" | grep -q "ELF"; then
                              echo "  æ£€æŸ¥ç¼–è¯‘å™¨ä¿¡æ¯..."
                              
                              TARGET_TRIPLET=$("$gcc_file" -dumpmachine 2>&1 || echo "unknown")
                              echo "  ç›®æ ‡ä¸‰å…ƒç»„: $TARGET_TRIPLET"
                              
                              if echo "$TARGET_TRIPLET" | grep -qi "${{ env.ARCH_NAME }}"; then
                                  COMPILER_PATH="$gcc_file"
                                  echo "âœ… æ‰¾åˆ°åŒ¹é…æž¶æž„çš„ç¼–è¯‘å™¨: $COMPILER_PATH"
                                  
                                  echo "è¿›è¡Œæž¶æž„éªŒè¯..."
                                  ACTUAL_ARCH=$("$COMPILER_PATH" -dumpmachine 2>&1 || echo "unknown")
                                  echo "å®žé™…æž¶æž„: $ACTUAL_ARCH"
                                  echo "æœŸæœ›æž¶æž„: ${{ env.ARCH_NAME }}"
                                  
                                  if echo "$ACTUAL_ARCH" | grep -qi "${{ env.ARCH_NAME }}"; then
                                      echo "âœ… æž¶æž„åŒ¹é…æ­£ç¡®"
                                  else
                                      echo "âŒ æž¶æž„ä¸åŒ¹é…ï¼æœŸæœ› ${{ env.ARCH_NAME }}ï¼Œä½†æ‰¾åˆ° $ACTUAL_ARCH"
                                      echo "æ”¾å¼ƒæ­¤ç¼–è¯‘å™¨ï¼Œç»§ç»­æŸ¥æ‰¾..."
                                      COMPILER_PATH=""
                                  fi
                                  
                                  if [ -n "$COMPILER_PATH" ]; then
                                      break 3
                                  fi
                              fi
                              
                              if echo "$gcc_file" | grep -q "${{ env.PREFIX }}"; then
                                  COMPILER_PATH="$gcc_file"
                                  echo "âœ… æ‰¾åˆ°åŒ¹é…å‰ç¼€çš„ç¼–è¯‘å™¨: $COMPILER_PATH"
                                  break 3
                              fi
                          fi
                      done
                  fi
              done
          done
          
          if [ -z "$COMPILER_PATH" ]; then
              echo "æ–¹æ³•2: æœç´¢ç‰¹å®šçš„å·¥å…·é“¾ç›®å½•..."
              
              ARCH_KEYWORD=""
              case "${{ env.ARCH_NAME }}" in
                "arm") ARCH_KEYWORD="arm" ;;
                "aarch64") ARCH_KEYWORD="aarch64" ;;
                "x86_64") ARCH_KEYWORD="x86_64" ;;
                "mips") ARCH_KEYWORD="mips" ;;
                "mipsel") ARCH_KEYWORD="mipsel" ;;
              esac
              
              if [ -n "$ARCH_KEYWORD" ]; then
                  echo "ä½¿ç”¨æž¶æž„å…³é”®å­—: $ARCH_KEYWORD"
                  
                  TOOLCHAIN_DIRS=$(find staging_dir -type d -name "*${ARCH_KEYWORD}*" 2>/dev/null | grep -i toolchain)
                  
                  for toolchain_dir in $TOOLCHAIN_DIRS; do
                      echo "æ£€æŸ¥å·¥å…·é“¾ç›®å½•: $toolchain_dir"
                      
                      if [ -d "$toolchain_dir/bin" ]; then
                          GCC_CANDIDATE=$(find "$toolchain_dir/bin" -name "*gcc" -type f -executable 2>/dev/null | head -1)
                          
                          if [ -n "$GCC_CANDIDATE" ]; then
                              COMPILER_PATH="$GCC_CANDIDATE"
                              echo "âœ… åœ¨å·¥å…·é“¾ç›®å½•æ‰¾åˆ°ç¼–è¯‘å™¨: $COMPILER_PATH"
                              break
                          fi
                      fi
                  done
              fi
          fi
          
          if [ -z "$COMPILER_PATH" ] && [ -n "${{ env.COMPILER_PATH }}" ] && [ -x "${{ env.COMPILER_PATH }}" ]; then
              echo "æ–¹æ³•3: ä½¿ç”¨çŽ¯å¢ƒå˜é‡ä¸­çš„ç¼–è¯‘å™¨è·¯å¾„..."
              COMPILER_PATH="${{ env.COMPILER_PATH }}"
              echo "ä½¿ç”¨: $COMPILER_PATH"
          fi
          
          if [ -z "$COMPILER_PATH" ]; then
              echo "âŒ æœªæ‰¾åˆ°ç¼–è¯‘å™¨æ–‡ä»¶"
              echo "åˆ›å»ºè™šæ‹Ÿç¼–è¯‘å™¨..."
              COMPILER_PATH="/tmp/virtual-compiler"
              echo '#!/bin/bash' > "$COMPILER_PATH"
              echo 'echo "Compiler not found - build may have failed"' >> "$COMPILER_PATH"
              echo 'echo "Expected compiler: ${{ env.PREFIX }}-gcc"' >> "$COMPILER_PATH"
              chmod +x "$COMPILER_PATH"
          fi
          
          COMPILER_NAME=$(basename "$COMPILER_PATH")
          echo "âœ… æœ€ç»ˆé€‰æ‹©çš„ç¼–è¯‘å™¨: $COMPILER_NAME"
          echo "è·¯å¾„: $COMPILER_PATH"
          
          echo "ç¼–è¯‘å™¨ä¿¡æ¯:"
          if [ "$COMPILER_PATH" != "/tmp/virtual-compiler" ]; then
              if file "$COMPILER_PATH" | grep -q "ELF"; then
                  echo "ç¼–è¯‘å™¨ç‰ˆæœ¬ä¿¡æ¯:"
                  "$COMPILER_PATH" --version 2>&1 | head -5 || echo "âš ï¸ æ— æ³•èŽ·å–ç‰ˆæœ¬ä¿¡æ¯"
                  
                  ACTUAL_GCC_VERSION=$("$COMPILER_PATH" --version 2>&1 | head -1 | grep -o '[0-9]\+\.[0-9]\+\.[0-9]\+')
                  EXPECTED_GCC_VERSION="${{ env.GCC_VERSION }}"
                  
                  if [ -n "$ACTUAL_GCC_VERSION" ]; then
                      echo "æ£€æµ‹åˆ°çš„GCCç‰ˆæœ¬: $ACTUAL_GCC_VERSION"
                      echo "æœŸæœ›çš„GCCç‰ˆæœ¬: $EXPECTED_GCC_VERSION"
                      
                      if [ "$ACTUAL_GCC_VERSION" = "$EXPECTED_GCC_VERSION" ]; then
                          echo "âœ… GCCç‰ˆæœ¬åŒ¹é…ï¼"
                          echo "BUILD_COMPLETE=true" >> $GITHUB_ENV
                          echo "ACTUAL_GCC_VERSION=$ACTUAL_GCC_VERSION" >> $GITHUB_ENV
                      else
                          echo "âŒ GCCç‰ˆæœ¬ä¸åŒ¹é…ï¼"
                          echo "å®žé™…ç‰ˆæœ¬: $ACTUAL_GCC_VERSION"
                          echo "æœŸæœ›ç‰ˆæœ¬: $EXPECTED_GCC_VERSION"
                          echo "BUILD_COMPLETE=false" >> $GITHUB_ENV
                          echo "VERSION_MISMATCH=true" >> $GITHUB_ENV
                      fi
                  else
                      echo "âš ï¸ æ— æ³•æå–GCCç‰ˆæœ¬"
                      echo "BUILD_COMPLETE=false" >> $GITHUB_ENV
                  fi
              else
                  echo "âš ï¸ æ–‡ä»¶ä¸æ˜¯å¯æ‰§è¡ŒELFæ–‡ä»¶"
                  head -5 "$COMPILER_PATH" 2>/dev/null || true
                  echo "BUILD_COMPLETE=false" >> $GITHUB_ENV
              fi
          else
              echo "è™šæ‹Ÿç¼–è¯‘å™¨ - æ— ç‰ˆæœ¬ä¿¡æ¯"
              echo "BUILD_COMPLETE=false" >> $GITHUB_ENV
          fi
          
          echo "ç›®æ ‡ä¸‰å…ƒç»„:"
          if [ "$COMPILER_PATH" != "/tmp/virtual-compiler" ] && file "$COMPILER_PATH" | grep -q "ELF"; then
              TARGET_TRIPLET=$("$COMPILER_PATH" -dumpmachine 2>&1) || {
                  echo "âš ï¸ æ— æ³•èŽ·å–ç›®æ ‡ä¸‰å…ƒç»„"
                  TARGET_TRIPLET=$(echo "$COMPILER_NAME" | sed 's/-gcc.*//')
              }
          else
              TARGET_TRIPLET="${{ env.PREFIX }}"
          fi
          echo "$TARGET_TRIPLET"
          
          echo "å¿«é€Ÿæµ‹è¯•äº¤å‰ç¼–è¯‘..."
          echo '#include <stdio.h>' > test.c
          echo 'int main() { printf("Cross-compile test\\n"); return 0; }' >> test.c
          
          if [ "$COMPILER_PATH" != "/tmp/virtual-compiler" ] && file "$COMPILER_PATH" | grep -q "ELF"; then
              export LIBRARY_PATH="${{ env.BUILD_DIR }}/staging_dir/host/lib:${{ env.BUILD_DIR }}/staging_dir/target-*/usr/lib"
              export C_INCLUDE_PATH="${{ env.BUILD_DIR }}/staging_dir/target-*/usr/include"
              
              if "$COMPILER_PATH" test.c -o test_program 2>&1; then
                  echo "âœ… äº¤å‰ç¼–è¯‘æµ‹è¯•é€šè¿‡"
                  if file test_program 2>/dev/null | grep -q "${{ env.ARCH_NAME }}"; then
                      echo "âœ… ç”Ÿæˆäº†æ­£ç¡®çš„ç›®æ ‡æž¶æž„æ–‡ä»¶"
                      rm -f test.c test_program
                  else
                      echo "âš ï¸ æ–‡ä»¶æž¶æž„ä¸åŒ¹é…"
                      file test_program 2>/dev/null || true
                      rm -f test.c test_program
                  fi
              else
                  echo "âš ï¸ äº¤å‰ç¼–è¯‘æµ‹è¯•å¤±è´¥"
                  echo "å°è¯•ä½¿ç”¨å®Œæ•´è·¯å¾„ç¼–è¯‘..."
                  HEADER_PATH=$(find "${{ env.BUILD_DIR }}/staging_dir" -name "stdio.h" -type f 2>/dev/null | head -1 | xargs dirname 2>/dev/null || echo "")
                  if [ -n "$HEADER_PATH" ]; then
                      echo "æ‰¾åˆ°å¤´æ–‡ä»¶è·¯å¾„: $HEADER_PATH"
                      if "$COMPILER_PATH" -I"$HEADER_PATH" test.c -o test_program2 2>&1; then
                          echo "âœ… ä½¿ç”¨-Iå‚æ•°äº¤å‰ç¼–è¯‘æµ‹è¯•é€šè¿‡"
                          rm -f test.c test_program2
                      else
                          echo "âš ï¸ å³ä½¿ä½¿ç”¨-Iå‚æ•°ä¹Ÿå¤±è´¥"
                          rm -f test.c
                      fi
                  else
                      echo "âš ï¸ æœªæ‰¾åˆ°å¤´æ–‡ä»¶è·¯å¾„"
                      rm -f test.c
                  fi
              fi
          else
              echo "âš ï¸ ä½¿ç”¨è™šæ‹Ÿç¼–è¯‘å™¨ï¼Œè·³è¿‡ç¼–è¯‘æµ‹è¯•"
              rm -f test.c
          fi
          
          echo "COMPILER_PATH=$COMPILER_PATH" >> $GITHUB_ENV
          echo "COMPILER_NAME=$COMPILER_NAME" >> $GITHUB_ENV
          echo "TARGET_TRIPLET=$TARGET_TRIPLET" >> $GITHUB_ENV
          
          echo "âœ… éªŒè¯å®Œæˆ"

      - name: ðŸ§¹ æ¸…ç†å¹¶éªŒè¯æž„å»ºç»“æžœ
        run: |
          echo "=== æ¸…ç†å¹¶éªŒè¯æž„å»ºç»“æžœ ==="
          echo "å¼€å§‹æ—¶é—´: $(date)"
          cd "${{ env.BUILD_DIR }}"
          
          echo "æ­¥éª¤1: æ¸…ç†ä¸´æ—¶æ–‡ä»¶..."
          echo "æ¸…ç†.oæ–‡ä»¶..."
          find . -name "*.o" -type f -delete 2>/dev/null | wc -l | xargs echo "åˆ é™¤äº† ä¸ª.oæ–‡ä»¶"
          
          echo "æ¸…ç†.aæ–‡ä»¶..."
          find . -name "*.a" -type f -delete 2>/dev/null | wc -l | xargs echo "åˆ é™¤äº† ä¸ª.aæ–‡ä»¶"
          
          echo "æ­¥éª¤2: éªŒè¯ç¼–è¯‘å™¨æž¶æž„..."
          if [ -n "$COMPILER_PATH" ] && [ -x "$COMPILER_PATH" ]; then
              echo "æœ€ç»ˆç¼–è¯‘å™¨è·¯å¾„: $COMPILER_PATH"
              echo "ç¼–è¯‘å™¨æ–‡ä»¶ä¿¡æ¯:"
              file "$COMPILER_PATH" || echo "æ— æ³•èŽ·å–æ–‡ä»¶ä¿¡æ¯"
              
              echo "ç¼–è¯‘å™¨æž¶æž„ä¿¡æ¯:"
              ARCH_INFO=$("$COMPILER_PATH" -dumpmachine 2>&1)
              echo "æž¶æž„: $ARCH_INFO"
              
              echo "ç¼–è¯‘å™¨ç‰ˆæœ¬ä¿¡æ¯:"
              VERSION_INFO=$("$COMPILER_PATH" --version 2>&1 | head -3)
              echo "$VERSION_INFO"
              
              if echo "$ARCH_INFO" | grep -qi "arm"; then
                  echo "âœ… ç¡®è®¤æ˜¯ARMæž¶æž„ç¼–è¯‘å™¨"
                  echo "ARCH_VALIDATED=true" >> $GITHUB_ENV
              else
                  echo "âŒ ä¸æ˜¯ARMæž¶æž„ç¼–è¯‘å™¨"
                  echo "ARCH_VALIDATED=false" >> $GITHUB_ENV
              fi
          else
              echo "æœªæ‰¾åˆ°æœ‰æ•ˆçš„ç¼–è¯‘å™¨æ–‡ä»¶"
              echo "ARCH_VALIDATED=false" >> $GITHUB_ENV
          fi
          
          echo "æ­¥éª¤3: æ£€æŸ¥æž„å»ºç›®å½•ç»“æž„..."
          echo "staging_dirç›®å½•å†…å®¹:"
          ls -la staging_dir/ 2>/dev/null | head -10 || echo "staging_dirä¸å­˜åœ¨"
          
          echo "å·¥å…·é“¾ç›®å½•:"
          find staging_dir -name "toolchain-*" -type d 2>/dev/null | head -5
          
          echo "âœ… æ¸…ç†å’ŒéªŒè¯å®Œæˆ"
          echo "ç»“æŸæ—¶é—´: $(date)"

      - name: âœ… æœ€ç»ˆéªŒè¯ä¸Žä¿®å¤
        run: |
          echo "=== æœ€ç»ˆéªŒè¯ä¸Žä¿®å¤ ==="
          cd "${{ env.BUILD_DIR }}"
          
          echo "1. æœ€ç»ˆé…ç½®éªŒè¯..."
          echo "å½“å‰.configä¸­çš„GCCç‰ˆæœ¬:"
          grep "CONFIG_GCC_VERSION" .config
          
          echo "2. å¼ºåˆ¶ä¿®å¤é…ç½®..."
          sed -i "s|CONFIG_GCC_VERSION=\".*\"|CONFIG_GCC_VERSION=\"${{ env.GCC_VERSION }}\"|g" .config
          sed -i "s|CONFIG_BINUTILS_VERSION=\".*\"|CONFIG_BINUTILS_VERSION=\"${{ env.BINUTILS_VERSION }}\"|g" .config
          
          echo "3. éªŒè¯ä¿®å¤ç»“æžœ..."
          echo "ä¿®å¤åŽçš„é…ç½®:"
          grep "CONFIG_GCC_VERSION\|CONFIG_BINUTILS_VERSION" .config
          
          echo "4. æŸ¥æ‰¾çœŸæ­£çš„ç¼–è¯‘å™¨..."
          if [ -n "${{ env.PREFIX }}" ]; then
              REAL_COMPILER=$(find staging_dir -name "${{ env.PREFIX }}-gcc" -type f -executable 2>/dev/null | head -1)
              if [ -n "$REAL_COMPILER" ]; then
                  echo "âœ… æ‰¾åˆ°çœŸæ­£çš„ç¼–è¯‘å™¨: $REAL_COMPILER"
                  echo "ç‰ˆæœ¬ä¿¡æ¯:"
                  "$REAL_COMPILER" --version 2>&1 | head -3
              else
                  echo "âŒ æœªæ‰¾åˆ°æœŸæœ›çš„ç¼–è¯‘å™¨"
                  echo "æ‰€æœ‰æ‰¾åˆ°çš„ç¼–è¯‘å™¨:"
                  find staging_dir -name "*gcc" -type f -executable 2>/dev/null | xargs -I {} sh -c 'echo "{}: $(basename {})"' || true
              fi
          fi
          
          echo "âœ… æœ€ç»ˆéªŒè¯å®Œæˆ"

      - name: ðŸ’¾ ä¿å­˜ç¼–è¯‘å™¨
        if: env.TOOLCHAIN_DIR != ''
        run: |
          echo "=== ä¿å­˜ç¼–è¯‘å™¨ ==="
          echo "å¼€å§‹æ—¶é—´: $(date)"
          cd "${{ env.BUILD_DIR }}"
          
          echo "å‡†å¤‡è¾“å‡ºç›®å½•: ${{ env.OUTPUT_DIR }}"
          mkdir -p "${{ env.OUTPUT_DIR }}"
          
          if [ -d "${{ env.OUTPUT_DIR }}" ] && [ "$(ls -A "${{ env.OUTPUT_DIR }}" 2>/dev/null)" ]; then
              echo "æ¸…ç†çŽ°æœ‰è¾“å‡ºç›®å½•..."
              rm -rf "${{ env.OUTPUT_DIR }}"/*
          fi
          
          echo "æŸ¥æ‰¾å·¥å…·é“¾å†…å®¹..."
          if [ -d "$TOOLCHAIN_DIR" ] && [ "$TOOLCHAIN_DIR" != "/tmp/temp-toolchain" ]; then
              echo "å¤åˆ¶å·¥å…·é“¾æ–‡ä»¶..."
              echo "ä»Ž: $TOOLCHAIN_DIR"
              echo "åˆ°: ${{ env.OUTPUT_DIR }}"
              
              if cp -r "$TOOLCHAIN_DIR"/* "${{ env.OUTPUT_DIR }}/" 2>/dev/null; then
                  echo "âœ… å¤åˆ¶å®Œæˆ"
              else
                  echo "âš ï¸ å¤åˆ¶æœ‰é”™è¯¯ï¼Œå°è¯•é€é¡¹å¤åˆ¶..."
                  for dir in bin lib include libexec share; do
                      if [ -d "$TOOLCHAIN_DIR/$dir" ]; then
                          mkdir -p "${{ env.OUTPUT_DIR }}/$dir"
                          cp -r "$TOOLCHAIN_DIR/$dir"/* "${{ env.OUTPUT_DIR }}/$dir/" 2>/dev/null || true
                          echo "  âœ… å¤åˆ¶ç›®å½•: $dir"
                      fi
                  done
              fi
          else
              echo "å°è¯•æŸ¥æ‰¾æ›¿ä»£å·¥å…·é“¾ä½ç½®..."
              ALTERNATIVE_DIRS="staging_dir staging_dir/toolchain-* staging_dir/host build_dir/target-*"
              
              found_files=false
              for dir_pattern in $ALTERNATIVE_DIRS; do
                  for dir in $(find . -path "./$dir_pattern" -type d 2>/dev/null); do
                      if [ -d "$dir" ] && [ -n "$(ls -A "$dir" 2>/dev/null)" ]; then
                          echo "æ‰¾åˆ°ç›®å½•: $dir"
                          find "$dir" -type f -name "*" 2>/dev/null | head -5
                          found_files=true
                      fi
                  done
              done
              
              if [ "$found_files" = false ]; then
                  echo "âš ï¸ å·¥å…·é“¾ç›®å½•ä¸å­˜åœ¨æˆ–ä¸ºç©ºï¼Œåˆ›å»ºåŸºæœ¬ç»“æž„..."
                  mkdir -p "${{ env.OUTPUT_DIR }}/bin"
                  mkdir -p "${{ env.OUTPUT_DIR }}/lib"
                  mkdir -p "${{ env.OUTPUT_DIR }}/include"
                  
                  echo "åˆ›å»ºè¯´æ˜Žæ–‡ä»¶..."
                  echo "è­¦å‘Šï¼šç¼–è¯‘å™¨æž„å»ºå¯èƒ½ä¸å®Œæ•´" > "${{ env.OUTPUT_DIR }}/README.txt"
                  echo "=======================================" >> "${{ env.OUTPUT_DIR }}/README.txt"
                  echo "æ­¤ç¼–è¯‘å™¨æž„å»ºè¿‡ç¨‹ä¸­å¯èƒ½å‡ºçŽ°äº†é—®é¢˜ã€‚" >> "${{ env.OUTPUT_DIR }}/README.txt"
                  echo "" >> "${{ env.OUTPUT_DIR }}/README.txt"
                  echo "å¯èƒ½çš„åŽŸå› ï¼š" >> "${{ env.OUTPUT_DIR }}/README.txt"
                  echo "1. GMPåº“æž„å»ºå¤±è´¥" >> "${{ env.OUTPUT_DIR }}/README.txt"
                  echo "2. å·¥å…·é“¾é…ç½®é—®é¢˜" >> "${{ env.OUTPUT_DIR }}/README.txt"
                  echo "3. æž„å»ºçŽ¯å¢ƒä¸å®Œæ•´" >> "${{ env.OUTPUT_DIR }}/README.txt"
                  echo "" >> "${{ env.OUTPUT_DIR }}/README.txt"
                  echo "å»ºè®®ï¼š" >> "${{ env.OUTPUT_DIR }}/README.txt"
                  echo "1. æ£€æŸ¥æž„å»ºæ—¥å¿—" >> "${{ env.OUTPUT_DIR }}/README.txt"
                  echo "2. é‡æ–°è¿è¡Œæž„å»º" >> "${{ env.OUTPUT_DIR }}/README.txt"
                  echo "3. å°è¯•ä¸åŒçš„GCCç‰ˆæœ¬" >> "${{ env.OUTPUT_DIR }}/README.txt"
                  echo "=======================================" >> "${{ env.OUTPUT_DIR }}/README.txt"
                  
                  echo "âš ï¸ ä½¿ç”¨åŸºæœ¬ç»“æž„åˆ›å»ºè¾“å‡ºç›®å½•"
              fi
          fi
          
          echo "åˆ›å»ºè¯¦ç»†çš„å…ƒæ•°æ®æ–‡ä»¶..."
          echo "{" > "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"architecture\": \"${{ env.ARCH_DIR }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"arch_name\": \"${{ env.ARCH_NAME }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"libc\": \"${{ env.LIBC_DIR }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"libc_version\": \"${{ env.LIBC_VERSION }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"target\": \"${{ env.TARGET }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"subtarget\": \"${{ env.SUBTARGET }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"compiler_prefix\": \"${{ env.PREFIX }}-\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"gcc_version\": \"${{ env.GCC_VERSION }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"binutils_version\": \"${{ env.BINUTILS_VERSION }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"linux_version\": \"${{ env.LINUX_VERSION }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"openwrt_version\": \"${{ env.OPENWRT_VERSION }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"cpu_type\": \"${{ env.CPU_TYPE }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"tune\": \"${{ env.TUNE }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"abi\": \"${{ env.ABI }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"float_abi\": \"${{ env.FLOAT_ABI }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"build_date\": \"$(date -Iseconds)\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"workflow_run\": \"${{ github.run_id }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"build_id\": \"${{ env.BUILD_ID }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"target_triplet\": \"${{ env.TARGET_TRIPLET }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"actual_gcc_version\": \"${{ env.ACTUAL_GCC_VERSION || 'unknown' }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"version_match\": \"${{ env.BUILD_COMPLETE == 'true' && 'yes' || 'no' }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"status\": \"${{ env.BUILD_COMPLETE == 'true' && 'complete' || 'partial' }}\"," >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "  \"notes\": \"ä½¿ç”¨æ™ºèƒ½æŸ¥æ‰¾ç®—æ³•å’Œå¼ºåˆ¶ç‰ˆæœ¬é”å®šæž„å»º\"" >> "${{ env.OUTPUT_DIR }}/metadata.json"
          echo "}" >> "${{ env.OUTPUT_DIR }}/metadata.json"
          
          echo "è®¡ç®—æˆæžœå¤§å°..."
          TOTAL_SIZE=$(du -sh "${{ env.OUTPUT_DIR }}" | cut -f1)
          FILE_COUNT=$(find "${{ env.OUTPUT_DIR }}" -type f | wc -l)
          
          echo "ðŸ“Š æœ€ç»ˆæˆæžœç»Ÿè®¡:"
          echo "- è¾“å‡ºç›®å½•: ${{ env.OUTPUT_DIR }}"
          echo "- æ€»å¤§å°: $TOTAL_SIZE"
          echo "- æ–‡ä»¶æ•°é‡: $FILE_COUNT"
          echo "- æž¶æž„: ${{ env.ARCH_DIR }}"
          echo "- Cåº“: ${{ env.LIBC_DIR }}"
          echo "- æœŸæœ›GCCç‰ˆæœ¬: ${{ env.GCC_VERSION }}"
          echo "- å®žé™…GCCç‰ˆæœ¬: ${{ env.ACTUAL_GCC_VERSION || 'unknown' }}"
          echo "- ç‰ˆæœ¬åŒ¹é…: ${{ env.BUILD_COMPLETE == 'true' && 'æ˜¯' || 'å¦' }}"
          echo "- æž„å»ºçŠ¶æ€: ${{ env.BUILD_COMPLETE == 'true' && 'å®Œæˆ' || 'éƒ¨åˆ†å®Œæˆ' }}"
          
          echo "TOTAL_SIZE=$TOTAL_SIZE" >> $GITHUB_ENV
          echo "FILE_COUNT=$FILE_COUNT" >> $GITHUB_ENV
          
          echo "âœ… ç¼–è¯‘å™¨ä¿å­˜å®Œæˆ"
          echo "ç»“æŸæ—¶é—´: $(date)"

      - name: ðŸ“¤ æäº¤åˆ°Gitä»“åº“
        if: env.TOOLCHAIN_DIR != ''
        run: |
          echo "=== æäº¤ç¼–è¯‘å™¨åˆ°Gitä»“åº“ ==="
          echo "å¼€å§‹æ—¶é—´: $(date)"
          cd "${{ github.workspace }}"
          
          git config user.email "github-actions@github.com"
          git config user.name "GitHub Actions"
          git config pull.rebase false
          
          echo "æ­¥éª¤1: æ‹‰å–æœ€æ–°ä»£ç ..."
          git pull origin main --no-edit
          
          echo "æ­¥éª¤2: æ·»åŠ ç¼–è¯‘å™¨æ–‡ä»¶..."
          git add -f "firmware-config/build-Compiler-file/compilers/*"
          
          if ! git diff --cached --quiet; then
              echo "æ­¥éª¤3: æ£€æµ‹åˆ°å˜æ›´ï¼Œåˆ›å»ºæäº¤..."
              
              COMMIT_MESSAGES=(
                "build(compiler): æ·»åŠ  ${{ env.ARCH_DIR }}-${{ env.LIBC_DIR }} äº¤å‰ç¼–è¯‘å™¨"
                "æž¶æž„: ${{ env.ARCH_DIR }}"
                "Cåº“: ${{ env.LIBC_DIR }} ${{ env.LIBC_VERSION }}"
                "GCC: ${{ env.GCC_VERSION }}"
                "å®žé™…GCC: ${{ env.ACTUAL_GCC_VERSION || 'unknown' }}"
                "Binutils: ${{ env.BINUTILS_VERSION }}"
                "å¤§å°: ${{ env.TOTAL_SIZE }}"
                "çŠ¶æ€: ${{ env.BUILD_COMPLETE == 'true' && 'å®Œæˆ' || 'éƒ¨åˆ†å®Œæˆ' }}"
                "å·¥ä½œæµ: #${{ github.run_id }}"
              )
              
              echo "æäº¤æ¶ˆæ¯:"
              for msg in "${COMMIT_MESSAGES[@]}"; do
                  echo "  - $msg"
              done
              
              git commit -m "${COMMIT_MESSAGES[0]}" \
                -m "${COMMIT_MESSAGES[1]}" \
                -m "${COMMIT_MESSAGES[2]}" \
                -m "${COMMIT_MESSAGES[3]}" \
                -m "${COMMIT_MESSAGES[4]}" \
                -m "${COMMIT_MESSAGES[5]}" \
                -m "${COMMIT_MESSAGES[6]}" \
                -m "${COMMIT_MESSAGES[7]}" \
                -m "${COMMIT_MESSAGES[8]}"
              
              echo "æ­¥éª¤4: æŽ¨é€åˆ°ä»“åº“..."
              if git push origin main; then
                  echo "âœ… ç¼–è¯‘å™¨å·²æˆåŠŸæäº¤åˆ°ä»“åº“"
              else
                  echo "âš ï¸ æŽ¨é€å¤±è´¥ï¼Œé‡æ–°å°è¯•..."
                  git pull origin main --rebase
                  git push origin main
              fi
          else
              echo "æ²¡æœ‰å˜æ›´éœ€è¦æäº¤"
          fi
          
          echo "ç»“æŸæ—¶é—´: $(date)"

      - name: ðŸ“Š æ˜¾ç¤ºæœ€ç»ˆæˆæžœ
        if: env.TOOLCHAIN_DIR != ''
        run: |
          echo "========================================"
          echo "          ðŸŽ‰ æž„å»ºå®ŒæˆæŠ¥å‘Š              "
          echo "========================================"
          
          if [ "${{ env.BUILD_COMPLETE }}" = "true" ]; then
            echo "âœ… äº¤å‰ç¼–è¯‘å™¨æž„å»ºæˆåŠŸ!"
            echo "   âœ… GCCç‰ˆæœ¬åŒ¹é…æ­£ç¡®!"
          else
            if [ "${{ env.VERSION_MISMATCH }}" = "true" ]; then
              echo "âš ï¸ äº¤å‰ç¼–è¯‘å™¨æž„å»ºå®Œæˆä½†ç‰ˆæœ¬ä¸åŒ¹é…!"
            else
              echo "âš ï¸ äº¤å‰ç¼–è¯‘å™¨æž„å»ºéƒ¨åˆ†å®Œæˆ"
            fi
          fi
          
          echo ""
          echo "ðŸ“Š æž„å»ºä¿¡æ¯:"
          echo "- æž¶æž„: ${{ env.ARCH_DIR }} (${{ env.ARCH_NAME }})"
          echo "- Cåº“: ${{ env.LIBC_DIR }} ${{ env.LIBC_VERSION }}"
          echo "- æœŸæœ›GCCç‰ˆæœ¬: ${{ env.GCC_VERSION }}"
          echo "- å®žé™…GCCç‰ˆæœ¬: ${{ env.ACTUAL_GCC_VERSION || 'æœªçŸ¥' }}"
          echo "- Binutilsç‰ˆæœ¬: ${{ env.BINUTILS_VERSION }}"
          echo "- Linuxå†…æ ¸: ${{ env.LINUX_VERSION }}"
          echo "- ç¼–è¯‘å™¨å‰ç¼€: ${{ env.PREFIX }}-"
          echo "- ç›®æ ‡å¹³å°: ${{ env.TARGET }}/${{ env.SUBTARGET }}"
          echo "- ç›®æ ‡ä¸‰å…ƒç»„: ${{ env.TARGET_TRIPLET }}"
          echo "- æž„å»ºçŠ¶æ€: ${{ env.BUILD_COMPLETE == 'true' && 'å®Œæˆ' || 'éƒ¨åˆ†å®Œæˆ' }}"
          echo "- ç‰ˆæœ¬åŒ¹é…: ${{ env.BUILD_COMPLETE == 'true' && 'æ˜¯' || 'å¦' }}"
          echo ""
          echo "ðŸ“¦ æˆæžœç»Ÿè®¡:"
          echo "- æ€»å¤§å°: ${{ env.TOTAL_SIZE }}"
          echo "- æ–‡ä»¶æ•°é‡: ${{ env.FILE_COUNT }}"
          echo "- è¾“å‡ºç›®å½•: ${{ env.OUTPUT_DIR }}"
          echo ""
          
          if [ "${{ env.BUILD_COMPLETE }}" = "true" ]; then
            echo "ðŸš€ ä½¿ç”¨æ–¹æ³•:"
            echo "cd ${{ env.OUTPUT_DIR }}"
            echo "export STAGING_DIR=\$(pwd)"
            echo 'export PATH="$STAGING_DIR/bin:$PATH"'
            echo "${{ env.PREFIX }}-gcc --version"
          else
            if [ "${{ env.VERSION_MISMATCH }}" = "true" ]; then
              echo "âš ï¸ è­¦å‘Š: GCCç‰ˆæœ¬ä¸åŒ¹é…!"
              echo "æœŸæœ›: ${{ env.GCC_VERSION }}"
              echo "å®žé™…: ${{ env.ACTUAL_GCC_VERSION || 'æœªçŸ¥' }}"
              echo ""
              echo "å¯èƒ½åŽŸå› :"
              echo "1. OpenWrté»˜è®¤é…ç½®è¦†ç›–äº†è‡ªå®šä¹‰ç‰ˆæœ¬"
              echo "2. æŸäº›ä¾èµ–åŒ…å¼ºåˆ¶ä½¿ç”¨äº†ç‰¹å®šç‰ˆæœ¬"
              echo "3. é…ç½®æ–‡ä»¶è¢«å…¶ä»–è¿›ç¨‹ä¿®æ”¹"
              echo ""
              echo "å»ºè®®:"
              echo "1. æ£€æŸ¥æž„å»ºæ—¥å¿—ä¸­çš„é…ç½®é˜¶æ®µ"
              echo "2. æŸ¥çœ‹include/gcc-version.mkæ–‡ä»¶"
              echo "3. å°è¯•æ›´ä¸¥æ ¼çš„ç‰ˆæœ¬é”å®š"
            else
              echo "âš ï¸ æ³¨æ„: ç¼–è¯‘å™¨å¯èƒ½ä¸å®Œæ•´"
              echo "å»ºè®®æ£€æŸ¥æž„å»ºæ—¥å¿—ï¼Œå¯èƒ½éœ€è¦é‡æ–°æž„å»º"
            fi
          fi
          
          echo ""
          echo "â° æž„å»ºæ—¶é—´: $(date)"
          echo "========================================"

      - name: ðŸ“„ ä¸Šä¼ æž„å»ºæ—¥å¿—
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: build-logs-${{ env.BUILD_ID }}
          path: /tmp/*.log
          retention-days: 30

  skip-build:
    needs: setup
    if: needs.setup.outputs.need_build == 'false'
    runs-on: ubuntu-latest
    steps:
      - name: â­ï¸ è·³è¿‡æž„å»º
        run: |
          echo "========================================"
          echo "        â­ï¸ è·³è¿‡æž„å»ºæŠ¥å‘Š                "
          echo "========================================"
          echo "âœ… ç¼–è¯‘å™¨å·²å­˜åœ¨ä¸”å®Œæ•´ï¼Œè·³è¿‡æž„å»º"
          echo ""
          echo "ðŸ“‹ è·³è¿‡åŽŸå› :"
          echo "- ç¼–è¯‘å™¨ç›®å½•å·²å­˜åœ¨ä¸”å®Œæ•´"
          echo "- ç‰ˆæœ¬åŒ¹é…æ­£ç¡®"
          echo "- æœªå¯ç”¨å¼ºåˆ¶é‡æ–°æž„å»º"
          echo ""
          echo "ðŸ”§ çŽ°æœ‰ç¼–è¯‘å™¨ä¿¡æ¯:"
          echo "- æž¶æž„: ${{ github.event.inputs.target_arch }}"
          echo "- Cåº“: ${{ github.event.inputs.libc }}"
          echo "- GCCç‰ˆæœ¬: ${{ needs.setup.outputs.gcc_version }}"
          echo "- Binutilsç‰ˆæœ¬: ${{ needs.setup.outputs.binutils_version }}"
          echo ""
          echo "ðŸ’¡ å¦‚éœ€é‡æ–°æž„å»ºï¼Œè¯·å¯ç”¨'å¼ºåˆ¶é‡æ–°æž„å»º'é€‰é¡¹"
          echo "========================================"
